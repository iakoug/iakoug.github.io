---
title: JSå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼
tags:
  - è®¾è®¡æ¨¡å¼
  - ç®—æ³•
date: 2019-02-24 22:52:00
categories: ç®—æ³•
---
æŒç»­æ›´æ–°
JSå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä»¥åŠåº”ç”¨åœºæ™¯
<!-- more -->
*ä»¥ä¸‹å†…å®¹ä¸ºä¸ªäººç®€å•ç†è§£ä»¥åŠæ‘˜æŠ„éƒ¨åˆ†ç½‘ä¸Šdemoç»„æˆï¼Œæœ‰é”™è¯¯è¯·åœ¨ä¸‹æ–¹è¯„è®ºæŒ‡å‡ºğŸ˜„*

# ä½•è°“è®¾è®¡æ¨¡å¼

æ²¡å¿…è¦è¢«é«˜å¤§ä¸Šçš„åè¯æ‰€å“å€’ï¼Œæ—¥å¸¸codingä¸­æˆ–è®¸ä¸€ä¸ªä¸äº†è§£å„ç§è®¾è®¡æ¨¡å¼çš„ç¨‹åºå‘˜å¯èƒ½è‡ªå·±å…¶å®å·²ç»ç”¨åˆ°äº†å¾ˆå¤š

æŠ›å¼€å®˜æ–¹çš„å®šä¹‰åœ¨æˆ‘çœ‹æ¥ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ€æƒ³è¢«ç»Ÿä¸€ä¸ºè§„èŒƒï¼ŒæŒ‰ç…§è¿™ä¸ªè§„èŒƒå¯ä»¥å†™å‡ºæ›´ä¼˜é›…å¯æ§äº¦æˆ–æ€§èƒ½æ›´ä½³çš„ä»£ç ï¼Œåƒæ˜¯æ¡†æ¶çš„å•ä½

è½¯ä»¶è®¾è®¡æ¨¡å¼æœ‰å¾ˆå¤šï¼Œå¸¸è§„çš„æœ‰23ç§ï¼Œæœ¬æ–‡é’ˆå¯¹å…¶ä¸­å¸¸ç”¨çš„å‡ ç§è¿›è¡Œç®€è¦ä»‹ç»

# è®¾è®¡åŸåˆ™
åœ¨åˆ—ä¸¾å…·ä½“çš„è®¾è®¡æ¨¡å¼ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆçŸ¥é“è®¾è®¡æ¨¡å¼æœ¬èº«çš„è§„èŒƒæ˜¯ä»€ä¹ˆï¼Œè¿™å°±æ˜¯è®¾è®¡åŸåˆ™ï¼Œä¸»è¦ä»¥ä¸‹ä¸‰ç§ï¼š
- å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ï¼šä¸€ä¸ªå¯¹è±¡æˆ–æ–¹æ³•åªåšä¸€ä»¶äº‹æƒ…ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•æ‰¿æ‹…äº†è¿‡å¤šçš„èŒè´£ï¼Œé‚£ä¹ˆåœ¨éœ€æ±‚çš„å˜è¿è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ”¹å†™è¿™ä¸ªæ–¹æ³•çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚åº”è¯¥æŠŠå¯¹è±¡æˆ–æ–¹æ³•åˆ’åˆ†æˆè¾ƒå°çš„ç²’åº¦

- æœ€å°‘çŸ¥è¯†åŸåˆ™ï¼ˆLKPï¼‰ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“ å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œåº”å½“å°½é‡å‡å°‘å¯¹è±¡ä¹‹é—´çš„äº¤äº’ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ä¸å¿…å½¼æ­¤ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å°±ä¸è¦å‘ç”Ÿç›´æ¥çš„ ç›¸äº’è”ç³»ï¼Œå¯ä»¥è½¬äº¤ç»™ç¬¬ä¸‰æ–¹è¿›è¡Œå¤„ç†

- å¼€æ”¾-å°é—­åŸåˆ™ï¼ˆOCPï¼‰ï¼šè½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ï¼‰ç­‰åº”è¯¥æ˜¯å¯ä»¥ æ‰©å±•çš„ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹ï¼Œå½“éœ€è¦æ”¹å˜ä¸€ä¸ªç¨‹åºçš„åŠŸèƒ½æˆ–è€…ç»™è¿™ä¸ªç¨‹åºå¢åŠ æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å¢åŠ ä»£ç çš„æ–¹å¼ï¼Œå°½é‡é¿å…æ”¹åŠ¨ç¨‹åºçš„æºä»£ç ï¼Œé˜²æ­¢å½±å“åŸç³»ç»Ÿçš„ç¨³å®š



# ä»æœ€ç®€å•çš„å•ä½“/å•ä¾‹æ¨¡å¼å¼€å§‹

### å®šä¹‰ï¼š

å•ä½“ï¼šä¸€ä¸ªç”¨æ¥åˆ’åˆ†å‘½åç©ºé—´å¹¶å°†ä¸€æ‰¹ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•ç»„ç»‡åœ¨ä¸€èµ·çš„å¯¹è±¡

å•ä¾‹ï¼šé¡¾åä»…å¯ä»¥å¯ä»¥è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼šåœ¨å®ƒçš„æ ¸å¿ƒç»“æ„ä¸­åªåŒ…å«ä¸€ä¸ªè¢«ç§°ä¸ºå•ä¾‹çš„ç‰¹æ®Šç±»ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯ç³»ç»Ÿä¸­ï¼Œåº”ç”¨è¯¥æ¨¡å¼çš„ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å³ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹
*åœ¨javaä¸­å•ä¾‹çš„å®šä¹‰ï¼šä¸€ä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”è‡ªè¡Œå®ä¾‹åŒ–å‘æ•´ä¸ªç³»ç»Ÿæä¾›*

### ä¼˜ç‚¹:
- å•ä¾‹æ¨¡å¼ä¼šé˜»æ­¢å…¶ä»–å¯¹è±¡å®ä¾‹åŒ–å…¶è‡ªå·±çš„å•ä¾‹å¯¹è±¡çš„å‰¯æœ¬ï¼Œä»è€Œç¡®ä¿æ‰€æœ‰å¯¹è±¡éƒ½è®¿é—®å”¯ä¸€å®ä¾‹
- å› ä¸ºç±»æ§åˆ¶äº†å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œæ‰€ä»¥ç±»å¯ä»¥çµæ´»æ›´æ”¹å®ä¾‹åŒ–è¿‡ç¨‹
- å•ä½“å¯ä»¥æ§åˆ¶å±€éƒ¨å˜é‡æ±¡æŸ“

### åº”ç”¨åœºæ™¯ï¼š
- å¯ä»¥ç”¨å•ä¾‹æ¥åˆ’åˆ†å‘½åç©ºé—´: ä¸€äº›å¯¹è±¡æˆ‘ä»¬å¾€å¾€åªéœ€è¦ä¸€ä¸ªï¼Œå¦‚æŸäº›æ•°æ®çš„ç¼“å­˜
- å€ŸåŠ©å•ä¾‹æ¨¡å¼ï¼Œå¯ä»¥æŠŠä»£ç ç»„ç»‡çš„æ›´ä¸ºä¸€è‡´

#### æœ€åŸºæœ¬çš„å•ä½“æ¨¡å¼
ç›´æ¥å¯¼å‡ºä¸€ä¸ªæ–¹æ³•å±æ€§é›†åˆçš„å¯¹è±¡
```js
// commonjs å¯¼å‡º
module.exports = {
  getSingleton() {
    return this 
  }
}
```
#### ç”¨é—­åŒ…æ¥å®ç°å•ä¾‹
```js
const Ins1 = (function() {
  let instance = null
  // åˆ©ç”¨é—­åŒ…ç‰¹æ€§ä¿è¯å®ä¾‹ç§æœ‰åŒ–
  return function(opt) {
    if (instance === null) {
      instance = this
    }

    for(let k in opt) {
      instance[k] = opt[k]
    }

    return instance
  }
})()
```
æµ‹è¯•ï¼š
```js
const i1 = new Ins1({ name: 'i1' })

const i2 = new Ins1({ name: 'i2' })

console.log(i1 === i2) // true

console.log(i1.name) // i2
```
è¡¥å……ï¼šåœ¨nodeä¸­ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œè‹¥åœ¨æŸä¸ªjsæ–‡ä»¶ä¸­å¯¼å‡ºä¸€ä¸ªç±»ï¼š `class T {} export default new T` ä¹‹ååœ¨å…¶ä»–ä»»ä½•å¤–éƒ¨æ–‡ä»¶å¤šæ¬¡å¼•å…¥å…¶å®éƒ½æ˜¯ä¿è¯äº† T ç±»åªè¢«å®ä¾‹åŒ–äº†ä¸€æ¬¡è€Œä¸ä¼šè¢«å¤šæ¬¡åˆå§‹åŒ–ã€‚è¿™æ˜¯å› ä¸ºnodeéµå¾ªäº†commonjsçš„è§„èŒƒï¼Œæ‰€æœ‰æ–‡ä»¶æ¨¡å—åœ¨è¢«å¼•ç”¨æ—¶éƒ½ä¼šå…ˆå»æ¨¡å—ç³»ç»Ÿçš„ç¼“å­˜ä¸­æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è¿”å›ç¼“å­˜å¦åˆ™æ‰ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ¨¡å—ï¼Œè€Œè¿™ä¸ªç¼“å­˜å…¶å®ä¹Ÿå°±é™åˆ¶äº†æ¨¡å—å†…è„šæœ¬çš„å¤šæ¬¡åˆå§‹åŒ–

# ç­–ç•¥æ¨¡å¼

### å®šä¹‰ï¼š
å°±æ˜¯è§£è€¦ï¼Œä½•ä¸ºç­–ç•¥è§£è€¦ï¼š æŒ‡çš„æ˜¯å®šä¹‰ä¸€äº›åˆ—çš„ç®—æ³•ï¼ŒæŠŠä»–ä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œç›®çš„å°±æ˜¯å°†ç®—æ³•çš„ä½¿ç”¨ä¸ç®—æ³•çš„å®ç°åˆ†ç¦»å¼€æ¥ã€‚è¯´ç™½äº†å°±æ˜¯ä»¥å‰è¦å¾ˆå¤šåˆ¤æ–­çš„å†™æ³•ï¼Œç°åœ¨æŠŠåˆ¤æ–­é‡Œé¢çš„å†…å®¹æŠ½ç¦»å¼€æ¥ï¼Œå˜æˆä¸€ä¸ªä¸ªå°çš„ä¸ªä½“ã€‚å¦‚å¤§é‡çš„if elseæˆ–è€…switch caseåˆ¤æ–­å½“éœ€æ±‚æ›´æ”¹æ—¶éœ€è¦æ·»åŠ å’Œæ›´æ”¹åˆ¤æ–­ï¼Œè¿™è¿èƒŒäº†è®¾è®¡æ¨¡å¼çš„å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾çš„åŸåˆ™

### ä¼˜ç‚¹ï¼š
- å‡å°‘`command c & command v`, æé«˜å¤ç”¨æ€§
- éµå¾ªå¼€é—­åŸåˆ™ï¼Œç®—æ³•ç‹¬ç«‹æ˜“äºåˆ‡æ¢ã€ç†è§£ã€æ‹“å±•

### åº”ç”¨åœºæ™¯ï¼š
é’ˆå¯¹ä»£ç å¤šç§è¡Œä¸ºè®¾ç½®å¤§é‡çš„æ¡ä»¶åˆ¤æ–­æ—¶å°†æ¯ä¸€ä¸ªè¡Œä¸ºåˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å¯¹è±¡ã€‚æ¯ä¸€ä¸ªå¯¹è±¡è¢«ç§°ä¸ºä¸€ä¸ªç­–ç•¥ã€‚è®¾ç½®å¤šä¸ªè¿™ç§ç­–ç•¥å¯¹è±¡ï¼Œå¯ä»¥æ”¹è¿›æˆ‘ä»¬çš„ä»£ç è´¨é‡ï¼Œä¹Ÿæ›´å¥½çš„è¿›è¡Œå•å…ƒæµ‹è¯•

#### æœ€ç®€å•çš„æ‰§è¡Œ
```js
function closure() {
  // å®šä¹‰
  const strategies = {
      plus10: function(arg) {
        return arg + 10
      },
      plus100: function(arg) {
        return arg + 100
      }
  }
  // æ‰§è¡Œ
  return function(plus, base){
    return strategies[plus](base);
  }
}
const strategy = closure()

console.log(strategy('plus10', 1)) // 11
console.log(strategy('plus100', 1)) // 101
```
#### å¯¹æ¯”åˆ†æ
eg.: ä»£ç æƒ…æ™¯ä¸ºè¶…å¸‚ä¿ƒé”€ï¼Œvipä¸º5æŠ˜ï¼Œè€å®¢æˆ·3æŠ˜ï¼Œæ™®é€šé¡¾å®¢æ²¡æŠ˜ï¼Œè®¡ç®—æœ€åéœ€è¦æ”¯ä»˜çš„é‡‘é¢

æ„å¤§åˆ©é€»è¾‘:

```js
function context (name, type, price) {
  if (type === 'vip') {
    return price * 0.5
  } else if (type === 'vip') {
    return price * 0.8
  } else {
    return price
  }
}
```
å¦‚æœtypeç±»å‹éå¸¸å¤šï¼Œå†…éƒ¨é€»è¾‘åˆ†åˆ«ä¹Ÿä¸åªæ˜¯ç®€å•çš„returnä¸€ä¸ªvalï¼Œé‚£å¯¹åç»­çš„ç»´æŠ¤å’Œæµ‹è¯•å°±æ˜¯ç¾éš¾ï¼Œä¸‹é¢æ‹†åˆ†é€»è¾‘ä¸ºç‹¬ç«‹å•å…ƒ:
``` js
class Vip {
  constructor () {
    this.discount = 0.5
  }
  getPrice (price) {
    return this.discount * price
  }
}

class Old {
  constructor () {
    this.discount = 0.8
  }
  getPrice (price) {
    return this.discount * price
  }
}

class Others {
  constructor () {
  }
  getPrice (price) {
    return price
  }
}

class Context {
  constructor () {
    this.name = ''
    this.strategy = null
    this.price = 0
  }
  setPrice (name, strategy, price) {
    this.name = name
    this.strategy = strategy
    this.price = price
  }
  getPrice () {
    console.log(this.name, this.strategy.getPrice(this.price), 'å…ƒ')
    return this.strategy.getPrice(this.price)
  }
}
```
æµ‹è¯•ï¼š
```js
const seller = new Context
const vip = new Vip
const old = new Old
const other = new Others
seller.setPrice('zs', vip, 1000)
seller.getPrice()
seller.setPrice('ls', old, 1000)
seller.getPrice()
seller.setPrice('ww', other, 1000)
seller.getPrice()
// output:
// zs 500 å…ƒ
// ls 800 å…ƒ
// ww 1000 å…ƒ
```
æ˜¾ç„¶é€»è¾‘å¤šè€Œå¤æ‚æ—¶å¯ä»¥æå¤§æé«˜ä»£ç å¯è¯»æ€§ä»¥åŠå‡å°‘ç»´æŠ¤æˆæœ¬

è¡¥å……ï¼šä¸Šè¿°ä¸æ–­é‡å¤çš„ä»£ç ç‰‡æ®µçœ‹èµ·æ¥éå¸¸ä¸‘é™‹ï¼Œå…¶å®å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å®ç°æ›´ç®€æ´çš„å†™æ³•ï¼š
```js
// å®šä¹‰çˆ¶ç±»
class Handler {
  constructor(discount) {
    // ä¸ä¼ ä¸ºåŸä»·
    this.discount = discount || 1
  }

  getPrice(price) {
    return this.discount === 1
      ? price
      : this.discount * price
  }
}

// å£°æ˜å­ç±»
class Vip extends Handler {}
class Old extends Handler {}
class Others extends Handler {}

// Contextç±»åŒä¸Šæ–¹ä¾¿ç»Ÿä¸€æ¥å£è¾“å‡º
class Context {}
```
æµ‹è¯•ï¼š
```js
const seller = new Context
const vip = new Vip(0.5)
const old = new Old(0.8)
const other = new Others
seller.setPrice('zs', vip, 1000)
seller.getPrice()
seller.setPrice('ls', old, 1000)
seller.getPrice()
seller.setPrice('ww', other, 1000)
seller.getPrice()
// output:
// zs 500 å…ƒ
// ls 800 å…ƒ
// ww 1000 å…ƒ
```
æµ‹è¯•ç»“æœä¸€è‡´

# ä»£ç†æ¨¡å¼

### å®šä¹‰ï¼š
ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡ä¸é€‚åˆæˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä»£ç†å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨
è‘—åçš„ä»£ç†æ¨¡å¼ä¾‹å­ä¸ºå¼•ç”¨è®¡æ•°ï¼ˆreference countingï¼‰æŒ‡é’ˆå¯¹è±¡
å¦å¤–ä»£ç†æ¨¡å¼è¿˜å¯åˆ†ä¸ºï¼š
- è™šæ‹Ÿä»£ç†ï¼šæŠŠä¸€äº›å¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œå»¶è¿Ÿåˆ°çœŸæ­£éœ€è¦å®ƒçš„æ—¶å€™æ‰å»åˆ›å»ºï¼Œå½“å¯¹è±¡åœ¨åˆ›å»ºå‰æˆ–åˆ›å»ºä¸­æ—¶ï¼Œç”±è™šæ‹Ÿä»£ç†æ¥æ‰®æ¼”å¯¹è±¡çš„æ›¿èº«ï¼›å¯¹è±¡åˆ›å»ºåï¼Œä»£ç†å°±ä¼šå°†è¯·æ±‚ç›´æ¥å§”æ‰˜ç»™å¯¹è±¡
- ä¿æŠ¤ä»£ç†ï¼šç”¨äºæ§åˆ¶ä¸åŒæƒé™çš„å¯¹è±¡å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®
- ç¼“å­˜ä»£ç†: ç¼“å­˜ä»£ç†å¯ä»¥ä½œä¸ºä¸€äº›å¼€é”€å¤§çš„è¿ç®—ç»“æœæä¾›æš‚æ—¶çš„å­˜å‚¨ï¼Œä¸‹æ¬¡è¿ç®—æ—¶ï¼Œå¦‚æœä¼ é€’è¿›æ¥çš„å‚æ•°è·Ÿä¹‹å‰ä¸€è‡´ï¼Œåˆ™å¯ä»¥ç›´æ¥è¿”å›å‰é¢å­˜å‚¨çš„è¿ç®—ç»“æœ

### ä¼˜ç‚¹ï¼š
ç‹¬ç«‹èŒè´£å½’å±ï¼Œä¾¿äºç»´æŠ¤æµ‹è¯•

### åº”ç”¨åœºæ™¯ï¼š
æ¯”å¦‚å›¾ç‰‡çš„æ‡’åŠ è½½ï¼Œæ•°æ®ç¼“å­˜ç­‰

#### è™šæ‹Ÿä»£ç†å®ç°å›¾ç‰‡æ‡’åŠ è½½
```js
const imgSet = (() => {
  let node = new Image
  document.body.append(node)

  return function(src) {
    node.src = src
  }
})()

const proxyImg = (() => {
  let _img = new Image

  _img.onload = function() {
    setTimeout(imgSet, 2000, this.src)
  }

  return function(src) {
    imgSet('https://yphoto.eryufm.cn/upload/assets/jump.gif')
    _img.src = src
  }
})()
// call
proxyImg(`https://ss0.bdstatic.com/94oJfD_bAAcT8t7mm9GUKT-xh_/timg?image&quality=100&size=b4000_4000&sec=1551174639&di=90b4757f68c9480f78c132c930c1df10&src=http://desk.fd.zol-img.com.cn/t_s960x600c5/g5/M00/02/02/ChMkJ1bKxkmIObywAArTTfACinwAALHjACDZuIACtNl408.jpg`)
```

#### ä¿æŠ¤ä»£ç†
å¯¹è±¡aéœ€è¦ç»™å¯¹è±¡cå‘é€ä¿¡æ¯ï¼Œä¸ºäº†ä¿è¯aå¯¹cæ˜¯ä¸å¯è§ï¼Œå¯ç”¨å¯¹è±¡bä»£ç†è½¬å‘
```js
// filter some no use or unneed requestions or data
// A  ---> B(proxy) ----> C
const a = {
  name: 'a',
  send (target, info) {
    target.receive(info)
  }
}
const c = {
  name: 'c',
  receive (target, info) {
    console.log('c receive ', info, ' from ', target.name)
  }
}
const b = {
  name: 'b',
  receive (info) {
    if (info) {
      c.receive(this, info)
    }
  }
}
a.send(b, 'good morning')
a.send(b, '')
a.send(b, 'send again')

// output:
// c receive good morning from b
// c receive send again from b
```
ä¸Šé¢è¡¨ç¤ºä¸€ä¸ªæœ€ç®€å•çš„ä¿æŠ¤ä»£ç†

#### ç¼“å­˜ä»£ç†
é¡¾åæ€ä¹‰å°±æ˜¯ç¼“å­˜ç›¸å…³çš„ä»£ç†

æœ‰ä¸€ä¸ªäºŒçº§åˆ«è”åŠ¨çš„æ ‡ç­¾åˆ—è¡¨ï¼Œç¬¬äºŒçº§çš„å„æœ‰è‡ªå·±æ‰€å±çš„å¤šä¸ªæ ‡ç­¾æ ¹æ®ç¬¬ä¸€çº§çš„å‚æ•°æ¥å‘é€æŒ‡å®šè¯·æ±‚æ¥è·å–ï¼Œå¦‚æœæƒ³è¦è¾¾åˆ°ç‚¹å‡»ç¬¬ä¸€çº§åˆ—è¡¨è¿…é€Ÿå±•ç¤ºå‡ºç›¸å…³çš„ç¬¬äºŒçº§æ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿç©ºé—²æ—¶é¢„å…ˆå°†æ‰€æœ‰æ ‡ç­¾å…¨éƒ¨è·å–å¹¶ç¼“å­˜
```js
// å­˜å‚¨æ‰€æœ‰æ ‡ç­¾
let tags

const sendApiGetTags = index => {
  // ajax.get('/api', { index })
}
let proxyCache = (async () => {
  const allTagsCache = {}
  const number = 5
  const all = []
  const params = {}

  for (let index = 0; index < number; index++) {
    all.push(sendApiGetTags({
      ...params,
      index
    }))
  }
  const list = await Promise.all(all)

  list.forEach((res, i) => allTagsCache[i] = res)

  return allTagsCache
})()

let setTags = async index => {
  // ç¼“å­˜ä¸­æœ‰ç›´æ¥æ‹¿
  if (proxyCache[index]) {
    tags = proxyCache[index]
  } else {
  // ç¼“å­˜ä¸­æ²¡æœ‰åˆ™é‡å‘è¯·æ±‚
    tags = await sendApiGetTags(index)
  }
}
```



# å‘å¸ƒè®¢é˜…æ¨¡å¼

### å®šä¹‰ï¼š
ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè®¢é˜…è€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨è‡ªèº«çŠ¶æ€å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±çš„çŠ¶æ€ã€‚
è‡³äºå‘å¸ƒè®¢é˜…æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸æ˜¯åŒä¸€æ ·ä¸œè¥¿ä¸åŒçš„äººå„æœ‰çœ‹æ³•

### ä¼˜ç‚¹ï¼š
è®¢é˜…è€…å¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚å½“æŸç§Actionè¢«è§¦å‘æ—¶å®Œæˆè‡ªå·±çš„è°ƒåº¦

### åº”ç”¨åœºæ™¯ï¼š
AngularJsçš„å¹¿æ’­ã€vueçš„eventbusç­‰

#### æ ¹æ®ä¸»ä½“æ„å»ºå‘å¸ƒè®¢é˜…çš„åŸºç±»
æ„é€ å‘å¸ƒè€…åŸºç±»
```js
class Publisher {
  constructor () {
    // è®¢é˜…å‘å¸ƒè€…çš„é˜Ÿåˆ— å­˜å‚¨æ¯ä¸ªè®¢é˜…è€…
    this.subscribers = []
  }
  deliver (data) {
    // å‘å¸ƒæ¶ˆæ¯ è°ƒç”¨è®¢é˜…è€…çš„å›è°ƒ å‘ŠçŸ¥è®¢é˜…è€…
    this.subscribers.forEach(fn => fn.shot(data))

    return this
  }
}
```
æ„é€ è®¢é˜…è€…åŸºç±»
```js
class Observer {
  constructor (call) {
    // ä¼ å…¥è®¢é˜…å›è°ƒ
    this.shot = call
  }
  subscribe (publisher) {
    if (!publisher.subscribers.some(v => v.shot === this.shot)) {
      console.log('è®¢é˜…è¯¥æ¶ˆæ¯')
      // åˆ¤æ–­å½“å‰è®¢é˜…è€…æ˜¯å¦è®¢é˜…
      publisher.subscribers.push(this)
    }
    return this
  }
  unsubscribe (publisher) {
    // ç§»é™¤å½“å‰è®¢é˜…è€…
    console.log('å–æ¶ˆè®¢é˜…')

    publisher.subscribers = publisher.subscribers.filter(v => v.shot !== this.shot)

    return this
  }
}
```
æµ‹è¯•ï¼š
```js
const pub = new Publisher
const pub2 = new Publisher
const obs = new Observer(deliver => console.log(deliver))

obs.subscribe(pub) // è®¢é˜…è¯¥æ¶ˆæ¯
obs.subscribe(pub2) // è®¢é˜…è¯¥æ¶ˆæ¯

pub.deliver('pub deliver first message') // pub deliver first message
pub2.deliver('pub2 deliver first message') // pub2 deliver first message

obs.unsubscribe(pub) // å–æ¶ˆè®¢é˜…
pub.deliver('pub deliver second message') //
```

# è£…é¥°è€…æ¨¡å¼

### å®šä¹‰ï¼š
è£…é¥°æ¨¡å¼æŒ‡çš„æ˜¯åœ¨ä¸å¿…æ”¹å˜åŸç±»æ–‡ä»¶å’Œä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½

### ä¼˜ç‚¹ï¼š
- è£…é¥°å¯¹è±¡å’ŒçœŸå®å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ã€‚è¿™æ ·å®¢æˆ·ç«¯å¯¹è±¡å°±èƒ½ä»¥å’ŒçœŸå®å¯¹è±¡ç›¸åŒçš„æ–¹å¼å’Œè£…é¥°å¯¹è±¡äº¤äº’
- è£…é¥°å¯¹è±¡å¯ä»¥åœ¨è½¬å‘è¿™äº›è¯·æ±‚ä»¥å‰æˆ–ä»¥åå¢åŠ ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚è¿™æ ·å°±ç¡®ä¿äº†åœ¨è¿è¡Œæ—¶ï¼Œä¸ç”¨ä¿®æ”¹ç»™å®šå¯¹è±¡çš„ç»“æ„å°±å¯ä»¥åœ¨å¤–éƒ¨å¢åŠ é™„åŠ çš„åŠŸèƒ½ã€‚åœ¨é¢å‘å¯¹è±¡çš„è®¾è®¡ä¸­ï¼Œé€šå¸¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥å®ç°å¯¹ç»™å®šç±»çš„åŠŸèƒ½æ‰©å±•

### åº”ç”¨åœºæ™¯ï¼š
- éœ€è¦æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼Œæˆ–ç»™ä¸€ä¸ªç±»æ·»åŠ é™„åŠ èŒè´£
- éœ€è¦åŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥å†åŠ¨æ€çš„æ’¤é”€
- ä¸å¿…æ”¹åŠ¨åŸæœ¬çš„é€»è¾‘é€ æˆä¸å¯çŸ¥é—®é¢˜

#### ç»™æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨æ·»åŠ è°ƒç”¨å‰å’Œè°ƒç”¨åçš„é’©å­

æ™®é€šå‡½æ•°ï¼š
```js
function fn(msg) {
  console.log(msg, ' right now')
}

fn('let go') // lets go right now
```
æˆ‘ä»¬çŸ¥é“JSä¸­æ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯åŸºäºçˆ¶ç±» `Function` ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä¼šç»§æ‰¿çˆ¶ç±»åŸå‹çš„æ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å°†å‡½æ•°çš„é’©å­æŒ‚åœ¨çˆ¶ç±»çš„åŸå‹ä¸Šå³å¯ï¼š
```js
// æ‰§è¡Œå‰
Function.prototype.before = function (call) {
  const fn = this
  
  // è¿”å›ä½“æœ¬èº«ä¹Ÿæ˜¯å‡½æ•°æ‰€ä»¥æ”¯æŒç»§ç»­è°ƒç”¨é’©å­
  return function () {
    // è°ƒç”¨é’©å­ï¼ŒåŒæ—¶å‚æ•°ä¼ é€’åˆ°é’©å­å†…
    call.apply(this, arguments)
    // è°ƒç”¨è‡ªèº«
    return fn.apply(this, arguments)
  }
}
// æ‰§è¡Œå
// å’Œ before åŒç†
Function.prototype.after = function (call) {
  const fn = this

  return function () {
    const res = fn.apply(this, arguments)

    call.apply(this, arguments)

    // è¿”å›è‡ªèº«çš„è¿”å›å€¼
    return res
  }
}
```
æµ‹è¯•ï¼š
```js
// é‡æ–°åŒ…è£… fn
function fn(msg) {
  console.log(msg, ' right now')
}

const decoratorFn = fn.before(function (msg) {
  console.log('when we go,', msg)
}).after(function (msg){
  console.log('had to go', msg)
})

decoratorFn('lets go')

// out put:
// when we go, right now
// lets go, right now
// had to go, right now
```
# èŒè´£é“¾ï¼ˆè´£ä»»é“¾ï¼‰æ¨¡å¼

### å®šä¹‰ï¼š
å®ƒæ˜¯ä¸€ç§é“¾å¼ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½ä¸¤ç§æ“ä½œï¼Œè¦ä¹ˆå¤„ç†è¯¥è¯·æ±‚åœæ­¢è¯¥è¯·æ±‚æ“ä½œï¼Œè¦ä¹ˆæŠŠè¯·æ±‚è½¬å‘åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ¥å¤„ç†è¯·æ±‚

### ä¼˜ç‚¹ï¼š
èŒè´£é“¾ä¸Šçš„å¤„ç†è€…è´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°èŒè´£é“¾ä¸Šå³å¯ï¼Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’ï¼Œæ‰€ä»¥èŒè´£é“¾å°†è¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„å¤„ç†è€…è§£è€¦äº†

### åº”ç”¨åœºæ™¯ï¼š
JS ä¸­çš„äº‹ä»¶å†’æ³¡ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰å°±æ˜¯ç»å…¸æ¡ˆä¾‹

#### å®ä¾‹åˆ†æ

éƒ¨é—¨é‡‡è´­ç‰©å“ä¸åŒé‡‘é¢éœ€è¦èµ°ä¸åŒèŒä½çš„æµç¨‹å®¡æ‰¹ï¼Œé‡‡è´­éƒ¨ç»ç†å¯è‡ªä¸»å†³å®š1wä»¥å†…çš„é‡‡è´­ï¼Œæ€»ç»ç†å¯ä»¥å†³å®š10wä»¥å†…çš„é‡‡è´­ï¼Œè‘£äº‹é•¿å†³å®š100wä»¥å†…çš„é‡‡è´­
ä¸‹é¢åˆ†åˆ«æŠ½è±¡å¤„ç†è€…æ„é€ åŸºç±»

è´£ä»»é“¾è°ƒåº¦ä¸­å¿ƒï¼š
```js
class Handler {
  constructor() {
    this.next = null
  }
  setNext(_handler) {
    this.next = _handler
  }
  handleRequest(money) {}
}


```

é‡‡è´­éƒ¨ç»ç†ï¼š
```js
class CGBHandler extends Handler {
  handleRequest(money) {
    // 1w
    if (money < 10000){
      console.log('1wä»¥å†…ï¼ŒåŒæ„')
    } else {
      console.log('é‡‘é¢å¤ªå¤§ï¼Œåªèƒ½å¤„ç†1wä»¥å†…çš„é‡‡è´­')
      if (this.next) {
        this.next.handleRequest(money)
      }
    }
  }
}
```

æ€»ç»ç†ï¼š
```js
class ZJLHandler extends Handler {
  handleRequest(money) {
    // 10w
    if (money < 100000){
      console.log('10wä»¥å†…ï¼ŒåŒæ„')
    } else {
      console.log('é‡‘é¢å¤ªå¤§ï¼Œåªèƒ½å¤„ç†10wä»¥å†…çš„é‡‡è´­')
      if (this.next) {
        this.next.handleRequest(money)
      }
    }
  }
}
```

è‘£äº‹é•¿ï¼š
```js
class DSZHandler extends Handler {
  handleRequest(money) {
    // 100w
    if (money >= 100000){
      console.log('10ä¸‡ä»¥ä¸Šçš„æˆ‘æ¥å¤„ç†')
      //å¤„ç†å…¶ä»–é€»è¾‘
    } 
  }
}
```

å°è£…å®¢æˆ·ç«¯æ¥å£ï¼š
```js
const dispatch = (function client() {
  const cgb = new CGBHandler()
  const zjl = new ZJLHandler()
  const dsz = new DSZHandler()

  cgb.setNext(zjl)
  zjl.setNext(dsz)

  return cgb.handleRequest.bind(cgb)
})()
```
æµ‹è¯•ï¼š
```js

dispath(800000)
// output:
// é‡‘é¢å¤ªå¤§ï¼Œåªèƒ½å¤„ç†1wä»¥å†…çš„é‡‡è´­
// é‡‘é¢å¤ªå¤§ï¼Œåªèƒ½å¤„ç†10wä»¥å†…çš„é‡‡è´­
// 10ä¸‡ä»¥ä¸Šçš„æˆ‘æ¥å¤„ç†

dispath(7000)
// output:
// 1wä»¥å†…ï¼ŒåŒæ„

```
è¡¥å……ï¼š
- çº¯çš„è´£ä»»é“¾ï¼šè¦æ±‚è¯·æ±‚åœ¨è¿™äº›å¯¹è±¡é“¾ä¸­å¿…é¡»è¢«å¤„ç†ï¼Œè€Œä¸”ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å¯¹è±¡ï¼Œè¦ä¹ˆåªå¤„ç†è¯·æ±‚ï¼Œè¦ä¹ˆæŠŠè¯·æ±‚è½¬å‘ç»™ä¸‹ä¸ªèŠ‚ç‚¹å¯¹è±¡å¤„ç†

- ä¸çº¯çš„è´£ä»»é“¾ï¼šè¦æ±‚åœ¨è´£ä»»é“¾é‡Œä¸ä¸€å®šä¼šæœ‰å¤„ç†ç»“æ„ï¼Œè€Œä¸”ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œå³å¯ä»¥å¤„ç†éƒ¨åˆ†è¯·æ±‚ï¼Œå¹¶æŠŠè¯·æ±‚å†è½¬å‘ä¸‹ä¸ªèŠ‚ç‚¹å¤„ç†

.
.
.
.
.
.
æœªå®Œå¾…ç»­...ğŸ‘

{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/archer/source/CNAME","path":"CNAME","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/algolia_logo.svg","path":"assets/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/favicon.ico","path":"assets/favicon.ico","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/loading.svg","path":"assets/loading.svg","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/logo-36.png","path":"assets/logo-36.png","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/logo-48.png","path":"assets/logo-48.png","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/logo-64.png","path":"assets/logo-64.png","modified":0,"renderable":1},{"_id":"themes/archer/source/css/mobile.css","path":"css/mobile.css","modified":0,"renderable":1},{"_id":"themes/archer/source/css/style.css","path":"css/style.css","modified":0,"renderable":1},{"_id":"themes/archer/source/images/favicon.ico","path":"images/favicon.ico","modified":0,"renderable":1},{"_id":"themes/archer/source/lib/webfontloader.min.js","path":"lib/webfontloader.min.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/main.js","path":"scripts/main.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/search.js","path":"scripts/search.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/share.js","path":"scripts/share.js","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Source Sans Pro.woff","path":"font/Source Sans Pro.woff","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Source Sans Pro.woff2","path":"font/Source Sans Pro.woff2","modified":0,"renderable":1},{"_id":"themes/archer/source/images/bg_post.png","path":"images/bg_post.png","modified":0,"renderable":1},{"_id":"themes/archer/source/lib/jquery.min.js","path":"lib/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Oswald-Regular.ttf","path":"font/Oswald-Regular.ttf","modified":0,"renderable":1},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff","path":"font/SourceCodePro-Regular.ttf.woff","modified":0,"renderable":1},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff2","path":"font/SourceCodePro-Regular.ttf.woff2","modified":0,"renderable":1},{"_id":"source/img/wechat.png","path":"img/wechat.png","modified":0,"renderable":0},{"_id":"themes/archer/source/images/wechat.png","path":"images/wechat.png","modified":0,"renderable":1},{"_id":"themes/archer/source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/images/bg_site.jpg","path":"images/bg_site.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1550904528939},{"_id":"source/404.md","hash":"17657585e818d245e2000306cb66d0ce8dedb022","modified":1550904528938},{"_id":"themes/archer/LICENSE","hash":"35f4fb806270f8243459c870a2141e795dfab166","modified":1550904528949},{"_id":"source/manifest.json","hash":"f0344d8a9b213aa7b54f893f77e82e393cadfc4e","modified":1550904528947},{"_id":"themes/archer/README.md","hash":"8e41e0533361cba876297ee6a8fecdc514f21862","modified":1550904528951},{"_id":"themes/archer/_config.yml","hash":"8185afaf77ba7c02528be7b3f355a5d6bed7b0af","modified":1550904528953},{"_id":"themes/archer/gulpfile.js","hash":"4425599995b6c818274f4a27067f484eaf357d05","modified":1550904528963},{"_id":"themes/archer/package.json","hash":"cec814615d1c62afaa7e9ecc8265f20ae313b434","modified":1550904529019},{"_id":"themes/archer/webpack.config.js","hash":"348da2932316c2789a3c0a3cf5efff0dd7cc4ffe","modified":1550904529109},{"_id":"themes/archer/webpack.prod.js","hash":"b6d35f7e9a9718b3e5e3e17c52fcc5e7c38330b0","modified":1550904529110},{"_id":"themes/archer/source/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1550904529020},{"_id":"source/about/index.md","hash":"1367635f4cbdaaec780654f5074bf32af0b15a05","modified":1550904528941},{"_id":"themes/archer/docs/README-en.md","hash":"67f8059a939fbe83db5d02b0b237353140077617","modified":1550904528955},{"_id":"themes/archer/docs/develop-guide-en.md","hash":"c10293eb8ccad5d02412a1369ec1c7e77516b929","modified":1550904528957},{"_id":"themes/archer/docs/develop-guide-zh.md","hash":"522434202e5e810b3c7f9591eb3a4451a4e485f0","modified":1550904528959},{"_id":"themes/archer/layout/404.ejs","hash":"a054b4ea1147846bed4252dd56182cb8e32d95eb","modified":1550904528965},{"_id":"themes/archer/layout/index.ejs","hash":"c9ae77cd8f7b862d23137a7b4eb5eb01b558ed33","modified":1550904529010},{"_id":"themes/archer/layout/about.ejs","hash":"990df15653a99453617e72dfc195fa0a75b9a5d1","modified":1550904529008},{"_id":"themes/archer/layout/layout.ejs","hash":"9286baf0626a279c03a67b04fece0d390658f784","modified":1550904529011},{"_id":"themes/archer/layout/post.ejs","hash":"6e5e023763f8b38fec5fd186be141a344f9e0191","modified":1550904529013},{"_id":"themes/archer/layout/site-meta.ejs","hash":"d727c9e0cee2767b4596f9805622809a2ebb344b","modified":1550904529014},{"_id":"source/_posts/do something/å…³äºå°ç¨‹åºè·¯ç”±å°è£….md","hash":"16eb64c00b1d839a7f21d39546d052c145a69c28","modified":1550896563000},{"_id":"source/_posts/do something/åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹.md","hash":"8425a46bbd5cf4093ee91198ef94b15e71a1897f","modified":1550896563000},{"_id":"source/_posts/human beings/äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢.md","hash":"f5be655bf3ccd64577c4d6e9a2ffce49e296e78b","modified":1550910111570},{"_id":"source/_posts/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹.md","hash":"6cf7683cc83d13fe2d93088f595938817f007126","modified":1550896563000},{"_id":"themes/archer/layout/_partial/algolia.ejs","hash":"21765ec5abc9a65513e6bff57cb021d3b3852d35","modified":1550904528967},{"_id":"themes/archer/layout/_partial/base-background-image.ejs","hash":"8273dba24aa41c9ceb3ea8ca68b9128c283b6eac","modified":1550904528969},{"_id":"themes/archer/layout/_partial/base-footer.ejs","hash":"142881aa536b82f4db9f45f27a01c23412fbd107","modified":1550904528970},{"_id":"themes/archer/layout/_partial/base-head.ejs","hash":"3d6c7527bb156c4c3132d9813dcac3f99b5240cb","modified":1550904528972},{"_id":"themes/archer/layout/_partial/base-header.ejs","hash":"af76b1a18a63934e83b078bf5f9f886e972a0ceb","modified":1550904528974},{"_id":"themes/archer/layout/_partial/base-preload-polyfill.ejs","hash":"065f8d6c4aae6782e6819815911f7feb6402a4ec","modified":1550904528975},{"_id":"themes/archer/layout/_partial/base-profile.ejs","hash":"dcf88c81a85232f8298c5327673da7147214a677","modified":1550904528977},{"_id":"themes/archer/layout/_partial/base-social.ejs","hash":"92ac580acc20bde7b3345bfe132671b9043bfbd6","modified":1550904528979},{"_id":"themes/archer/layout/_partial/base-title-tags.ejs","hash":"e1b4893af2b18f502bad1b552c3f3381ecc3021f","modified":1550904528980},{"_id":"themes/archer/layout/_partial/google-adsense.ejs","hash":"1e4f9055cf192501d0901296680a9600693c854b","modified":1550904528996},{"_id":"themes/archer/layout/_partial/intro-height.ejs","hash":"fc03729825ac7ffd4045f910bbd936bc5841c65e","modified":1550904528998},{"_id":"themes/archer/source/assets/algolia_logo.svg","hash":"16505f61f19ba65f629dfd033f14ee9abcf18756","modified":1550904529022},{"_id":"themes/archer/source/assets/favicon.ico","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550896563000},{"_id":"themes/archer/source/assets/loading.svg","hash":"85082b002bae1335114b71550350907884187e38","modified":1550904529024},{"_id":"themes/archer/source/assets/logo-36.png","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550896563000},{"_id":"themes/archer/source/assets/logo-48.png","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550896563000},{"_id":"themes/archer/source/assets/logo-64.png","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550896563000},{"_id":"themes/archer/source/css/mobile.css","hash":"2309aa0d6a7ef2502780788ae6727b7307b8033b","modified":1550904529026},{"_id":"themes/archer/source/css/style.css","hash":"6679fb3b52fb94dc9c6d8f7fe15d25fcad683c4d","modified":1550904529028},{"_id":"themes/archer/source/images/favicon.ico","hash":"6484806109ed1950f6700639a86b96c6681d6f9e","modified":1550896563000},{"_id":"themes/archer/source/lib/webfontloader.min.js","hash":"6f18a92bbe8bed93113449ed6ff8d148c1e7565a","modified":1550904529042},{"_id":"themes/archer/source/scripts/main.js","hash":"258b08f308c2a78f6cc0a81cf353994da771966a","modified":1550904529044},{"_id":"themes/archer/source/scripts/search.js","hash":"d5f739e261e8ce74f993c6157b248663bda122bf","modified":1550904529045},{"_id":"themes/archer/source/scripts/share.js","hash":"bb5bb37ce7f47f8c084b232df3e5fe2378d7ca01","modified":1550904529048},{"_id":"themes/archer/source/font/Source Sans Pro.woff","hash":"a6722c9b6439b7a020a9be3d3178970757a9265c","modified":1550904529031},{"_id":"themes/archer/source/font/Source Sans Pro.woff2","hash":"da65f527a8da65d5eb6721626d28cfdb46ab104a","modified":1550904529033},{"_id":"themes/archer/src/js/browser.js","hash":"6e98eacb585fc24fe1f14e80dcb8d3b7d1b463fb","modified":1550904529050},{"_id":"themes/archer/src/js/fancybox.js","hash":"62a190b65d777057e86394d81869fbfa5051ca28","modified":1550904529052},{"_id":"themes/archer/src/js/initSidebar.js","hash":"d94a9da296c56e9b75def4386849df2b3b80e982","modified":1550904529056},{"_id":"themes/archer/src/js/init.js","hash":"fb1ea412d1306f07a62f95c56c732ad891036769","modified":1550904529054},{"_id":"themes/archer/src/js/main.js","hash":"9271c32fa8450d8c60bd605b9db578264afef90d","modified":1550904529058},{"_id":"themes/archer/src/js/mobile.js","hash":"27b974d628a94f5abd700ca7757bcd153d866442","modified":1550904529059},{"_id":"themes/archer/src/js/scroll.js","hash":"149f251f6ae1a319eecfc903ece61b9a6f4bede4","modified":1550904529061},{"_id":"themes/archer/src/js/search.js","hash":"238120e2832066948ce872c208680f4ef5c56900","modified":1550904529063},{"_id":"themes/archer/src/js/share.js","hash":"0c0ccd800e063bda901b99e5bfbe96c72723e5ba","modified":1550904529065},{"_id":"themes/archer/src/js/sidebar.js","hash":"a90865aefc0f933d391c297ebf06960ac322af34","modified":1550904529067},{"_id":"themes/archer/src/js/tag.js","hash":"18f58d928583ba84f2c53d069d57acd4d21677af","modified":1550904529068},{"_id":"themes/archer/src/js/toc.js","hash":"e6778bb114307cccdb5462b150fb4c79e0435f99","modified":1550904529070},{"_id":"themes/archer/src/js/util.js","hash":"da642e9e6b50ef56a6f85dab85d19b087e4ba373","modified":1550904529072},{"_id":"themes/archer/src/scss/_common.scss","hash":"95f061298cd824fe9f09dabe70dcb4fb44097557","modified":1550904529073},{"_id":"themes/archer/src/scss/_mixin.scss","hash":"46d9e40be9000d23494a80cdd74fea61328ffdfa","modified":1550904529075},{"_id":"themes/archer/src/scss/_normalize.scss","hash":"9123aa118cc636b4bfe718b87274d0b9732d8e89","modified":1550904529077},{"_id":"themes/archer/src/scss/_variables.scss","hash":"bfbd654e0637f21c29c6fb5613c6a4befe2952d8","modified":1550904529104},{"_id":"themes/archer/src/scss/mobile.scss","hash":"9e79e519443370f9ad9868db4ecfc9b00f18b1a7","modified":1550904529105},{"_id":"themes/archer/src/scss/style.scss","hash":"672e27e2e125f55499f65c4d572f1b94a1a8ed7d","modified":1550904529107},{"_id":"themes/archer/layout/_partial/comment/custom.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1550904528984},{"_id":"themes/archer/source/images/bg_post.png","hash":"dacb8dbf91978317e1fc0925137167f3f76285e2","modified":1550896563000},{"_id":"themes/archer/source/lib/jquery.min.js","hash":"0c3192b500a4fd550e483cf77a49806a5872185b","modified":1550904529040},{"_id":"themes/archer/source/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1550904529029},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1550904529035},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1550904529038},{"_id":"themes/archer/package-lock.json","hash":"42f7658ed1726d9501c36c143c2b424b78a8708b","modified":1550904529017},{"_id":"themes/archer/layout/_partial/comment/changyan.ejs","hash":"244a4c71b862e6385a6de1e83a4975418a8c6fe7","modified":1550904528982},{"_id":"themes/archer/layout/_partial/comment/gitment.ejs","hash":"c043a98e33252b9a628bfd31c4a3b2883dce2b99","modified":1550904528987},{"_id":"themes/archer/layout/_partial/comment/disqus.ejs","hash":"cfdb15116abe89f4b54f7bb18a0b23a597c47a60","modified":1550904528986},{"_id":"themes/archer/layout/_partial/comment/valine.ejs","hash":"745bb720cbbcc0a5281361f23814d1d8f97f8a02","modified":1550904528991},{"_id":"themes/archer/layout/_partial/comment/youyan.ejs","hash":"483c07212879b116b772f428547c9962be96d2ce","modified":1550904528992},{"_id":"themes/archer/layout/_partial/comment/livere.ejs","hash":"a6acb5d7778ade98ba5b6932e38a585460513f49","modified":1550904528989},{"_id":"themes/archer/layout/_partial/critical-css/critical-style.ejs","hash":"c22a713d188bf15e5db02b69b2b3714eb431dc79","modified":1550904528994},{"_id":"themes/archer/layout/_partial/script/font-loader.ejs","hash":"4281841e5bbb5e1a83c3ebf6506dab057e1fe6b9","modified":1550904528999},{"_id":"themes/archer/layout/_partial/sidebar/base-sidebar.ejs","hash":"c5ce643a06a2103aa4ac0d8279c024f90886d37f","modified":1550904529001},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-archives.ejs","hash":"e710acbc85e1cc5ae0e7ab5b5899837b9f222b97","modified":1550904529003},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-categories.ejs","hash":"4feb7c3d17a3c8994eb095d43d75fbd0f1ed5b4f","modified":1550904529005},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-tags.ejs","hash":"e96750b1aa7113322696857882b1e1fde11c1fc4","modified":1550904529006},{"_id":"themes/archer/src/scss/_partial/_404.scss","hash":"6631872bf75d10a0ccc5c03704e428d74d6835c5","modified":1550904529079},{"_id":"themes/archer/src/scss/_partial/_algolia.scss","hash":"0570b1fd3007952ed0697c777f404b423e7a959c","modified":1550904529081},{"_id":"themes/archer/src/scss/_partial/_index-page.scss","hash":"b4d8e76f3b5d06c19845f08eee17cb945c375107","modified":1550904529083},{"_id":"themes/archer/src/scss/_partial/_post-page.scss","hash":"2cee47f28de27e8e6d0b5566135c117278e773d8","modified":1550904529094},{"_id":"themes/archer/docs/snap.png","hash":"0b2a8bf016f6eed576abfdcdb7dcf8de51c12562","modified":1550904528962},{"_id":"themes/archer/src/scss/_partial/_partial/_footer.scss","hash":"1938574e03a8a272cf99ac5d0bdc1fad9e4da641","modified":1550904529084},{"_id":"themes/archer/src/scss/_partial/_partial/_header.scss","hash":"f166c2ba859f2ce76e7ade441c83cbc81bdf184e","modified":1550904529086},{"_id":"themes/archer/src/scss/_partial/_partial/_intro.scss","hash":"690f6188fdf0113b0ce6d28a97b872ce0f52f792","modified":1550904529088},{"_id":"themes/archer/src/scss/_partial/_partial/_profile.scss","hash":"e88fa63587af0ee490591ff5e8953c8e875dcfd6","modified":1550904529091},{"_id":"themes/archer/src/scss/_partial/_partial/_paginator.scss","hash":"ad14edda32d4e3f05819eda783db321402d37356","modified":1550904529090},{"_id":"themes/archer/src/scss/_partial/_partial/_scrollbar.scss","hash":"eabe9fd56908ce595eedc90bb211412aba5d433c","modified":1550904529093},{"_id":"themes/archer/src/scss/_partial/_post/_code.scss","hash":"ed7b87d71b94cdb4e327fe1164a6c2df9ce1288c","modified":1550904529096},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar-archive.scss","hash":"049f0eac5a71e69d2a09a04e5caf75c27e61aafd","modified":1550904529098},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar-tags.scss","hash":"51b3d17bf4fc3f301be631c4ee750d1c8189bd2a","modified":1550904529100},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar.scss","hash":"90617295ae34d29d69b0b336454963ac0adb30db","modified":1550904529102},{"_id":"source/_posts/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹/onion.png","hash":"64ed5f85efbca9cda0ecb5737edf3430f044f733","modified":1550896563000},{"_id":"source/img/wechat.png","hash":"1bb6520ad81686d563b56db149c38a54f33ed0b8","modified":1550904528946},{"_id":"themes/archer/source/images/wechat.png","hash":"1bb6520ad81686d563b56db149c38a54f33ed0b8","modified":1550896563000},{"_id":"themes/archer/source/images/avatar.jpg","hash":"67187d3e3c0a8e3bb673fc8de590a16b30695575","modified":1550896563000},{"_id":"themes/archer/source/images/bg_site.jpg","hash":"958660a9659be7b1c58eb60c8abf6d4ff0dfc88c","modified":1550896563000},{"_id":"public/manifest.json","hash":"a23c85880d1c222879e8646ecdc177eaf7cecdaa","modified":1550910126921},{"_id":"public/content.json","hash":"2c701d9d6f79b30d53a5835c59e2331036362978","modified":1550910127027},{"_id":"public/atom.xml","hash":"b1442be5c51b8e85bf4f9dd0b761e47523de005f","modified":1550910127032},{"_id":"public/post-sitemap.xml","hash":"f18f043e324f15b3fa918a4d619adaac6ce4835d","modified":1550910127032},{"_id":"public/page-sitemap.xml","hash":"520c5ed0c075b8b268754e143cd8a4993c929eae","modified":1550910127032},{"_id":"public/category-sitemap.xml","hash":"3237b71df98a37bed073a04fc42f412dbce8d8a6","modified":1550910127032},{"_id":"public/tag-sitemap.xml","hash":"d155d5657e68d9eb77428cdb90c175bfe3306055","modified":1550910127032},{"_id":"public/sitemap.xsl","hash":"4321fa69dc1b8811d32b7a1478e5603e038cea1a","modified":1550910127032},{"_id":"public/sitemap.xml","hash":"85647c480cbdfaa31a3b00710b8839f74bd5e6de","modified":1550910127032},{"_id":"public/CNAME","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1550910127032},{"_id":"public/about/index.html","hash":"5c32680773d02df68186671faf5ac34cfd7e02c7","modified":1550910127038},{"_id":"public/2019/02/22/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹/index.html","hash":"6d9fef757eba0481597b233a7fb14999990e0b14","modified":1550910127038},{"_id":"public/404.html","hash":"82ab57732d45faa15989731c6065660980732674","modified":1550910127038},{"_id":"public/2019/02/21/do something/åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹/index.html","hash":"be1f756d8b31d9230c7765ce7055be517e91cb25","modified":1550910127038},{"_id":"public/2019/01/04/human beings/äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢/index.html","hash":"8711efc4d811fda5bf4e663ef87267e1c1580b46","modified":1550910127038},{"_id":"public/archives/index.html","hash":"091f6ab239daac07ce3e8dc28efa9fe2bdcf650c","modified":1550910127038},{"_id":"public/2018/12/09/do something/å…³äºå°ç¨‹åºè·¯ç”±å°è£…/index.html","hash":"c972a6954bb66f17cae9389c7f8911f169e95b44","modified":1550910128529},{"_id":"public/archives/2018/index.html","hash":"1cc2c499f2b8eb6592575da06de8d813ec816c17","modified":1550910127038},{"_id":"public/archives/2018/12/index.html","hash":"1cc2c499f2b8eb6592575da06de8d813ec816c17","modified":1550910127038},{"_id":"public/archives/2019/index.html","hash":"1c4c6f9cd18ee196c0d18d6b990d4f0457d70c5e","modified":1550910127038},{"_id":"public/archives/2019/01/index.html","hash":"792ad22b892b2d2c78374ba354229d59d604099f","modified":1550910127039},{"_id":"public/archives/2019/02/index.html","hash":"0eab443d02226ca1f8a9a181edc0170ec7c00a09","modified":1550910127039},{"_id":"public/categories/ç®—æ³•/index.html","hash":"40cd89b7f3fcb23b4f1babe99fc95c5def91ea61","modified":1550910127039},{"_id":"public/categories/å°è£…/index.html","hash":"097bcc7ac536097332853dad4ac84d700feec0db","modified":1550910127039},{"_id":"public/categories/å½“æˆ‘åœ¨æ‰¯æ·¡/index.html","hash":"792ad22b892b2d2c78374ba354229d59d604099f","modified":1550910127039},{"_id":"public/tags/ç®—æ³•/index.html","hash":"40cd89b7f3fcb23b4f1babe99fc95c5def91ea61","modified":1550910127039},{"_id":"public/tags/é€’å½’/index.html","hash":"40cd89b7f3fcb23b4f1babe99fc95c5def91ea61","modified":1550910127039},{"_id":"public/tags/åŠ¨æ€è§„åˆ’/index.html","hash":"40cd89b7f3fcb23b4f1babe99fc95c5def91ea61","modified":1550910127039},{"_id":"public/tags/å°¾é€’å½’/index.html","hash":"40cd89b7f3fcb23b4f1babe99fc95c5def91ea61","modified":1550910127039},{"_id":"public/index.html","hash":"4807e51bb57fd123295d0b010fb7446ce3dc52c4","modified":1550910127039},{"_id":"public/tags/å°è£…/index.html","hash":"097bcc7ac536097332853dad4ac84d700feec0db","modified":1550910127040},{"_id":"public/tags/koa/index.html","hash":"55fee28fdcfc061e0fe4aaae84f60b4e4146509c","modified":1550910127040},{"_id":"public/tags/æ´‹è‘±æ¨¡å‹/index.html","hash":"55fee28fdcfc061e0fe4aaae84f60b4e4146509c","modified":1550910127040},{"_id":"public/tags/å½“æˆ‘åœ¨æ‰¯æ·¡/index.html","hash":"792ad22b892b2d2c78374ba354229d59d604099f","modified":1550910127040},{"_id":"public/tags/å¾®ä¿¡å°ç¨‹åº/index.html","hash":"1cc2c499f2b8eb6592575da06de8d813ec816c17","modified":1550910127040},{"_id":"public/tags/mpvue/index.html","hash":"1cc2c499f2b8eb6592575da06de8d813ec816c17","modified":1550910127040},{"_id":"public/tags/è·¯ç”±/index.html","hash":"1cc2c499f2b8eb6592575da06de8d813ec816c17","modified":1550910127040},{"_id":"public/assets/loading.svg","hash":"85082b002bae1335114b71550350907884187e38","modified":1550910127040},{"_id":"public/assets/algolia_logo.svg","hash":"16505f61f19ba65f629dfd033f14ee9abcf18756","modified":1550910127041},{"_id":"public/assets/favicon.ico","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550910127041},{"_id":"public/assets/logo-36.png","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550910127041},{"_id":"public/assets/logo-48.png","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550910127041},{"_id":"public/assets/logo-64.png","hash":"169c71d072fa90b44ff91ca33ffbfda72342c054","modified":1550910127041},{"_id":"public/images/favicon.ico","hash":"6484806109ed1950f6700639a86b96c6681d6f9e","modified":1550910127041},{"_id":"public/font/Source Sans Pro.woff","hash":"a6722c9b6439b7a020a9be3d3178970757a9265c","modified":1550910127041},{"_id":"public/font/Source Sans Pro.woff2","hash":"da65f527a8da65d5eb6721626d28cfdb46ab104a","modified":1550910127041},{"_id":"public/assets/algolia/algoliasearchLite.min.js","hash":"1bcf74674566a61fe954e374a231011239b8e5e9","modified":1550910127042},{"_id":"public/images/bg_post.png","hash":"dacb8dbf91978317e1fc0925137167f3f76285e2","modified":1550910127062},{"_id":"public/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1550910127062},{"_id":"public/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1550910127062},{"_id":"public/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1550910127062},{"_id":"public/css/mobile.css","hash":"0b7ac34da7d703064423480fc0526d91fa5716bc","modified":1550910127065},{"_id":"public/scripts/search.js","hash":"d5f739e261e8ce74f993c6157b248663bda122bf","modified":1550910127065},{"_id":"public/assets/algolia/algoliasearchLite.js","hash":"422f4c3882cf8366927333081292a9bed6000124","modified":1550910127065},{"_id":"public/assets/algolia/algoliasearch.min.js","hash":"55eaeaf5ecda250f5bed80958a05bef13886eee6","modified":1550910127065},{"_id":"public/lib/webfontloader.min.js","hash":"bc6ffe9c0d8b3285564619a445c6ca575eb9d0f5","modified":1550910127073},{"_id":"public/2019/02/22/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹/onion.png","hash":"64ed5f85efbca9cda0ecb5737edf3430f044f733","modified":1550910127073},{"_id":"public/scripts/share.js","hash":"bb5bb37ce7f47f8c084b232df3e5fe2378d7ca01","modified":1550910127077},{"_id":"public/assets/algolia/algoliasearch.js","hash":"f34e955c2112cc6a80b48e48dd240a10817069f9","modified":1550910127077},{"_id":"public/css/style.css","hash":"9b9e9ab4195f4f22bd52895ebedfa51b2182cab0","modified":1550910127079},{"_id":"public/scripts/main.js","hash":"258b08f308c2a78f6cc0a81cf353994da771966a","modified":1550910127085},{"_id":"public/lib/jquery.min.js","hash":"0dc32db4aa9c5f03f3b38c47d883dbd4fed13aae","modified":1550910127104},{"_id":"public/img/wechat.png","hash":"1bb6520ad81686d563b56db149c38a54f33ed0b8","modified":1550910127109},{"_id":"public/images/wechat.png","hash":"1bb6520ad81686d563b56db149c38a54f33ed0b8","modified":1550910127110},{"_id":"public/images/avatar.jpg","hash":"67187d3e3c0a8e3bb673fc8de590a16b30695575","modified":1550910127116},{"_id":"public/images/bg_site.jpg","hash":"958660a9659be7b1c58eb60c8abf6d4ff0dfc88c","modified":1550910127120}],"Category":[{"name":"ç®—æ³•","_id":"cjsh7ugh7000564vamh12ks5g"},{"name":"å°è£…","_id":"cjsh7ugha000864vaz26nmxce"},{"name":"å½“æˆ‘åœ¨æ‰¯æ·¡","_id":"cjsh7ughc000b64vaxtpjduv6"}],"Data":[],"Page":[{"layout":"404","title":"[404]","description":"May the Force be with you :&#41;","_content":"","source":"404.md","raw":"---\nlayout: 404\ntitle: \"[404]\"\ndescription: \"May the Force be with you :&#41;\"\n---","date":"2019-02-23T06:48:48.938Z","updated":"2019-02-23T06:48:48.938Z","path":"404.html","comments":1,"_id":"cjsh7ugg6000064vam88vrlny","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"{\n    \"dir\": \"auto\",\n    \"lang\": \"zh\",\n    \"name\": \"kwok io\",\n    \"scope\": \"/\",\n    \"display\": \"standalone\",\n    \"start_url\": \"/\",\n    \"short_name\": \"kwok io\",\n    \"theme_color\": \"transparent\",\n    \"description\": \"- kwok io\",\n    \"orientation\": \"any\",\n    \"background_color\": \"transparent\",\n    \"related_applications\": [],\n    \"prefer_related_applications\": false,\n    \"gcm_sender_id\": \"482941778795\",\n    \"gcm_sender_id_comment\": \"Do not change the GCM Sender ID\",\n    \"icons\": [{\n      \"src\": \"/assets/logo-32.png\",\n      \"sizes\": \"32x32\",\n      \"type\": \"image/png\"\n    }, {\n      \"src\": \"/assets/logo-48.png\",\n      \"sizes\": \"48x48\",\n      \"type\": \"image/png\"\n    },\n    {\n        \"src\": \"/assets/logo-64.png\",\n        \"sizes\": \"64x64\",\n        \"type\": \"image/png\"\n      }\n    ]\n  }","source":"manifest.json","raw":"{\n    \"dir\": \"auto\",\n    \"lang\": \"zh\",\n    \"name\": \"kwok io\",\n    \"scope\": \"/\",\n    \"display\": \"standalone\",\n    \"start_url\": \"/\",\n    \"short_name\": \"kwok io\",\n    \"theme_color\": \"transparent\",\n    \"description\": \"- kwok io\",\n    \"orientation\": \"any\",\n    \"background_color\": \"transparent\",\n    \"related_applications\": [],\n    \"prefer_related_applications\": false,\n    \"gcm_sender_id\": \"482941778795\",\n    \"gcm_sender_id_comment\": \"Do not change the GCM Sender ID\",\n    \"icons\": [{\n      \"src\": \"/assets/logo-32.png\",\n      \"sizes\": \"32x32\",\n      \"type\": \"image/png\"\n    }, {\n      \"src\": \"/assets/logo-48.png\",\n      \"sizes\": \"48x48\",\n      \"type\": \"image/png\"\n    },\n    {\n        \"src\": \"/assets/logo-64.png\",\n        \"sizes\": \"64x64\",\n        \"type\": \"image/png\"\n      }\n    ]\n  }","date":"2019-02-23T06:48:48.947Z","updated":"2019-02-23T06:48:48.947Z","path":"manifest.json","layout":"false","title":"","comments":1,"_id":"cjsh7ugg8000164va04domh0u","content":"{\"dir\":\"auto\",\"lang\":\"zh\",\"name\":\"kwok io\",\"scope\":\"/\",\"display\":\"standalone\",\"start_url\":\"/\",\"short_name\":\"kwok io\",\"theme_color\":\"transparent\",\"description\":\"- kwok io\",\"orientation\":\"any\",\"background_color\":\"transparent\",\"related_applications\":[],\"prefer_related_applications\":false,\"gcm_sender_id\":\"482941778795\",\"gcm_sender_id_comment\":\"Do not change the GCM Sender ID\",\"icons\":[{\"src\":\"/assets/logo-32.png\",\"sizes\":\"32x32\",\"type\":\"image/png\"},{\"src\":\"/assets/logo-48.png\",\"sizes\":\"48x48\",\"type\":\"image/png\"},{\"src\":\"/assets/logo-64.png\",\"sizes\":\"64x64\",\"type\":\"image/png\"}]}","site":{"data":{}},"excerpt":"","more":"{\"dir\":\"auto\",\"lang\":\"zh\",\"name\":\"kwok io\",\"scope\":\"/\",\"display\":\"standalone\",\"start_url\":\"/\",\"short_name\":\"kwok io\",\"theme_color\":\"transparent\",\"description\":\"- kwok io\",\"orientation\":\"any\",\"background_color\":\"transparent\",\"related_applications\":[],\"prefer_related_applications\":false,\"gcm_sender_id\":\"482941778795\",\"gcm_sender_id_comment\":\"Do not change the GCM Sender ID\",\"icons\":[{\"src\":\"/assets/logo-32.png\",\"sizes\":\"32x32\",\"type\":\"image/png\"},{\"src\":\"/assets/logo-48.png\",\"sizes\":\"48x48\",\"type\":\"image/png\"},{\"src\":\"/assets/logo-64.png\",\"sizes\":\"64x64\",\"type\":\"image/png\"}]}"},{"title":"chris kwok","layout":"about","_content":"hi\n\nhere is chris kwok\n\nas a front-end coder\n\nin shanghai\n\n","source":"about/index.md","raw":"---\ntitle: chris kwok\nlayout: about\n---\nhi\n\nhere is chris kwok\n\nas a front-end coder\n\nin shanghai\n\n","date":"2019-02-23T06:48:48.941Z","updated":"2019-02-23T06:48:48.941Z","path":"about/index.html","comments":1,"_id":"cjsh7uggp000264vajph7xwwm","content":"<p>hi</p>\n<p>here is chris kwok</p>\n<p>as a front-end coder</p>\n<p>in shanghai</p>\n","site":{"data":{}},"excerpt":"","more":"<p>hi</p>\n<p>here is chris kwok</p>\n<p>as a front-end coder</p>\n<p>in shanghai</p>\n"}],"Post":[{"title":"åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹","date":"2019-02-21T12:36:00.000Z","_content":"# é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\n\nè‰åŸä¸Šæœ‰ 1000 åªè€è™å’Œ 1 åªç¾Šï¼Œè€è™åƒç¾Šï¼Œç¾Šåƒè‰ï¼Œä½†æ˜¯è€è™åƒå®Œç¾Šä¼šå˜æˆç¾Šï¼ˆä¸€åªç¾Šåªèƒ½è¢«ä¸€åªè€è™åƒï¼‰\n\n_æç¤º:æ¯åªè€è™éƒ½å¾ˆèªæ˜_\n\n## ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\n\n#### case1: ä¸¤åªè€è™ä¸€åªç¾Š\n\nä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåå˜ä¸ºç¾Šä¼šè¢«å‰©ä¸‹çš„è€è™åƒ\n\n#### case2: ä¸‰åªè€è™ä¸€åªç¾Š\n\nåƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase1\n\n#### case3: å››åªè€è™ä¸€åªç¾Š\n\nä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase2ä¼šè¢«åƒ\n\n#### case4: äº”åªè€è™ä¸€åªç¾Š\n\nåƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase3\n\n.\n\n.\n\n.\n\n.\n\n.\n\n.\n\nç”±æœ€åŸºæœ¬çš„å½’çº³æ³•å¯ä»¥åˆ¤æ–­åªæœ‰ä¸€åªç¾Šçš„æ—¶å€™ï¼Œå¶æ•°åªè€è™æƒ…å†µä¸‹ä¸åƒï¼Œè€Œå¥‡æ•°åªè€è™æƒ…å†µä¸‹å¯ä»¥åƒ\n\nå¼•å‡ºè¯¾é¢˜ `Dynamic Programming`\n\n# Dynamic Programming\n\n> ç®€å•çš„ç†è§£å°±æ˜¯ä»æœ€åŸºæœ¬çš„çš„æƒ…å†µå…¥æ‰‹é€æ¸å°†æ•´ä¸ªé—®é¢˜è§£å†³ï¼ŒåŠ¨æ€è§„åˆ’ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ç§æ¦‚å¿µ\n\n- æœ€ä¼˜å­ç»“æ„\n- è¾¹ç•Œ\n- çŠ¶æ€è½¬ç§»å…¬å¼\n\nä¸‹é¢ç”¨å¸¸è§çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆé»„é‡‘åˆ†å‰²æ•°åˆ—ã€å…”å­æ•°åˆ—ï¼‰æ¥å…·è±¡åŒ–é—®é¢˜\n\n_Fibonacciï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—æŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ— 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233ï¼Œ377ï¼Œ610ï¼Œ987ï¼Œ1597ï¼Œ2584ï¼Œ4181ï¼Œ6765ï¼Œ10946ï¼Œ17711ï¼Œ28657ï¼Œ46368........è¿™ä¸ªæ•°åˆ—ä»ç¬¬3é¡¹å¼€å§‹ï¼Œæ¯ä¸€é¡¹éƒ½ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œ_\n\nåœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)=1ï¼ŒF(2)=1, F(n)=F(n-1)+F(n-2)ï¼ˆn>=3ï¼ŒnâˆˆN*ï¼‰å› æ­¤å¯ä»¥ç›´æ¥å†™å‡ºä»¥ä¸‹ä»£ç ï¼š\n``` js\nfunction fn(n) {\n  if (n === 1 || n === 2){\n\t  return 1\n  }\n\n  return fn(n-1) + fn(n-2)\n}\n```\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n``` js\nconsole.log(\n  `ç¬¬1é¡¹${fn(1)}`,\n  `ç¬¬2é¡¹${fn(2)}`,\n  `ç¬¬3é¡¹${fn(3)}`,\n  `ç¬¬4é¡¹${fn(4)}`,\n  `ç¬¬5é¡¹${fn(5)}`,\n  `ç¬¬6é¡¹${fn(6)}`,\n  `ç¬¬7é¡¹${fn(7)}`\n)\n// VM455:1 ç¬¬1é¡¹1 ç¬¬2é¡¹1 ç¬¬3é¡¹2 ç¬¬4é¡¹3 ç¬¬5é¡¹5 ç¬¬6é¡¹8 ç¬¬7é¡¹13\n```\n\nç°åœ¨æ ¹æ®æ–æ³¢é‚£å¥‘æ•°åˆ—æ¥è§£é‡Šä¸Šé¢æå‡ºçš„ä¸‰ä¸ªåŠ¨æ€è§„åˆ’ç›¸å…³çš„æ¦‚å¿µ\n\n1. æœ€ä¼˜å­ç»“æ„ï¼šè‹¥æƒ³æ±‚å¾—ç¬¬ `m` é¡¹çš„å€¼ï¼Œé‚£ä¹ˆåªéœ€è¦å»æ±‚å¾—ç¬¬ `m-1` å’Œ `m-2` çš„å€¼å³å¯ï¼Œé‚£ä¹ˆ `fn(m-1) + fn(m-2) === f(m)` ç­‰å¼æˆç«‹\n2. è¾¹ç•Œ: å³èŒƒå›´\n3. çŠ¶æ€è½¬ç§»å…¬å¼ï¼š`f(m) = fn(m-1) + fn(m-2)`\n\nä¸Šé¢çš„æ–¹æ³•å…¶å®çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„é€’å½’ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nå…·è±¡åŒ–æ¥çœ‹ï¼š æ±‚å¾—f(5) = ï¼Ÿ\n - f(5)ä¾èµ– f(4)å’Œf(3)\n - f(4)ä¾èµ– f(3)å’Œf(2)\n - f(3)ä¾èµ– f(2)å’Œf(1)\n\næ˜¾ç„¶ä¸Šé¢çš„è®¡ç®—æœ‰ç€å¤§é‡çš„é‡å¤æ“ä½œï¼Œæ—¢ç„¶æ‰€æœ‰çš„ç»“æœéƒ½æ˜¯åŸºäºf(1)å’Œf(2), é‚£ä¹ˆä»f(1)å’Œf(2)çš„è®¡ç®—å¼€å§‹å°±é¿å…äº†é‡å¤çš„è®¡ç®—ï¼Œä¹Ÿæ˜¯å°±åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œ ä»£ç å¦‚ä¸‹ï¼š\n\n```js\nfunction fn(n) {\n  if (n === 1 || n === 2){\n\t  return 1\n  }\n\n  let m = 1, m_1 = 1, result\n\n  for(let i = 3; i <= n; i++){\n    result = m + m_1\n    m_1 = m\n    m = result\n  }\n\n  return result\n}\n```\n\nç»“æœå’Œä¸Šé¢æ˜¯ä¸€è‡´çš„ä½†æ˜¯æ€§èƒ½å°±ä¼šæœ‰éå¸¸å¤§çš„æå‡äº†\n\n# æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\n_é€’å½’ï¼š ç¨‹åºè°ƒç”¨è‡ªèº«çš„ç¼–ç¨‹æŠ€å·§ç§°ä¸ºé€’å½’ï¼ˆrecursionï¼‰_\n\né‚£ä¹ˆä¸Šé¢ `return fn(n-1) + fn(n-2)` å°±æ˜¯ä¸€ä¸ªæœ€æ™®é€šçš„é€’å½’\n\nè¿™é‡Œå†å¼•å…¥ä¸€ä¸ªå°¾é€’å½’çš„æ¦‚å¿µï¼šå°±æ˜¯å‡½æ•°åœ¨å°¾éƒ¨è°ƒç”¨è‡ªèº«\n\né‚£ä¸‹é¢æ¥ç®€å•è¯´è¯´ä¸ºä»€ä¹ˆä¸Šé¢é€’å½’çš„å†™æ³•æ€§èƒ½ä¼šé‚£ä¹ˆå·®\n\nè°ƒç”¨æ ˆéšç€nçš„å¢åŠ è€Œçº¿æ€§å¢åŠ å¾ˆå®¹æ˜“é€ æˆå†…å­˜å †æ ˆæº¢å‡ºã€‚è¿™æ˜¯å› ä¸ºè¿™ç§é€’å½’æ“ä½œä¸­ï¼ŒåŒæ—¶ä¿å­˜äº†å¤§é‡çš„æ ˆå¸§ï¼Œè°ƒç”¨æ ˆéå¸¸é•¿ï¼Œæ¶ˆè€—äº†å·¨å¤§çš„å†…å­˜\n\nå°†ä¸Šé¢æ–¹æ³•æ”¹ç”¨å°¾é€’å½’çš„å†™æ³•ï¼š\n```js\nfunction fn(n, m_1 = 1, m = 1) {  \n  if (n === 1 || n === 2) return m\n\n  return fn(n - 1, m, m + m_1)\n}\n```\næ­¤æ—¶fnæ¯æ¬¡é€’å½’ä»…ä»…æ›´æ–°è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œæ€§èƒ½å¾—åˆ°å¤§å¹…æå‡ğŸ‘\n\nå½“ç„¶æ‰€æœ‰çš„é€’å½’éƒ½å¯ä»¥ç”¨å¾ªç¯æ¥å®ç°ï¼Œä¸å°±é¿å…äº†å †æ ˆæº¢å‡ºçš„å¯èƒ½äº†å— å•Šå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ\n\n# summary\n\ndravenï¼šå¥½å¥½çœ‹ å¥½å¥½å­¦\n\n\n","source":"_posts/do something/åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹.md","raw":"---\ntitle: åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹\ntags:\n  - ç®—æ³•\n  - åŠ¨æ€è§„åˆ’\n  - é€’å½’\n  - å°¾é€’å½’\ndate: 2019-02-21 20:36:00\ncategories: ç®—æ³•\n---\n# é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\n\nè‰åŸä¸Šæœ‰ 1000 åªè€è™å’Œ 1 åªç¾Šï¼Œè€è™åƒç¾Šï¼Œç¾Šåƒè‰ï¼Œä½†æ˜¯è€è™åƒå®Œç¾Šä¼šå˜æˆç¾Šï¼ˆä¸€åªç¾Šåªèƒ½è¢«ä¸€åªè€è™åƒï¼‰\n\n_æç¤º:æ¯åªè€è™éƒ½å¾ˆèªæ˜_\n\n## ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\n\n#### case1: ä¸¤åªè€è™ä¸€åªç¾Š\n\nä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåå˜ä¸ºç¾Šä¼šè¢«å‰©ä¸‹çš„è€è™åƒ\n\n#### case2: ä¸‰åªè€è™ä¸€åªç¾Š\n\nåƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase1\n\n#### case3: å››åªè€è™ä¸€åªç¾Š\n\nä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase2ä¼šè¢«åƒ\n\n#### case4: äº”åªè€è™ä¸€åªç¾Š\n\nåƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase3\n\n.\n\n.\n\n.\n\n.\n\n.\n\n.\n\nç”±æœ€åŸºæœ¬çš„å½’çº³æ³•å¯ä»¥åˆ¤æ–­åªæœ‰ä¸€åªç¾Šçš„æ—¶å€™ï¼Œå¶æ•°åªè€è™æƒ…å†µä¸‹ä¸åƒï¼Œè€Œå¥‡æ•°åªè€è™æƒ…å†µä¸‹å¯ä»¥åƒ\n\nå¼•å‡ºè¯¾é¢˜ `Dynamic Programming`\n\n# Dynamic Programming\n\n> ç®€å•çš„ç†è§£å°±æ˜¯ä»æœ€åŸºæœ¬çš„çš„æƒ…å†µå…¥æ‰‹é€æ¸å°†æ•´ä¸ªé—®é¢˜è§£å†³ï¼ŒåŠ¨æ€è§„åˆ’ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ç§æ¦‚å¿µ\n\n- æœ€ä¼˜å­ç»“æ„\n- è¾¹ç•Œ\n- çŠ¶æ€è½¬ç§»å…¬å¼\n\nä¸‹é¢ç”¨å¸¸è§çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆé»„é‡‘åˆ†å‰²æ•°åˆ—ã€å…”å­æ•°åˆ—ï¼‰æ¥å…·è±¡åŒ–é—®é¢˜\n\n_Fibonacciï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—æŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ— 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233ï¼Œ377ï¼Œ610ï¼Œ987ï¼Œ1597ï¼Œ2584ï¼Œ4181ï¼Œ6765ï¼Œ10946ï¼Œ17711ï¼Œ28657ï¼Œ46368........è¿™ä¸ªæ•°åˆ—ä»ç¬¬3é¡¹å¼€å§‹ï¼Œæ¯ä¸€é¡¹éƒ½ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œ_\n\nåœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)=1ï¼ŒF(2)=1, F(n)=F(n-1)+F(n-2)ï¼ˆn>=3ï¼ŒnâˆˆN*ï¼‰å› æ­¤å¯ä»¥ç›´æ¥å†™å‡ºä»¥ä¸‹ä»£ç ï¼š\n``` js\nfunction fn(n) {\n  if (n === 1 || n === 2){\n\t  return 1\n  }\n\n  return fn(n-1) + fn(n-2)\n}\n```\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n``` js\nconsole.log(\n  `ç¬¬1é¡¹${fn(1)}`,\n  `ç¬¬2é¡¹${fn(2)}`,\n  `ç¬¬3é¡¹${fn(3)}`,\n  `ç¬¬4é¡¹${fn(4)}`,\n  `ç¬¬5é¡¹${fn(5)}`,\n  `ç¬¬6é¡¹${fn(6)}`,\n  `ç¬¬7é¡¹${fn(7)}`\n)\n// VM455:1 ç¬¬1é¡¹1 ç¬¬2é¡¹1 ç¬¬3é¡¹2 ç¬¬4é¡¹3 ç¬¬5é¡¹5 ç¬¬6é¡¹8 ç¬¬7é¡¹13\n```\n\nç°åœ¨æ ¹æ®æ–æ³¢é‚£å¥‘æ•°åˆ—æ¥è§£é‡Šä¸Šé¢æå‡ºçš„ä¸‰ä¸ªåŠ¨æ€è§„åˆ’ç›¸å…³çš„æ¦‚å¿µ\n\n1. æœ€ä¼˜å­ç»“æ„ï¼šè‹¥æƒ³æ±‚å¾—ç¬¬ `m` é¡¹çš„å€¼ï¼Œé‚£ä¹ˆåªéœ€è¦å»æ±‚å¾—ç¬¬ `m-1` å’Œ `m-2` çš„å€¼å³å¯ï¼Œé‚£ä¹ˆ `fn(m-1) + fn(m-2) === f(m)` ç­‰å¼æˆç«‹\n2. è¾¹ç•Œ: å³èŒƒå›´\n3. çŠ¶æ€è½¬ç§»å…¬å¼ï¼š`f(m) = fn(m-1) + fn(m-2)`\n\nä¸Šé¢çš„æ–¹æ³•å…¶å®çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„é€’å½’ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nå…·è±¡åŒ–æ¥çœ‹ï¼š æ±‚å¾—f(5) = ï¼Ÿ\n - f(5)ä¾èµ– f(4)å’Œf(3)\n - f(4)ä¾èµ– f(3)å’Œf(2)\n - f(3)ä¾èµ– f(2)å’Œf(1)\n\næ˜¾ç„¶ä¸Šé¢çš„è®¡ç®—æœ‰ç€å¤§é‡çš„é‡å¤æ“ä½œï¼Œæ—¢ç„¶æ‰€æœ‰çš„ç»“æœéƒ½æ˜¯åŸºäºf(1)å’Œf(2), é‚£ä¹ˆä»f(1)å’Œf(2)çš„è®¡ç®—å¼€å§‹å°±é¿å…äº†é‡å¤çš„è®¡ç®—ï¼Œä¹Ÿæ˜¯å°±åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œ ä»£ç å¦‚ä¸‹ï¼š\n\n```js\nfunction fn(n) {\n  if (n === 1 || n === 2){\n\t  return 1\n  }\n\n  let m = 1, m_1 = 1, result\n\n  for(let i = 3; i <= n; i++){\n    result = m + m_1\n    m_1 = m\n    m = result\n  }\n\n  return result\n}\n```\n\nç»“æœå’Œä¸Šé¢æ˜¯ä¸€è‡´çš„ä½†æ˜¯æ€§èƒ½å°±ä¼šæœ‰éå¸¸å¤§çš„æå‡äº†\n\n# æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\n_é€’å½’ï¼š ç¨‹åºè°ƒç”¨è‡ªèº«çš„ç¼–ç¨‹æŠ€å·§ç§°ä¸ºé€’å½’ï¼ˆrecursionï¼‰_\n\né‚£ä¹ˆä¸Šé¢ `return fn(n-1) + fn(n-2)` å°±æ˜¯ä¸€ä¸ªæœ€æ™®é€šçš„é€’å½’\n\nè¿™é‡Œå†å¼•å…¥ä¸€ä¸ªå°¾é€’å½’çš„æ¦‚å¿µï¼šå°±æ˜¯å‡½æ•°åœ¨å°¾éƒ¨è°ƒç”¨è‡ªèº«\n\né‚£ä¸‹é¢æ¥ç®€å•è¯´è¯´ä¸ºä»€ä¹ˆä¸Šé¢é€’å½’çš„å†™æ³•æ€§èƒ½ä¼šé‚£ä¹ˆå·®\n\nè°ƒç”¨æ ˆéšç€nçš„å¢åŠ è€Œçº¿æ€§å¢åŠ å¾ˆå®¹æ˜“é€ æˆå†…å­˜å †æ ˆæº¢å‡ºã€‚è¿™æ˜¯å› ä¸ºè¿™ç§é€’å½’æ“ä½œä¸­ï¼ŒåŒæ—¶ä¿å­˜äº†å¤§é‡çš„æ ˆå¸§ï¼Œè°ƒç”¨æ ˆéå¸¸é•¿ï¼Œæ¶ˆè€—äº†å·¨å¤§çš„å†…å­˜\n\nå°†ä¸Šé¢æ–¹æ³•æ”¹ç”¨å°¾é€’å½’çš„å†™æ³•ï¼š\n```js\nfunction fn(n, m_1 = 1, m = 1) {  \n  if (n === 1 || n === 2) return m\n\n  return fn(n - 1, m, m + m_1)\n}\n```\næ­¤æ—¶fnæ¯æ¬¡é€’å½’ä»…ä»…æ›´æ–°è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œæ€§èƒ½å¾—åˆ°å¤§å¹…æå‡ğŸ‘\n\nå½“ç„¶æ‰€æœ‰çš„é€’å½’éƒ½å¯ä»¥ç”¨å¾ªç¯æ¥å®ç°ï¼Œä¸å°±é¿å…äº†å †æ ˆæº¢å‡ºçš„å¯èƒ½äº†å— å•Šå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ\n\n# summary\n\ndravenï¼šå¥½å¥½çœ‹ å¥½å¥½å­¦\n\n\n","slug":"do something/åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹","published":1,"updated":"2019-02-23T04:36:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsh7ugh2000364va0kwaywl5","content":"<h1 id=\"é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\"><a href=\"#é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\" class=\"headerlink\" title=\"é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\"></a>é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘</h1><p>è‰åŸä¸Šæœ‰ 1000 åªè€è™å’Œ 1 åªç¾Šï¼Œè€è™åƒç¾Šï¼Œç¾Šåƒè‰ï¼Œä½†æ˜¯è€è™åƒå®Œç¾Šä¼šå˜æˆç¾Šï¼ˆä¸€åªç¾Šåªèƒ½è¢«ä¸€åªè€è™åƒï¼‰</p>\n<p><em>æç¤º:æ¯åªè€è™éƒ½å¾ˆèªæ˜</em></p>\n<h2 id=\"ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\"><a href=\"#ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\" class=\"headerlink\" title=\"ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\"></a>ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹</h2><h4 id=\"case1-ä¸¤åªè€è™ä¸€åªç¾Š\"><a href=\"#case1-ä¸¤åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case1: ä¸¤åªè€è™ä¸€åªç¾Š\"></a>case1: ä¸¤åªè€è™ä¸€åªç¾Š</h4><p>ä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåå˜ä¸ºç¾Šä¼šè¢«å‰©ä¸‹çš„è€è™åƒ</p>\n<h4 id=\"case2-ä¸‰åªè€è™ä¸€åªç¾Š\"><a href=\"#case2-ä¸‰åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case2: ä¸‰åªè€è™ä¸€åªç¾Š\"></a>case2: ä¸‰åªè€è™ä¸€åªç¾Š</h4><p>åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase1</p>\n<h4 id=\"case3-å››åªè€è™ä¸€åªç¾Š\"><a href=\"#case3-å››åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case3: å››åªè€è™ä¸€åªç¾Š\"></a>case3: å››åªè€è™ä¸€åªç¾Š</h4><p>ä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase2ä¼šè¢«åƒ</p>\n<h4 id=\"case4-äº”åªè€è™ä¸€åªç¾Š\"><a href=\"#case4-äº”åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case4: äº”åªè€è™ä¸€åªç¾Š\"></a>case4: äº”åªè€è™ä¸€åªç¾Š</h4><p>åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase3</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>ç”±æœ€åŸºæœ¬çš„å½’çº³æ³•å¯ä»¥åˆ¤æ–­åªæœ‰ä¸€åªç¾Šçš„æ—¶å€™ï¼Œå¶æ•°åªè€è™æƒ…å†µä¸‹ä¸åƒï¼Œè€Œå¥‡æ•°åªè€è™æƒ…å†µä¸‹å¯ä»¥åƒ</p>\n<p>å¼•å‡ºè¯¾é¢˜ <code>Dynamic Programming</code></p>\n<h1 id=\"Dynamic-Programming\"><a href=\"#Dynamic-Programming\" class=\"headerlink\" title=\"Dynamic Programming\"></a>Dynamic Programming</h1><blockquote>\n<p>ç®€å•çš„ç†è§£å°±æ˜¯ä»æœ€åŸºæœ¬çš„çš„æƒ…å†µå…¥æ‰‹é€æ¸å°†æ•´ä¸ªé—®é¢˜è§£å†³ï¼ŒåŠ¨æ€è§„åˆ’ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ç§æ¦‚å¿µ</p>\n</blockquote>\n<ul>\n<li>æœ€ä¼˜å­ç»“æ„</li>\n<li>è¾¹ç•Œ</li>\n<li>çŠ¶æ€è½¬ç§»å…¬å¼</li>\n</ul>\n<p>ä¸‹é¢ç”¨å¸¸è§çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆé»„é‡‘åˆ†å‰²æ•°åˆ—ã€å…”å­æ•°åˆ—ï¼‰æ¥å…·è±¡åŒ–é—®é¢˜</p>\n<p><em>Fibonacciï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—æŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ— 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233ï¼Œ377ï¼Œ610ï¼Œ987ï¼Œ1597ï¼Œ2584ï¼Œ4181ï¼Œ6765ï¼Œ10946ï¼Œ17711ï¼Œ28657ï¼Œ46368â€¦â€¦..è¿™ä¸ªæ•°åˆ—ä»ç¬¬3é¡¹å¼€å§‹ï¼Œæ¯ä¸€é¡¹éƒ½ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œ</em></p>\n<p>åœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)=1ï¼ŒF(2)=1, F(n)=F(n-1)+F(n-2)ï¼ˆn&gt;=3ï¼ŒnâˆˆN*ï¼‰å› æ­¤å¯ä»¥ç›´æ¥å†™å‡ºä»¥ä¸‹ä»£ç ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span> || n === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">\t  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn(n<span class=\"number\">-1</span>) + fn(n<span class=\"number\">-2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬1é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">1</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬2é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">2</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬3é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">3</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬4é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">4</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬5é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">5</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬6é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">6</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬7é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">7</span>)&#125;</span>`</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"comment\">// VM455:1 ç¬¬1é¡¹1 ç¬¬2é¡¹1 ç¬¬3é¡¹2 ç¬¬4é¡¹3 ç¬¬5é¡¹5 ç¬¬6é¡¹8 ç¬¬7é¡¹13</span></span><br></pre></td></tr></table></figure></p>\n<p>ç°åœ¨æ ¹æ®æ–æ³¢é‚£å¥‘æ•°åˆ—æ¥è§£é‡Šä¸Šé¢æå‡ºçš„ä¸‰ä¸ªåŠ¨æ€è§„åˆ’ç›¸å…³çš„æ¦‚å¿µ</p>\n<ol>\n<li>æœ€ä¼˜å­ç»“æ„ï¼šè‹¥æƒ³æ±‚å¾—ç¬¬ <code>m</code> é¡¹çš„å€¼ï¼Œé‚£ä¹ˆåªéœ€è¦å»æ±‚å¾—ç¬¬ <code>m-1</code> å’Œ <code>m-2</code> çš„å€¼å³å¯ï¼Œé‚£ä¹ˆ <code>fn(m-1) + fn(m-2) === f(m)</code> ç­‰å¼æˆç«‹</li>\n<li>è¾¹ç•Œ: å³èŒƒå›´</li>\n<li>çŠ¶æ€è½¬ç§»å…¬å¼ï¼š<code>f(m) = fn(m-1) + fn(m-2)</code></li>\n</ol>\n<p>ä¸Šé¢çš„æ–¹æ³•å…¶å®çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„é€’å½’ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>å…·è±¡åŒ–æ¥çœ‹ï¼š æ±‚å¾—f(5) = ï¼Ÿ</p>\n<ul>\n<li>f(5)ä¾èµ– f(4)å’Œf(3)</li>\n<li>f(4)ä¾èµ– f(3)å’Œf(2)</li>\n<li>f(3)ä¾èµ– f(2)å’Œf(1)</li>\n</ul>\n<p>æ˜¾ç„¶ä¸Šé¢çš„è®¡ç®—æœ‰ç€å¤§é‡çš„é‡å¤æ“ä½œï¼Œæ—¢ç„¶æ‰€æœ‰çš„ç»“æœéƒ½æ˜¯åŸºäºf(1)å’Œf(2), é‚£ä¹ˆä»f(1)å’Œf(2)çš„è®¡ç®—å¼€å§‹å°±é¿å…äº†é‡å¤çš„è®¡ç®—ï¼Œä¹Ÿæ˜¯å°±åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œ ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span> || n === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">\t  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> m = <span class=\"number\">1</span>, m_1 = <span class=\"number\">1</span>, result</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">3</span>; i &lt;= n; i++)&#123;</span><br><span class=\"line\">    result = m + m_1</span><br><span class=\"line\">    m_1 = m</span><br><span class=\"line\">    m = result</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç»“æœå’Œä¸Šé¢æ˜¯ä¸€è‡´çš„ä½†æ˜¯æ€§èƒ½å°±ä¼šæœ‰éå¸¸å¤§çš„æå‡äº†</p>\n<h1 id=\"æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\"><a href=\"#æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\" class=\"headerlink\" title=\"æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\"></a>æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’</h1><p><em>é€’å½’ï¼š ç¨‹åºè°ƒç”¨è‡ªèº«çš„ç¼–ç¨‹æŠ€å·§ç§°ä¸ºé€’å½’ï¼ˆrecursionï¼‰</em></p>\n<p>é‚£ä¹ˆä¸Šé¢ <code>return fn(n-1) + fn(n-2)</code> å°±æ˜¯ä¸€ä¸ªæœ€æ™®é€šçš„é€’å½’</p>\n<p>è¿™é‡Œå†å¼•å…¥ä¸€ä¸ªå°¾é€’å½’çš„æ¦‚å¿µï¼šå°±æ˜¯å‡½æ•°åœ¨å°¾éƒ¨è°ƒç”¨è‡ªèº«</p>\n<p>é‚£ä¸‹é¢æ¥ç®€å•è¯´è¯´ä¸ºä»€ä¹ˆä¸Šé¢é€’å½’çš„å†™æ³•æ€§èƒ½ä¼šé‚£ä¹ˆå·®</p>\n<p>è°ƒç”¨æ ˆéšç€nçš„å¢åŠ è€Œçº¿æ€§å¢åŠ å¾ˆå®¹æ˜“é€ æˆå†…å­˜å †æ ˆæº¢å‡ºã€‚è¿™æ˜¯å› ä¸ºè¿™ç§é€’å½’æ“ä½œä¸­ï¼ŒåŒæ—¶ä¿å­˜äº†å¤§é‡çš„æ ˆå¸§ï¼Œè°ƒç”¨æ ˆéå¸¸é•¿ï¼Œæ¶ˆè€—äº†å·¨å¤§çš„å†…å­˜</p>\n<p>å°†ä¸Šé¢æ–¹æ³•æ”¹ç”¨å°¾é€’å½’çš„å†™æ³•ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">n, m_1 = <span class=\"number\">1</span>, m = <span class=\"number\">1</span></span>) </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span> || n === <span class=\"number\">2</span>) <span class=\"keyword\">return</span> m</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn(n - <span class=\"number\">1</span>, m, m + m_1)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>æ­¤æ—¶fnæ¯æ¬¡é€’å½’ä»…ä»…æ›´æ–°è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œæ€§èƒ½å¾—åˆ°å¤§å¹…æå‡ğŸ‘</p>\n<p>å½“ç„¶æ‰€æœ‰çš„é€’å½’éƒ½å¯ä»¥ç”¨å¾ªç¯æ¥å®ç°ï¼Œä¸å°±é¿å…äº†å †æ ˆæº¢å‡ºçš„å¯èƒ½äº†å— å•Šå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ</p>\n<h1 id=\"summary\"><a href=\"#summary\" class=\"headerlink\" title=\"summary\"></a>summary</h1><p>dravenï¼šå¥½å¥½çœ‹ å¥½å¥½å­¦</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\"><a href=\"#é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\" class=\"headerlink\" title=\"é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘\"></a>é—®é¢˜ï¼šè€è™ä¼šåƒç¾Šå—ï¼ŸğŸ…ğŸ‘</h1><p>è‰åŸä¸Šæœ‰ 1000 åªè€è™å’Œ 1 åªç¾Šï¼Œè€è™åƒç¾Šï¼Œç¾Šåƒè‰ï¼Œä½†æ˜¯è€è™åƒå®Œç¾Šä¼šå˜æˆç¾Šï¼ˆä¸€åªç¾Šåªèƒ½è¢«ä¸€åªè€è™åƒï¼‰</p>\n<p><em>æç¤º:æ¯åªè€è™éƒ½å¾ˆèªæ˜</em></p>\n<h2 id=\"ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\"><a href=\"#ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\" class=\"headerlink\" title=\"ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹\"></a>ä»æœ€åŸºæœ¬çš„æƒ…å†µå…¥æ‰‹</h2><h4 id=\"case1-ä¸¤åªè€è™ä¸€åªç¾Š\"><a href=\"#case1-ä¸¤åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case1: ä¸¤åªè€è™ä¸€åªç¾Š\"></a>case1: ä¸¤åªè€è™ä¸€åªç¾Š</h4><p>ä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåå˜ä¸ºç¾Šä¼šè¢«å‰©ä¸‹çš„è€è™åƒ</p>\n<h4 id=\"case2-ä¸‰åªè€è™ä¸€åªç¾Š\"><a href=\"#case2-ä¸‰åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case2: ä¸‰åªè€è™ä¸€åªç¾Š\"></a>case2: ä¸‰åªè€è™ä¸€åªç¾Š</h4><p>åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase1</p>\n<h4 id=\"case3-å››åªè€è™ä¸€åªç¾Š\"><a href=\"#case3-å››åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case3: å››åªè€è™ä¸€åªç¾Š\"></a>case3: å››åªè€è™ä¸€åªç¾Š</h4><p>ä¸åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase2ä¼šè¢«åƒ</p>\n<h4 id=\"case4-äº”åªè€è™ä¸€åªç¾Š\"><a href=\"#case4-äº”åªè€è™ä¸€åªç¾Š\" class=\"headerlink\" title=\"case4: äº”åªè€è™ä¸€åªç¾Š\"></a>case4: äº”åªè€è™ä¸€åªç¾Š</h4><p>åƒï¼šä¸€åªè€è™åƒå®Œç¾Šåæƒ…æ™¯å˜ä¸ºcase3</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>ç”±æœ€åŸºæœ¬çš„å½’çº³æ³•å¯ä»¥åˆ¤æ–­åªæœ‰ä¸€åªç¾Šçš„æ—¶å€™ï¼Œå¶æ•°åªè€è™æƒ…å†µä¸‹ä¸åƒï¼Œè€Œå¥‡æ•°åªè€è™æƒ…å†µä¸‹å¯ä»¥åƒ</p>\n<p>å¼•å‡ºè¯¾é¢˜ <code>Dynamic Programming</code></p>\n<h1 id=\"Dynamic-Programming\"><a href=\"#Dynamic-Programming\" class=\"headerlink\" title=\"Dynamic Programming\"></a>Dynamic Programming</h1><blockquote>\n<p>ç®€å•çš„ç†è§£å°±æ˜¯ä»æœ€åŸºæœ¬çš„çš„æƒ…å†µå…¥æ‰‹é€æ¸å°†æ•´ä¸ªé—®é¢˜è§£å†³ï¼ŒåŠ¨æ€è§„åˆ’ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ç§æ¦‚å¿µ</p>\n</blockquote>\n<ul>\n<li>æœ€ä¼˜å­ç»“æ„</li>\n<li>è¾¹ç•Œ</li>\n<li>çŠ¶æ€è½¬ç§»å…¬å¼</li>\n</ul>\n<p>ä¸‹é¢ç”¨å¸¸è§çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆé»„é‡‘åˆ†å‰²æ•°åˆ—ã€å…”å­æ•°åˆ—ï¼‰æ¥å…·è±¡åŒ–é—®é¢˜</p>\n<p><em>Fibonacciï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—æŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ— 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233ï¼Œ377ï¼Œ610ï¼Œ987ï¼Œ1597ï¼Œ2584ï¼Œ4181ï¼Œ6765ï¼Œ10946ï¼Œ17711ï¼Œ28657ï¼Œ46368â€¦â€¦..è¿™ä¸ªæ•°åˆ—ä»ç¬¬3é¡¹å¼€å§‹ï¼Œæ¯ä¸€é¡¹éƒ½ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œ</em></p>\n<p>åœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢çº³å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)=1ï¼ŒF(2)=1, F(n)=F(n-1)+F(n-2)ï¼ˆn&gt;=3ï¼ŒnâˆˆN*ï¼‰å› æ­¤å¯ä»¥ç›´æ¥å†™å‡ºä»¥ä¸‹ä»£ç ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span> || n === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">\t  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn(n<span class=\"number\">-1</span>) + fn(n<span class=\"number\">-2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬1é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">1</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬2é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">2</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬3é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">3</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬4é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">4</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬5é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">5</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬6é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">6</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  <span class=\"string\">`ç¬¬7é¡¹<span class=\"subst\">$&#123;fn(<span class=\"number\">7</span>)&#125;</span>`</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"comment\">// VM455:1 ç¬¬1é¡¹1 ç¬¬2é¡¹1 ç¬¬3é¡¹2 ç¬¬4é¡¹3 ç¬¬5é¡¹5 ç¬¬6é¡¹8 ç¬¬7é¡¹13</span></span><br></pre></td></tr></table></figure></p>\n<p>ç°åœ¨æ ¹æ®æ–æ³¢é‚£å¥‘æ•°åˆ—æ¥è§£é‡Šä¸Šé¢æå‡ºçš„ä¸‰ä¸ªåŠ¨æ€è§„åˆ’ç›¸å…³çš„æ¦‚å¿µ</p>\n<ol>\n<li>æœ€ä¼˜å­ç»“æ„ï¼šè‹¥æƒ³æ±‚å¾—ç¬¬ <code>m</code> é¡¹çš„å€¼ï¼Œé‚£ä¹ˆåªéœ€è¦å»æ±‚å¾—ç¬¬ <code>m-1</code> å’Œ <code>m-2</code> çš„å€¼å³å¯ï¼Œé‚£ä¹ˆ <code>fn(m-1) + fn(m-2) === f(m)</code> ç­‰å¼æˆç«‹</li>\n<li>è¾¹ç•Œ: å³èŒƒå›´</li>\n<li>çŠ¶æ€è½¬ç§»å…¬å¼ï¼š<code>f(m) = fn(m-1) + fn(m-2)</code></li>\n</ol>\n<p>ä¸Šé¢çš„æ–¹æ³•å…¶å®çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„é€’å½’ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>å…·è±¡åŒ–æ¥çœ‹ï¼š æ±‚å¾—f(5) = ï¼Ÿ</p>\n<ul>\n<li>f(5)ä¾èµ– f(4)å’Œf(3)</li>\n<li>f(4)ä¾èµ– f(3)å’Œf(2)</li>\n<li>f(3)ä¾èµ– f(2)å’Œf(1)</li>\n</ul>\n<p>æ˜¾ç„¶ä¸Šé¢çš„è®¡ç®—æœ‰ç€å¤§é‡çš„é‡å¤æ“ä½œï¼Œæ—¢ç„¶æ‰€æœ‰çš„ç»“æœéƒ½æ˜¯åŸºäºf(1)å’Œf(2), é‚£ä¹ˆä»f(1)å’Œf(2)çš„è®¡ç®—å¼€å§‹å°±é¿å…äº†é‡å¤çš„è®¡ç®—ï¼Œä¹Ÿæ˜¯å°±åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œ ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span> || n === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">\t  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> m = <span class=\"number\">1</span>, m_1 = <span class=\"number\">1</span>, result</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">3</span>; i &lt;= n; i++)&#123;</span><br><span class=\"line\">    result = m + m_1</span><br><span class=\"line\">    m_1 = m</span><br><span class=\"line\">    m = result</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç»“æœå’Œä¸Šé¢æ˜¯ä¸€è‡´çš„ä½†æ˜¯æ€§èƒ½å°±ä¼šæœ‰éå¸¸å¤§çš„æå‡äº†</p>\n<h1 id=\"æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\"><a href=\"#æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\" class=\"headerlink\" title=\"æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’\"></a>æ—¢ç„¶ä¸Šé¢æåˆ°äº†é€’å½’æˆ‘ä»¬å°±å†æ¥è¯´è¯´é€’å½’</h1><p><em>é€’å½’ï¼š ç¨‹åºè°ƒç”¨è‡ªèº«çš„ç¼–ç¨‹æŠ€å·§ç§°ä¸ºé€’å½’ï¼ˆrecursionï¼‰</em></p>\n<p>é‚£ä¹ˆä¸Šé¢ <code>return fn(n-1) + fn(n-2)</code> å°±æ˜¯ä¸€ä¸ªæœ€æ™®é€šçš„é€’å½’</p>\n<p>è¿™é‡Œå†å¼•å…¥ä¸€ä¸ªå°¾é€’å½’çš„æ¦‚å¿µï¼šå°±æ˜¯å‡½æ•°åœ¨å°¾éƒ¨è°ƒç”¨è‡ªèº«</p>\n<p>é‚£ä¸‹é¢æ¥ç®€å•è¯´è¯´ä¸ºä»€ä¹ˆä¸Šé¢é€’å½’çš„å†™æ³•æ€§èƒ½ä¼šé‚£ä¹ˆå·®</p>\n<p>è°ƒç”¨æ ˆéšç€nçš„å¢åŠ è€Œçº¿æ€§å¢åŠ å¾ˆå®¹æ˜“é€ æˆå†…å­˜å †æ ˆæº¢å‡ºã€‚è¿™æ˜¯å› ä¸ºè¿™ç§é€’å½’æ“ä½œä¸­ï¼ŒåŒæ—¶ä¿å­˜äº†å¤§é‡çš„æ ˆå¸§ï¼Œè°ƒç”¨æ ˆéå¸¸é•¿ï¼Œæ¶ˆè€—äº†å·¨å¤§çš„å†…å­˜</p>\n<p>å°†ä¸Šé¢æ–¹æ³•æ”¹ç”¨å°¾é€’å½’çš„å†™æ³•ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">n, m_1 = <span class=\"number\">1</span>, m = <span class=\"number\">1</span></span>) </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span> || n === <span class=\"number\">2</span>) <span class=\"keyword\">return</span> m</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn(n - <span class=\"number\">1</span>, m, m + m_1)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>æ­¤æ—¶fnæ¯æ¬¡é€’å½’ä»…ä»…æ›´æ–°è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œæ€§èƒ½å¾—åˆ°å¤§å¹…æå‡ğŸ‘</p>\n<p>å½“ç„¶æ‰€æœ‰çš„é€’å½’éƒ½å¯ä»¥ç”¨å¾ªç¯æ¥å®ç°ï¼Œä¸å°±é¿å…äº†å †æ ˆæº¢å‡ºçš„å¯èƒ½äº†å— å•Šå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ</p>\n<h1 id=\"summary\"><a href=\"#summary\" class=\"headerlink\" title=\"summary\"></a>summary</h1><p>dravenï¼šå¥½å¥½çœ‹ å¥½å¥½å­¦</p>\n"},{"title":"åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹","date":"2019-02-22T11:00:00.000Z","_content":"\n\n# åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\n\n#### å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\n![avatar](/onion.png)\n\nkoa2ä¸Šç‹¬ç‰¹çš„ä¸­é—´ä»¶æµç¨‹æ§åˆ¶ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„æ´‹è‘±æ¨¡å‹\n\n# å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\n```js\nconst Koa = require('koa2')\n\nconst app = new Koa()\n\napp.use(async (ctx, next)=>{\n    console.log(1, ' start')\n    await next()\n    console.log(1, ' end')\n})\n\napp.use(async (ctx, next) => {\n    console.log(2, ' start')\n    await next()\n    console.log(2, ' end')\n})\napp.use(async (ctx, next) => {\n    console.log(3, ' start')\n    await next()\n    console.log(3, ' end')\n})\n\napp.listen(3000)\n```\nè¾“å‡ºç»“æœï¼š\n```bash\n1 start\n2 start\n3 start\n3 end\n2 end\n1 end\n```\n\nå±•ç°å¦‚ä¸Šå›¾æ´‹è‘±å¼çš„è¾“å‡ºç»“æœ\n\n# å½’çº³å¾—å‡ºç»“è®º\n\næ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å°è£…ï¼Œè¦æƒ³è¾¾æˆæ´‹è‘±æ¨¡å‹å¼çš„æµç¨‹æ§åˆ¶ï¼Œä¸»è¦çœ‹ä¸Šé¢demoä¸­ callback çš„ç¬¬äºŒä¸ªå‚æ•° next æ–¹æ³•ï¼ˆctxæš‚æ—¶å’Œæœ¬æ–‡å†…å®¹æ— å…³ï¼‰ï¼Œä¸€æ­¥ä¸€æ­¥æ¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ€è€ƒï¼š\n- é¦–å…ˆå˜ä¸ºæœ€ç®€caseï¼šåªæœ‰ä¸¤ä¸ªä¸­é—´ä»¶å‡½æ•°\n- é‚£ä¹ˆå¦‚æœæƒ³è¦ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œnextæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬è‹¥æ˜¯æŠŠnextæ–¹æ³•æœ¬èº«å°±æ˜¯ä½œä¸ºç¬¬äºŒä¸ªä¸­é—´ä»¶å‡½æ•°è¿›è¡Œè°ƒç”¨å°±ä¼šå¾—åˆ° `1 start -> 2 start -> 2 end -> 1 end` çš„ç»“æœ\n- åŒç†å¦‚æœæ˜¯ä¸‰ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ç¬¬ä¸‰ä¸ªä¸­é—´ä»¶å½“åšç¬¬äºŒä¸ªä¸­é—´ä»¶çš„ next æ–¹æ³•ï¼Œå†æŠŠç¬¬äºŒä¸ªä¸­é—´ä»¶å½“åšç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„ next å›è°ƒ\n\n.\n\n.\n\n.\n\n.\n\n.\n\n.\nå’Œä¹‹å‰çš„ä¸€ç¯‡ [åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹](http://localhost:4000/2019/02/21/do%20something/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E5%92%8C%E9%80%92%E5%BD%92%EF%BC%9A%E4%BB%8E%E8%99%8E%E7%BE%8A%E8%8D%89%E5%BC%80%E5%A7%8B/#%E4%BB%8E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%83%85%E5%86%B5%E5%85%A5%E6%89%8B) ç±»ä¼¼è¿›è¡Œç®€å•çš„å½’çº³ä¹‹åå¾—å‡ºæ€è·¯ï¼Œæœ€å…³é”®çš„æµç¨‹æ§åˆ¶é—®é¢˜æ—¢ç„¶æœ‰äº†æ€è·¯ä¸‹é¢å¼€å§‹å°è£…ä»£ç \n\n# ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\n\nç¬¬ä¸€æ­¥ï¼šé¦–å…ˆæ„é€ ä¸€ä¸ªåŸºæœ¬çš„Appæ„é€ ç±»è¿›è¡Œæ–¹æ³•æŒ‚è½½ä¾èµ–æ”¶é›†ç­‰, æ‹¥æœ‰ä¸€ä¸ª use æ–¹æ³•å¯¹ä¸­é—´ä»¶å‡½æ•°è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå»ºç«‹ä¸€ä¸ªå­˜å‚¨æ ˆ middleware ç”¨æ¥å­˜æ”¾æ”¶é›†çš„ä¾èµ–ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```js\nclass App {\n  constructor() {\n    this.middleware = []\n  }\n  use(fn) {\n    this.middleware.push(fn)\n  }\n}\n```\n\nç¬¬äºŒæ­¥ï¼šæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ª compose å‡½æ•° å¯¹æ”¶é›†åˆ°çš„ä¾èµ–è¿›è¡Œå¤„ç†ï¼Œå‚æ•°æ˜¯æ”¶é›†çš„ä¾èµ–æ ˆï¼Œè¿”å›ä¸€ä¸ªé€šè¿‡ä¸€å±‚å±‚ä¸­é—´ä»¶å‡½æ•°åŒ…è£…çš„æ–°å‡½æ•°ï¼Œæ•°ç»„æœ‰ä¸ª reduce æ–¹æ³•å¯ä»¥å¾ˆè½»æ˜“çš„å¸®æˆ‘ä»¬åšåˆ°è¿™ä»¶äº‹æƒ…ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯éœ€è¦æŒ‰ç…§æ”¶é›†çš„ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œæ¯ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„å½’çº³å¦‚æœæŒ‰1 -> 2 -> 3çš„æµç¨‹é¡ºåºéå†æ˜¾ç„¶å°±ä¼šå°†æœ€æ—©æ”¶é›†çš„ä¾èµ–åŒ…è£…åœ¨æœ€å†…å±‚ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æœ‰ reduceRightğŸ˜„ï¼Œ ä»£ç å¦‚ä¸‹ï¼š\n```js\nconst compose = middlewares =>\n  middlewares.reduceRight((oldNext, fn) =>\n    createNext(fn, oldNext), async () => Promise.resolve())\n```\n\nç¬¬ä¸‰æ­¥ï¼šæ˜¾ç„¶æ¥ä¸‹æ¥æœ€å…³é”®çš„å°±æ˜¯å¯¹ä¸Šé¢ compose å‡½æ•°ä¸­çš„ createNext æ–¹æ³•è¿›è¡Œå°è£…ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸Šé¢å·²ç»è¯´è¿‡ï¼Œnextæ–¹æ³•æ˜¯å¯¹ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°çš„å¤„ç†ï¼Œä¸€ä¸ªå‚æ•°æ˜¯ä¸­é—´ä»¶å‡½æ•°ï¼Œè€Œå¦ä¸€ä¸ªæ˜¾ç„¶å°±æ˜¯é‚£ä¸ªnextæ–¹æ³•ï¼ŒåŒ…è£…è°ƒç”¨åè¿”å›ä¸€ä¸ªæ–°çš„nextå‡½æ•°ä¼ é€’åˆ°ä¸‹ä¸€å±‚åŒ…è£…ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```js\nconst createNext = (middleware, oldNext) =>\n  async () =>\n    await middleware(oldNext)\n```\n\nä»¥ä¸ŠåŸºæœ¬çš„å°è£…å·²ç»å®Œæˆï¼Œæ ¸å¿ƒä»£ç åªæœ‰ middlewares å’Œ createNext ä¸¤ä¸ªå‡½æ•°ï¼Œåªæœ‰6è¡Œï¼Œä¸‹é¢å¯¹ä¸Šé¢æ•´ä¸ªæµç¨‹è¿›è¡Œèšåˆæµ‹è¯•\n\n# æµ‹è¯•å°è£…çš„ä»£ç \n```js\nclass App {\n  constructor() {\n    this.middleware = []\n  }\n  use(fn) {\n    this.middleware.push(fn)\n  }\n}\n\nconst app = new App\n\napp.use(async function m1(next) {\n  console.log('m1')\n  await next()\n  console.log('m1 end')\n})\n\napp.use(async function m2(next) {\n  console.log('m2')\n  await next()\n  console.log('m2 end')\n})\n\napp.use(async function m3(next) {\n  console.log('m3')\n  await next()\n  console.log('m3 end')\n})\n\n\nconst createNext = (middleware, oldNext) =>\n  async () =>\n    await middleware(oldNext)\n\nconst compose = middlewares =>\n  middlewares.reduceRight((oldNext, fn) =>\n    createNext(fn, oldNext), async () => Promise.resolve())\n\ncompose(app.middleware)()\n\n// output:\n// m1\n// m2\n// m3\n// m3 end\n// m2 end\n// m1 end\n```\n\nè¾¾åˆ°é¢„æœŸç»“æœahhhhhğŸ’\n\n# summary\n\nå½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•çš„å°è£…ä¸€ä¸‹ï¼Œå…³äºä¸Šä¸‹æ–‡ä¼ é€’é”™è¯¯æ•è·ä¹‹ç±»éƒ½æ²¡åšï¼Œä½†æ˜¯å·²ç»å®Œæˆä¸€ä¸ªæ ‡å‡†çš„æ´‹è‘±æ¨¡å‹çš„æµç¨‹æ§åˆ¶äº†ï¼Œä¸‹æ¬¡æœ‰æœºä¼šè®²è§£å®Œæ•´çš„å°è£… koa2","source":"_posts/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹.md","raw":"---\ntitle: åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\ntags:\n  - å°è£…\n  - koa\n  - æ´‹è‘±æ¨¡å‹\ndate: 2019-02-22 19:00:00\ncategories: å°è£…\n---\n\n\n# åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\n\n#### å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\n![avatar](/onion.png)\n\nkoa2ä¸Šç‹¬ç‰¹çš„ä¸­é—´ä»¶æµç¨‹æ§åˆ¶ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„æ´‹è‘±æ¨¡å‹\n\n# å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\n```js\nconst Koa = require('koa2')\n\nconst app = new Koa()\n\napp.use(async (ctx, next)=>{\n    console.log(1, ' start')\n    await next()\n    console.log(1, ' end')\n})\n\napp.use(async (ctx, next) => {\n    console.log(2, ' start')\n    await next()\n    console.log(2, ' end')\n})\napp.use(async (ctx, next) => {\n    console.log(3, ' start')\n    await next()\n    console.log(3, ' end')\n})\n\napp.listen(3000)\n```\nè¾“å‡ºç»“æœï¼š\n```bash\n1 start\n2 start\n3 start\n3 end\n2 end\n1 end\n```\n\nå±•ç°å¦‚ä¸Šå›¾æ´‹è‘±å¼çš„è¾“å‡ºç»“æœ\n\n# å½’çº³å¾—å‡ºç»“è®º\n\næ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å°è£…ï¼Œè¦æƒ³è¾¾æˆæ´‹è‘±æ¨¡å‹å¼çš„æµç¨‹æ§åˆ¶ï¼Œä¸»è¦çœ‹ä¸Šé¢demoä¸­ callback çš„ç¬¬äºŒä¸ªå‚æ•° next æ–¹æ³•ï¼ˆctxæš‚æ—¶å’Œæœ¬æ–‡å†…å®¹æ— å…³ï¼‰ï¼Œä¸€æ­¥ä¸€æ­¥æ¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ€è€ƒï¼š\n- é¦–å…ˆå˜ä¸ºæœ€ç®€caseï¼šåªæœ‰ä¸¤ä¸ªä¸­é—´ä»¶å‡½æ•°\n- é‚£ä¹ˆå¦‚æœæƒ³è¦ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œnextæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬è‹¥æ˜¯æŠŠnextæ–¹æ³•æœ¬èº«å°±æ˜¯ä½œä¸ºç¬¬äºŒä¸ªä¸­é—´ä»¶å‡½æ•°è¿›è¡Œè°ƒç”¨å°±ä¼šå¾—åˆ° `1 start -> 2 start -> 2 end -> 1 end` çš„ç»“æœ\n- åŒç†å¦‚æœæ˜¯ä¸‰ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ç¬¬ä¸‰ä¸ªä¸­é—´ä»¶å½“åšç¬¬äºŒä¸ªä¸­é—´ä»¶çš„ next æ–¹æ³•ï¼Œå†æŠŠç¬¬äºŒä¸ªä¸­é—´ä»¶å½“åšç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„ next å›è°ƒ\n\n.\n\n.\n\n.\n\n.\n\n.\n\n.\nå’Œä¹‹å‰çš„ä¸€ç¯‡ [åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹](http://localhost:4000/2019/02/21/do%20something/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E5%92%8C%E9%80%92%E5%BD%92%EF%BC%9A%E4%BB%8E%E8%99%8E%E7%BE%8A%E8%8D%89%E5%BC%80%E5%A7%8B/#%E4%BB%8E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%83%85%E5%86%B5%E5%85%A5%E6%89%8B) ç±»ä¼¼è¿›è¡Œç®€å•çš„å½’çº³ä¹‹åå¾—å‡ºæ€è·¯ï¼Œæœ€å…³é”®çš„æµç¨‹æ§åˆ¶é—®é¢˜æ—¢ç„¶æœ‰äº†æ€è·¯ä¸‹é¢å¼€å§‹å°è£…ä»£ç \n\n# ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\n\nç¬¬ä¸€æ­¥ï¼šé¦–å…ˆæ„é€ ä¸€ä¸ªåŸºæœ¬çš„Appæ„é€ ç±»è¿›è¡Œæ–¹æ³•æŒ‚è½½ä¾èµ–æ”¶é›†ç­‰, æ‹¥æœ‰ä¸€ä¸ª use æ–¹æ³•å¯¹ä¸­é—´ä»¶å‡½æ•°è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå»ºç«‹ä¸€ä¸ªå­˜å‚¨æ ˆ middleware ç”¨æ¥å­˜æ”¾æ”¶é›†çš„ä¾èµ–ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```js\nclass App {\n  constructor() {\n    this.middleware = []\n  }\n  use(fn) {\n    this.middleware.push(fn)\n  }\n}\n```\n\nç¬¬äºŒæ­¥ï¼šæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ª compose å‡½æ•° å¯¹æ”¶é›†åˆ°çš„ä¾èµ–è¿›è¡Œå¤„ç†ï¼Œå‚æ•°æ˜¯æ”¶é›†çš„ä¾èµ–æ ˆï¼Œè¿”å›ä¸€ä¸ªé€šè¿‡ä¸€å±‚å±‚ä¸­é—´ä»¶å‡½æ•°åŒ…è£…çš„æ–°å‡½æ•°ï¼Œæ•°ç»„æœ‰ä¸ª reduce æ–¹æ³•å¯ä»¥å¾ˆè½»æ˜“çš„å¸®æˆ‘ä»¬åšåˆ°è¿™ä»¶äº‹æƒ…ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯éœ€è¦æŒ‰ç…§æ”¶é›†çš„ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œæ¯ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„å½’çº³å¦‚æœæŒ‰1 -> 2 -> 3çš„æµç¨‹é¡ºåºéå†æ˜¾ç„¶å°±ä¼šå°†æœ€æ—©æ”¶é›†çš„ä¾èµ–åŒ…è£…åœ¨æœ€å†…å±‚ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æœ‰ reduceRightğŸ˜„ï¼Œ ä»£ç å¦‚ä¸‹ï¼š\n```js\nconst compose = middlewares =>\n  middlewares.reduceRight((oldNext, fn) =>\n    createNext(fn, oldNext), async () => Promise.resolve())\n```\n\nç¬¬ä¸‰æ­¥ï¼šæ˜¾ç„¶æ¥ä¸‹æ¥æœ€å…³é”®çš„å°±æ˜¯å¯¹ä¸Šé¢ compose å‡½æ•°ä¸­çš„ createNext æ–¹æ³•è¿›è¡Œå°è£…ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸Šé¢å·²ç»è¯´è¿‡ï¼Œnextæ–¹æ³•æ˜¯å¯¹ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°çš„å¤„ç†ï¼Œä¸€ä¸ªå‚æ•°æ˜¯ä¸­é—´ä»¶å‡½æ•°ï¼Œè€Œå¦ä¸€ä¸ªæ˜¾ç„¶å°±æ˜¯é‚£ä¸ªnextæ–¹æ³•ï¼ŒåŒ…è£…è°ƒç”¨åè¿”å›ä¸€ä¸ªæ–°çš„nextå‡½æ•°ä¼ é€’åˆ°ä¸‹ä¸€å±‚åŒ…è£…ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```js\nconst createNext = (middleware, oldNext) =>\n  async () =>\n    await middleware(oldNext)\n```\n\nä»¥ä¸ŠåŸºæœ¬çš„å°è£…å·²ç»å®Œæˆï¼Œæ ¸å¿ƒä»£ç åªæœ‰ middlewares å’Œ createNext ä¸¤ä¸ªå‡½æ•°ï¼Œåªæœ‰6è¡Œï¼Œä¸‹é¢å¯¹ä¸Šé¢æ•´ä¸ªæµç¨‹è¿›è¡Œèšåˆæµ‹è¯•\n\n# æµ‹è¯•å°è£…çš„ä»£ç \n```js\nclass App {\n  constructor() {\n    this.middleware = []\n  }\n  use(fn) {\n    this.middleware.push(fn)\n  }\n}\n\nconst app = new App\n\napp.use(async function m1(next) {\n  console.log('m1')\n  await next()\n  console.log('m1 end')\n})\n\napp.use(async function m2(next) {\n  console.log('m2')\n  await next()\n  console.log('m2 end')\n})\n\napp.use(async function m3(next) {\n  console.log('m3')\n  await next()\n  console.log('m3 end')\n})\n\n\nconst createNext = (middleware, oldNext) =>\n  async () =>\n    await middleware(oldNext)\n\nconst compose = middlewares =>\n  middlewares.reduceRight((oldNext, fn) =>\n    createNext(fn, oldNext), async () => Promise.resolve())\n\ncompose(app.middleware)()\n\n// output:\n// m1\n// m2\n// m3\n// m3 end\n// m2 end\n// m1 end\n```\n\nè¾¾åˆ°é¢„æœŸç»“æœahhhhhğŸ’\n\n# summary\n\nå½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•çš„å°è£…ä¸€ä¸‹ï¼Œå…³äºä¸Šä¸‹æ–‡ä¼ é€’é”™è¯¯æ•è·ä¹‹ç±»éƒ½æ²¡åšï¼Œä½†æ˜¯å·²ç»å®Œæˆä¸€ä¸ªæ ‡å‡†çš„æ´‹è‘±æ¨¡å‹çš„æµç¨‹æ§åˆ¶äº†ï¼Œä¸‹æ¬¡æœ‰æœºä¼šè®²è§£å®Œæ•´çš„å°è£… koa2","slug":"do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹","published":1,"updated":"2019-02-23T04:36:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsh7ugh5000464vadjycj22t","content":"<h1 id=\"åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\"><a href=\"#åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\" class=\"headerlink\" title=\"åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\"></a>åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹</h1><h4 id=\"å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\"><a href=\"#å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\" class=\"headerlink\" title=\"å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\"></a>å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹</h4><p><img src=\"/2019/02/22/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹/onion.png\" alt=\"avatar\"></p>\n<p>koa2ä¸Šç‹¬ç‰¹çš„ä¸­é—´ä»¶æµç¨‹æ§åˆ¶ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„æ´‹è‘±æ¨¡å‹</p>\n<h1 id=\"å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\"><a href=\"#å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\" class=\"headerlink\" title=\"å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\"></a>å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa2'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa()</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>, <span class=\"string\">' start'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>, <span class=\"string\">' end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>, <span class=\"string\">' start'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>, <span class=\"string\">' end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>, <span class=\"string\">' start'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>, <span class=\"string\">' end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n<p>è¾“å‡ºç»“æœï¼š<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 start</span><br><span class=\"line\">2 start</span><br><span class=\"line\">3 start</span><br><span class=\"line\">3 end</span><br><span class=\"line\">2 end</span><br><span class=\"line\">1 end</span><br></pre></td></tr></table></figure></p>\n<p>å±•ç°å¦‚ä¸Šå›¾æ´‹è‘±å¼çš„è¾“å‡ºç»“æœ</p>\n<h1 id=\"å½’çº³å¾—å‡ºç»“è®º\"><a href=\"#å½’çº³å¾—å‡ºç»“è®º\" class=\"headerlink\" title=\"å½’çº³å¾—å‡ºç»“è®º\"></a>å½’çº³å¾—å‡ºç»“è®º</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å°è£…ï¼Œè¦æƒ³è¾¾æˆæ´‹è‘±æ¨¡å‹å¼çš„æµç¨‹æ§åˆ¶ï¼Œä¸»è¦çœ‹ä¸Šé¢demoä¸­ callback çš„ç¬¬äºŒä¸ªå‚æ•° next æ–¹æ³•ï¼ˆctxæš‚æ—¶å’Œæœ¬æ–‡å†…å®¹æ— å…³ï¼‰ï¼Œä¸€æ­¥ä¸€æ­¥æ¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ€è€ƒï¼š</p>\n<ul>\n<li>é¦–å…ˆå˜ä¸ºæœ€ç®€caseï¼šåªæœ‰ä¸¤ä¸ªä¸­é—´ä»¶å‡½æ•°</li>\n<li>é‚£ä¹ˆå¦‚æœæƒ³è¦ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œnextæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬è‹¥æ˜¯æŠŠnextæ–¹æ³•æœ¬èº«å°±æ˜¯ä½œä¸ºç¬¬äºŒä¸ªä¸­é—´ä»¶å‡½æ•°è¿›è¡Œè°ƒç”¨å°±ä¼šå¾—åˆ° <code>1 start -&gt; 2 start -&gt; 2 end -&gt; 1 end</code> çš„ç»“æœ</li>\n<li>åŒç†å¦‚æœæ˜¯ä¸‰ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ç¬¬ä¸‰ä¸ªä¸­é—´ä»¶å½“åšç¬¬äºŒä¸ªä¸­é—´ä»¶çš„ next æ–¹æ³•ï¼Œå†æŠŠç¬¬äºŒä¸ªä¸­é—´ä»¶å½“åšç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„ next å›è°ƒ</li>\n</ul>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.<br>å’Œä¹‹å‰çš„ä¸€ç¯‡ <a href=\"http://localhost:4000/2019/02/21/do%20something/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E5%92%8C%E9%80%92%E5%BD%92%EF%BC%9A%E4%BB%8E%E8%99%8E%E7%BE%8A%E8%8D%89%E5%BC%80%E5%A7%8B/#%E4%BB%8E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%83%85%E5%86%B5%E5%85%A5%E6%89%8B\" target=\"_blank\" rel=\"noopener\">åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹</a> ç±»ä¼¼è¿›è¡Œç®€å•çš„å½’çº³ä¹‹åå¾—å‡ºæ€è·¯ï¼Œæœ€å…³é”®çš„æµç¨‹æ§åˆ¶é—®é¢˜æ—¢ç„¶æœ‰äº†æ€è·¯ä¸‹é¢å¼€å§‹å°è£…ä»£ç </p>\n<h1 id=\"ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\"><a href=\"#ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\" class=\"headerlink\" title=\"ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\"></a>ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…</h1><p>ç¬¬ä¸€æ­¥ï¼šé¦–å…ˆæ„é€ ä¸€ä¸ªåŸºæœ¬çš„Appæ„é€ ç±»è¿›è¡Œæ–¹æ³•æŒ‚è½½ä¾èµ–æ”¶é›†ç­‰, æ‹¥æœ‰ä¸€ä¸ª use æ–¹æ³•å¯¹ä¸­é—´ä»¶å‡½æ•°è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå»ºç«‹ä¸€ä¸ªå­˜å‚¨æ ˆ middleware ç”¨æ¥å­˜æ”¾æ”¶é›†çš„ä¾èµ–ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  use(fn) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware.push(fn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>ç¬¬äºŒæ­¥ï¼šæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ª compose å‡½æ•° å¯¹æ”¶é›†åˆ°çš„ä¾èµ–è¿›è¡Œå¤„ç†ï¼Œå‚æ•°æ˜¯æ”¶é›†çš„ä¾èµ–æ ˆï¼Œè¿”å›ä¸€ä¸ªé€šè¿‡ä¸€å±‚å±‚ä¸­é—´ä»¶å‡½æ•°åŒ…è£…çš„æ–°å‡½æ•°ï¼Œæ•°ç»„æœ‰ä¸ª reduce æ–¹æ³•å¯ä»¥å¾ˆè½»æ˜“çš„å¸®æˆ‘ä»¬åšåˆ°è¿™ä»¶äº‹æƒ…ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯éœ€è¦æŒ‰ç…§æ”¶é›†çš„ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œæ¯ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„å½’çº³å¦‚æœæŒ‰1 -&gt; 2 -&gt; 3çš„æµç¨‹é¡ºåºéå†æ˜¾ç„¶å°±ä¼šå°†æœ€æ—©æ”¶é›†çš„ä¾èµ–åŒ…è£…åœ¨æœ€å†…å±‚ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æœ‰ reduceRightğŸ˜„ï¼Œ ä»£ç å¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"function\"><span class=\"params\">middlewares</span> =&gt;</span></span><br><span class=\"line\">  middlewares.reduceRight(<span class=\"function\">(<span class=\"params\">oldNext, fn</span>) =&gt;</span></span><br><span class=\"line\">    createNext(fn, oldNext), <span class=\"keyword\">async</span> () =&gt; <span class=\"built_in\">Promise</span>.resolve())</span><br></pre></td></tr></table></figure></p>\n<p>ç¬¬ä¸‰æ­¥ï¼šæ˜¾ç„¶æ¥ä¸‹æ¥æœ€å…³é”®çš„å°±æ˜¯å¯¹ä¸Šé¢ compose å‡½æ•°ä¸­çš„ createNext æ–¹æ³•è¿›è¡Œå°è£…ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸Šé¢å·²ç»è¯´è¿‡ï¼Œnextæ–¹æ³•æ˜¯å¯¹ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°çš„å¤„ç†ï¼Œä¸€ä¸ªå‚æ•°æ˜¯ä¸­é—´ä»¶å‡½æ•°ï¼Œè€Œå¦ä¸€ä¸ªæ˜¾ç„¶å°±æ˜¯é‚£ä¸ªnextæ–¹æ³•ï¼ŒåŒ…è£…è°ƒç”¨åè¿”å›ä¸€ä¸ªæ–°çš„nextå‡½æ•°ä¼ é€’åˆ°ä¸‹ä¸€å±‚åŒ…è£…ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createNext = <span class=\"function\">(<span class=\"params\">middleware, oldNext</span>) =&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> () =&gt;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> middleware(oldNext)</span><br></pre></td></tr></table></figure></p>\n<p>ä»¥ä¸ŠåŸºæœ¬çš„å°è£…å·²ç»å®Œæˆï¼Œæ ¸å¿ƒä»£ç åªæœ‰ middlewares å’Œ createNext ä¸¤ä¸ªå‡½æ•°ï¼Œåªæœ‰6è¡Œï¼Œä¸‹é¢å¯¹ä¸Šé¢æ•´ä¸ªæµç¨‹è¿›è¡Œèšåˆæµ‹è¯•</p>\n<h1 id=\"æµ‹è¯•å°è£…çš„ä»£ç \"><a href=\"#æµ‹è¯•å°è£…çš„ä»£ç \" class=\"headerlink\" title=\"æµ‹è¯•å°è£…çš„ä»£ç \"></a>æµ‹è¯•å°è£…çš„ä»£ç </h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  use(fn) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware.push(fn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> App</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">m1</span>(<span class=\"params\">next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m1'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m1 end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">m2</span>(<span class=\"params\">next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m2'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m2 end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">m3</span>(<span class=\"params\">next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m3'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m3 end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> createNext = <span class=\"function\">(<span class=\"params\">middleware, oldNext</span>) =&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> () =&gt;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> middleware(oldNext)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"function\"><span class=\"params\">middlewares</span> =&gt;</span></span><br><span class=\"line\">  middlewares.reduceRight(<span class=\"function\">(<span class=\"params\">oldNext, fn</span>) =&gt;</span></span><br><span class=\"line\">    createNext(fn, oldNext), <span class=\"keyword\">async</span> () =&gt; <span class=\"built_in\">Promise</span>.resolve())</span><br><span class=\"line\"></span><br><span class=\"line\">compose(app.middleware)()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// output:</span></span><br><span class=\"line\"><span class=\"comment\">// m1</span></span><br><span class=\"line\"><span class=\"comment\">// m2</span></span><br><span class=\"line\"><span class=\"comment\">// m3</span></span><br><span class=\"line\"><span class=\"comment\">// m3 end</span></span><br><span class=\"line\"><span class=\"comment\">// m2 end</span></span><br><span class=\"line\"><span class=\"comment\">// m1 end</span></span><br></pre></td></tr></table></figure>\n<p>è¾¾åˆ°é¢„æœŸç»“æœahhhhhğŸ’</p>\n<h1 id=\"summary\"><a href=\"#summary\" class=\"headerlink\" title=\"summary\"></a>summary</h1><p>å½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•çš„å°è£…ä¸€ä¸‹ï¼Œå…³äºä¸Šä¸‹æ–‡ä¼ é€’é”™è¯¯æ•è·ä¹‹ç±»éƒ½æ²¡åšï¼Œä½†æ˜¯å·²ç»å®Œæˆä¸€ä¸ªæ ‡å‡†çš„æ´‹è‘±æ¨¡å‹çš„æµç¨‹æ§åˆ¶äº†ï¼Œä¸‹æ¬¡æœ‰æœºä¼šè®²è§£å®Œæ•´çš„å°è£… koa2</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\"><a href=\"#åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\" class=\"headerlink\" title=\"åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹\"></a>åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹</h1><h4 id=\"å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\"><a href=\"#å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\" class=\"headerlink\" title=\"å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹\"></a>å…ˆç”¨ä¸€å¼ å›¾å½¢è±¡è¯ é‡Šæ´‹è‘±æ¨¡å‹</h4><p><img src=\"/2019/02/22/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹/onion.png\" alt=\"avatar\"></p>\n<p>koa2ä¸Šç‹¬ç‰¹çš„ä¸­é—´ä»¶æµç¨‹æ§åˆ¶ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„æ´‹è‘±æ¨¡å‹</p>\n<h1 id=\"å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\"><a href=\"#å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\" class=\"headerlink\" title=\"å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo\"></a>å…ˆå±•ç¤ºä¸€ä¸‹koa2çš„è¿è¡Œdemo</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa2'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa()</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>, <span class=\"string\">' start'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>, <span class=\"string\">' end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>, <span class=\"string\">' start'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>, <span class=\"string\">' end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>, <span class=\"string\">' start'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>, <span class=\"string\">' end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n<p>è¾“å‡ºç»“æœï¼š<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 start</span><br><span class=\"line\">2 start</span><br><span class=\"line\">3 start</span><br><span class=\"line\">3 end</span><br><span class=\"line\">2 end</span><br><span class=\"line\">1 end</span><br></pre></td></tr></table></figure></p>\n<p>å±•ç°å¦‚ä¸Šå›¾æ´‹è‘±å¼çš„è¾“å‡ºç»“æœ</p>\n<h1 id=\"å½’çº³å¾—å‡ºç»“è®º\"><a href=\"#å½’çº³å¾—å‡ºç»“è®º\" class=\"headerlink\" title=\"å½’çº³å¾—å‡ºç»“è®º\"></a>å½’çº³å¾—å‡ºç»“è®º</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å°è£…ï¼Œè¦æƒ³è¾¾æˆæ´‹è‘±æ¨¡å‹å¼çš„æµç¨‹æ§åˆ¶ï¼Œä¸»è¦çœ‹ä¸Šé¢demoä¸­ callback çš„ç¬¬äºŒä¸ªå‚æ•° next æ–¹æ³•ï¼ˆctxæš‚æ—¶å’Œæœ¬æ–‡å†…å®¹æ— å…³ï¼‰ï¼Œä¸€æ­¥ä¸€æ­¥æ¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ€è€ƒï¼š</p>\n<ul>\n<li>é¦–å…ˆå˜ä¸ºæœ€ç®€caseï¼šåªæœ‰ä¸¤ä¸ªä¸­é—´ä»¶å‡½æ•°</li>\n<li>é‚£ä¹ˆå¦‚æœæƒ³è¦ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œnextæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬è‹¥æ˜¯æŠŠnextæ–¹æ³•æœ¬èº«å°±æ˜¯ä½œä¸ºç¬¬äºŒä¸ªä¸­é—´ä»¶å‡½æ•°è¿›è¡Œè°ƒç”¨å°±ä¼šå¾—åˆ° <code>1 start -&gt; 2 start -&gt; 2 end -&gt; 1 end</code> çš„ç»“æœ</li>\n<li>åŒç†å¦‚æœæ˜¯ä¸‰ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ç¬¬ä¸‰ä¸ªä¸­é—´ä»¶å½“åšç¬¬äºŒä¸ªä¸­é—´ä»¶çš„ next æ–¹æ³•ï¼Œå†æŠŠç¬¬äºŒä¸ªä¸­é—´ä»¶å½“åšç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„ next å›è°ƒ</li>\n</ul>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.</p>\n<p>.<br>å’Œä¹‹å‰çš„ä¸€ç¯‡ <a href=\"http://localhost:4000/2019/02/21/do%20something/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E5%92%8C%E9%80%92%E5%BD%92%EF%BC%9A%E4%BB%8E%E8%99%8E%E7%BE%8A%E8%8D%89%E5%BC%80%E5%A7%8B/#%E4%BB%8E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%83%85%E5%86%B5%E5%85%A5%E6%89%8B\" target=\"_blank\" rel=\"noopener\">åŠ¨æ€è§„åˆ’å’Œé€’å½’ï¼šä»è™ç¾Šè‰å¼€å§‹</a> ç±»ä¼¼è¿›è¡Œç®€å•çš„å½’çº³ä¹‹åå¾—å‡ºæ€è·¯ï¼Œæœ€å…³é”®çš„æµç¨‹æ§åˆ¶é—®é¢˜æ—¢ç„¶æœ‰äº†æ€è·¯ä¸‹é¢å¼€å§‹å°è£…ä»£ç </p>\n<h1 id=\"ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\"><a href=\"#ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\" class=\"headerlink\" title=\"ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…\"></a>ä¸‰æ­¥å®ŒæˆåŸºæœ¬å°è£…</h1><p>ç¬¬ä¸€æ­¥ï¼šé¦–å…ˆæ„é€ ä¸€ä¸ªåŸºæœ¬çš„Appæ„é€ ç±»è¿›è¡Œæ–¹æ³•æŒ‚è½½ä¾èµ–æ”¶é›†ç­‰, æ‹¥æœ‰ä¸€ä¸ª use æ–¹æ³•å¯¹ä¸­é—´ä»¶å‡½æ•°è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå»ºç«‹ä¸€ä¸ªå­˜å‚¨æ ˆ middleware ç”¨æ¥å­˜æ”¾æ”¶é›†çš„ä¾èµ–ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  use(fn) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware.push(fn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>ç¬¬äºŒæ­¥ï¼šæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ª compose å‡½æ•° å¯¹æ”¶é›†åˆ°çš„ä¾èµ–è¿›è¡Œå¤„ç†ï¼Œå‚æ•°æ˜¯æ”¶é›†çš„ä¾èµ–æ ˆï¼Œè¿”å›ä¸€ä¸ªé€šè¿‡ä¸€å±‚å±‚ä¸­é—´ä»¶å‡½æ•°åŒ…è£…çš„æ–°å‡½æ•°ï¼Œæ•°ç»„æœ‰ä¸ª reduce æ–¹æ³•å¯ä»¥å¾ˆè½»æ˜“çš„å¸®æˆ‘ä»¬åšåˆ°è¿™ä»¶äº‹æƒ…ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯éœ€è¦æŒ‰ç…§æ”¶é›†çš„ä¸­é—´ä»¶çš„é¡ºåºæ‰§è¡Œæ¯ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„å½’çº³å¦‚æœæŒ‰1 -&gt; 2 -&gt; 3çš„æµç¨‹é¡ºåºéå†æ˜¾ç„¶å°±ä¼šå°†æœ€æ—©æ”¶é›†çš„ä¾èµ–åŒ…è£…åœ¨æœ€å†…å±‚ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æœ‰ reduceRightğŸ˜„ï¼Œ ä»£ç å¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"function\"><span class=\"params\">middlewares</span> =&gt;</span></span><br><span class=\"line\">  middlewares.reduceRight(<span class=\"function\">(<span class=\"params\">oldNext, fn</span>) =&gt;</span></span><br><span class=\"line\">    createNext(fn, oldNext), <span class=\"keyword\">async</span> () =&gt; <span class=\"built_in\">Promise</span>.resolve())</span><br></pre></td></tr></table></figure></p>\n<p>ç¬¬ä¸‰æ­¥ï¼šæ˜¾ç„¶æ¥ä¸‹æ¥æœ€å…³é”®çš„å°±æ˜¯å¯¹ä¸Šé¢ compose å‡½æ•°ä¸­çš„ createNext æ–¹æ³•è¿›è¡Œå°è£…ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸Šé¢å·²ç»è¯´è¿‡ï¼Œnextæ–¹æ³•æ˜¯å¯¹ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°çš„å¤„ç†ï¼Œä¸€ä¸ªå‚æ•°æ˜¯ä¸­é—´ä»¶å‡½æ•°ï¼Œè€Œå¦ä¸€ä¸ªæ˜¾ç„¶å°±æ˜¯é‚£ä¸ªnextæ–¹æ³•ï¼ŒåŒ…è£…è°ƒç”¨åè¿”å›ä¸€ä¸ªæ–°çš„nextå‡½æ•°ä¼ é€’åˆ°ä¸‹ä¸€å±‚åŒ…è£…ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createNext = <span class=\"function\">(<span class=\"params\">middleware, oldNext</span>) =&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> () =&gt;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> middleware(oldNext)</span><br></pre></td></tr></table></figure></p>\n<p>ä»¥ä¸ŠåŸºæœ¬çš„å°è£…å·²ç»å®Œæˆï¼Œæ ¸å¿ƒä»£ç åªæœ‰ middlewares å’Œ createNext ä¸¤ä¸ªå‡½æ•°ï¼Œåªæœ‰6è¡Œï¼Œä¸‹é¢å¯¹ä¸Šé¢æ•´ä¸ªæµç¨‹è¿›è¡Œèšåˆæµ‹è¯•</p>\n<h1 id=\"æµ‹è¯•å°è£…çš„ä»£ç \"><a href=\"#æµ‹è¯•å°è£…çš„ä»£ç \" class=\"headerlink\" title=\"æµ‹è¯•å°è£…çš„ä»£ç \"></a>æµ‹è¯•å°è£…çš„ä»£ç </h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  use(fn) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.middleware.push(fn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> App</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">m1</span>(<span class=\"params\">next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m1'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m1 end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">m2</span>(<span class=\"params\">next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m2'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m2 end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">m3</span>(<span class=\"params\">next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m3'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> next()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'m3 end'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> createNext = <span class=\"function\">(<span class=\"params\">middleware, oldNext</span>) =&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> () =&gt;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> middleware(oldNext)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"function\"><span class=\"params\">middlewares</span> =&gt;</span></span><br><span class=\"line\">  middlewares.reduceRight(<span class=\"function\">(<span class=\"params\">oldNext, fn</span>) =&gt;</span></span><br><span class=\"line\">    createNext(fn, oldNext), <span class=\"keyword\">async</span> () =&gt; <span class=\"built_in\">Promise</span>.resolve())</span><br><span class=\"line\"></span><br><span class=\"line\">compose(app.middleware)()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// output:</span></span><br><span class=\"line\"><span class=\"comment\">// m1</span></span><br><span class=\"line\"><span class=\"comment\">// m2</span></span><br><span class=\"line\"><span class=\"comment\">// m3</span></span><br><span class=\"line\"><span class=\"comment\">// m3 end</span></span><br><span class=\"line\"><span class=\"comment\">// m2 end</span></span><br><span class=\"line\"><span class=\"comment\">// m1 end</span></span><br></pre></td></tr></table></figure>\n<p>è¾¾åˆ°é¢„æœŸç»“æœahhhhhğŸ’</p>\n<h1 id=\"summary\"><a href=\"#summary\" class=\"headerlink\" title=\"summary\"></a>summary</h1><p>å½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•çš„å°è£…ä¸€ä¸‹ï¼Œå…³äºä¸Šä¸‹æ–‡ä¼ é€’é”™è¯¯æ•è·ä¹‹ç±»éƒ½æ²¡åšï¼Œä½†æ˜¯å·²ç»å®Œæˆä¸€ä¸ªæ ‡å‡†çš„æ´‹è‘±æ¨¡å‹çš„æµç¨‹æ§åˆ¶äº†ï¼Œä¸‹æ¬¡æœ‰æœºä¼šè®²è§£å®Œæ•´çš„å°è£… koa2</p>\n"},{"title":"äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢","date":"2019-01-03T16:00:00.000Z","_content":"\n# äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢\n\næˆ‘æ˜¯äººé—´æƒ†æ€…å®¢\nçŸ¥å›ä½•äº‹æ³ªçºµæ¨ª\n\n\n## åŸæ¥18å¹´å·²ç»ç»“æŸäº†\n\nå·²è‡³å·±äº¥ï¼Œæ—¶é—´å¦‚æµæ°´ï¼Œå¤§æ±Ÿä¸œå»ã€‚äº”å‘³é™ˆæ‚çš„18å¹´ï¼Œå•èº«ç¨‹åºå‘˜å¹¶ä¸æ˜¯åªæœ‰å·¥ä½œï¼Œç”Ÿæ´»ä¸‰ç•ªäº”æ¬¡ç»™æˆ‘å½“å¤´æ£’å–ã€‚ç®€å•æ€»ç»“ä¸‹å§\n\nä»é€”è™åˆ°é±¼æ³¡æ³¡\n\nç»“è¯†ä¸å°‘æ–°æœ‹å‹\n\nå’Œ [æ›¹å°‘](https://github.com/kailcc) ç»Ÿä¸€é˜µçº¿ï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šçš„å¤§éƒ½ç‚¹å¤´æ³›æ³›ä¹‹äº¤å¦‚æ— æ ¹æµ®è\n\næ„Ÿè°¢å‘¨å›´å¸®åŠ©è¿‡æˆ‘çš„åŒäº‹å’Œé™Œç”Ÿäººã€‚æˆ‘æ˜¯é‚£ç§ä¸å¯è‚†æ„å¿˜å½¢çš„äººï¼Œä¸€åˆ‡åœ¨æˆ‘èº«ä¸Šä»¿è‹¥æ˜¯å®ˆæ’çš„ï¼Œå¾—æ„ä¸ä¹…æ€»ä¼šè¿æ¥å½“å¤´æ£’å–ï¼Œåªèƒ½é—·å£°åšäº‹å—ï¼Œè¿™ä¸ªå¹´è½»äººä¹Ÿå¤ªä¸æ½‡æ´’äº†ã€‚æ—¶å€™æœªåˆ°ï¼Œé˜…å†å°šæµ…ï¼Œä¸æ˜¯æˆ‘çš„æˆ‘è¿˜æ‹¿ä¸ä½\n\nå¿ƒä¸­çš„æˆ¾æ°”ä¸€ç›´ä¸å¾—æ¶ˆå‡ï¼Œè„¾æ€§è™½ç„¶ç›¸å¯¹å­¦ç”Ÿæ—¶ä»£å·²ç»å†…æ•›å¾ˆå¤šï¼Œå¯æˆ¾æ°”ä¸€ç›´åœ¨å¿ƒä¸­ç§¯èšã€‚å¯èƒ½ä¸ªäººå†…å¿ƒæä¸ºè‡ªç§ï¼Œå¯èƒ½å¯¹ç°çŠ¶æå…¶ä¸æ»¡ï¼Œå¯æœ€ç»ˆçš„ç»“æœæ€»æ˜¯ç”±äºæˆ¾æ°”åœ¨é”™è¯¯çš„æ—¶å€™çš„æ—¶å€™åšäº†é”™è¯¯çš„äº‹\n\n\nä¾ç„¶å•èº«ï¼Œè¿™åŸå¸‚å¤ªç©º\n\nä¾æ—§ç»å¸¸èƒ¡æ€ä¹±æƒ³ï¼Œä¸Šè‡³å®‡å®™ä¸‹è‡³å¾®å°˜ï¼Œäººäº‹ç‰©æ™¯æƒ…\n\nä¹‹åå†è¡¥ä¸Šå§\n\næœ€åå¸Œæœ›19å¹´è§…å¾—çŸ¥éŸ³ï¼Œåšå¾—ä½³äººï¼Œèµšå¾—é’±è´¢ï¼Œæ‘†è„±è‹¦ç—›\n","source":"_posts/human beings/äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢.md","raw":"---\ntitle: äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢\ntags:\n  - å½“æˆ‘åœ¨æ‰¯æ·¡\ndate: 2019-01-04 00:00:00\ncategories: å½“æˆ‘åœ¨æ‰¯æ·¡\n---\n\n# äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢\n\næˆ‘æ˜¯äººé—´æƒ†æ€…å®¢\nçŸ¥å›ä½•äº‹æ³ªçºµæ¨ª\n\n\n## åŸæ¥18å¹´å·²ç»ç»“æŸäº†\n\nå·²è‡³å·±äº¥ï¼Œæ—¶é—´å¦‚æµæ°´ï¼Œå¤§æ±Ÿä¸œå»ã€‚äº”å‘³é™ˆæ‚çš„18å¹´ï¼Œå•èº«ç¨‹åºå‘˜å¹¶ä¸æ˜¯åªæœ‰å·¥ä½œï¼Œç”Ÿæ´»ä¸‰ç•ªäº”æ¬¡ç»™æˆ‘å½“å¤´æ£’å–ã€‚ç®€å•æ€»ç»“ä¸‹å§\n\nä»é€”è™åˆ°é±¼æ³¡æ³¡\n\nç»“è¯†ä¸å°‘æ–°æœ‹å‹\n\nå’Œ [æ›¹å°‘](https://github.com/kailcc) ç»Ÿä¸€é˜µçº¿ï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šçš„å¤§éƒ½ç‚¹å¤´æ³›æ³›ä¹‹äº¤å¦‚æ— æ ¹æµ®è\n\næ„Ÿè°¢å‘¨å›´å¸®åŠ©è¿‡æˆ‘çš„åŒäº‹å’Œé™Œç”Ÿäººã€‚æˆ‘æ˜¯é‚£ç§ä¸å¯è‚†æ„å¿˜å½¢çš„äººï¼Œä¸€åˆ‡åœ¨æˆ‘èº«ä¸Šä»¿è‹¥æ˜¯å®ˆæ’çš„ï¼Œå¾—æ„ä¸ä¹…æ€»ä¼šè¿æ¥å½“å¤´æ£’å–ï¼Œåªèƒ½é—·å£°åšäº‹å—ï¼Œè¿™ä¸ªå¹´è½»äººä¹Ÿå¤ªä¸æ½‡æ´’äº†ã€‚æ—¶å€™æœªåˆ°ï¼Œé˜…å†å°šæµ…ï¼Œä¸æ˜¯æˆ‘çš„æˆ‘è¿˜æ‹¿ä¸ä½\n\nå¿ƒä¸­çš„æˆ¾æ°”ä¸€ç›´ä¸å¾—æ¶ˆå‡ï¼Œè„¾æ€§è™½ç„¶ç›¸å¯¹å­¦ç”Ÿæ—¶ä»£å·²ç»å†…æ•›å¾ˆå¤šï¼Œå¯æˆ¾æ°”ä¸€ç›´åœ¨å¿ƒä¸­ç§¯èšã€‚å¯èƒ½ä¸ªäººå†…å¿ƒæä¸ºè‡ªç§ï¼Œå¯èƒ½å¯¹ç°çŠ¶æå…¶ä¸æ»¡ï¼Œå¯æœ€ç»ˆçš„ç»“æœæ€»æ˜¯ç”±äºæˆ¾æ°”åœ¨é”™è¯¯çš„æ—¶å€™çš„æ—¶å€™åšäº†é”™è¯¯çš„äº‹\n\n\nä¾ç„¶å•èº«ï¼Œè¿™åŸå¸‚å¤ªç©º\n\nä¾æ—§ç»å¸¸èƒ¡æ€ä¹±æƒ³ï¼Œä¸Šè‡³å®‡å®™ä¸‹è‡³å¾®å°˜ï¼Œäººäº‹ç‰©æ™¯æƒ…\n\nä¹‹åå†è¡¥ä¸Šå§\n\næœ€åå¸Œæœ›19å¹´è§…å¾—çŸ¥éŸ³ï¼Œåšå¾—ä½³äººï¼Œèµšå¾—é’±è´¢ï¼Œæ‘†è„±è‹¦ç—›\n","slug":"human beings/äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢","published":1,"updated":"2019-02-23T08:21:51.570Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsh7ugh9000764va7cl9kkin","content":"<h1 id=\"äººç”Ÿå¤©åœ°é—´-å¿½å¦‚è¿œè¡Œå®¢\"><a href=\"#äººç”Ÿå¤©åœ°é—´-å¿½å¦‚è¿œè¡Œå®¢\" class=\"headerlink\" title=\"äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢\"></a>äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢</h1><p>æˆ‘æ˜¯äººé—´æƒ†æ€…å®¢<br>çŸ¥å›ä½•äº‹æ³ªçºµæ¨ª</p>\n<h2 id=\"åŸæ¥18å¹´å·²ç»ç»“æŸäº†\"><a href=\"#åŸæ¥18å¹´å·²ç»ç»“æŸäº†\" class=\"headerlink\" title=\"åŸæ¥18å¹´å·²ç»ç»“æŸäº†\"></a>åŸæ¥18å¹´å·²ç»ç»“æŸäº†</h2><p>å·²è‡³å·±äº¥ï¼Œæ—¶é—´å¦‚æµæ°´ï¼Œå¤§æ±Ÿä¸œå»ã€‚äº”å‘³é™ˆæ‚çš„18å¹´ï¼Œå•èº«ç¨‹åºå‘˜å¹¶ä¸æ˜¯åªæœ‰å·¥ä½œï¼Œç”Ÿæ´»ä¸‰ç•ªäº”æ¬¡ç»™æˆ‘å½“å¤´æ£’å–ã€‚ç®€å•æ€»ç»“ä¸‹å§</p>\n<p>ä»é€”è™åˆ°é±¼æ³¡æ³¡</p>\n<p>ç»“è¯†ä¸å°‘æ–°æœ‹å‹</p>\n<p>å’Œ <a href=\"https://github.com/kailcc\" target=\"_blank\" rel=\"noopener\">æ›¹å°‘</a> ç»Ÿä¸€é˜µçº¿ï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šçš„å¤§éƒ½ç‚¹å¤´æ³›æ³›ä¹‹äº¤å¦‚æ— æ ¹æµ®è</p>\n<p>æ„Ÿè°¢å‘¨å›´å¸®åŠ©è¿‡æˆ‘çš„åŒäº‹å’Œé™Œç”Ÿäººã€‚æˆ‘æ˜¯é‚£ç§ä¸å¯è‚†æ„å¿˜å½¢çš„äººï¼Œä¸€åˆ‡åœ¨æˆ‘èº«ä¸Šä»¿è‹¥æ˜¯å®ˆæ’çš„ï¼Œå¾—æ„ä¸ä¹…æ€»ä¼šè¿æ¥å½“å¤´æ£’å–ï¼Œåªèƒ½é—·å£°åšäº‹å—ï¼Œè¿™ä¸ªå¹´è½»äººä¹Ÿå¤ªä¸æ½‡æ´’äº†ã€‚æ—¶å€™æœªåˆ°ï¼Œé˜…å†å°šæµ…ï¼Œä¸æ˜¯æˆ‘çš„æˆ‘è¿˜æ‹¿ä¸ä½</p>\n<p>å¿ƒä¸­çš„æˆ¾æ°”ä¸€ç›´ä¸å¾—æ¶ˆå‡ï¼Œè„¾æ€§è™½ç„¶ç›¸å¯¹å­¦ç”Ÿæ—¶ä»£å·²ç»å†…æ•›å¾ˆå¤šï¼Œå¯æˆ¾æ°”ä¸€ç›´åœ¨å¿ƒä¸­ç§¯èšã€‚å¯èƒ½ä¸ªäººå†…å¿ƒæä¸ºè‡ªç§ï¼Œå¯èƒ½å¯¹ç°çŠ¶æå…¶ä¸æ»¡ï¼Œå¯æœ€ç»ˆçš„ç»“æœæ€»æ˜¯ç”±äºæˆ¾æ°”åœ¨é”™è¯¯çš„æ—¶å€™çš„æ—¶å€™åšäº†é”™è¯¯çš„äº‹</p>\n<p>ä¾ç„¶å•èº«ï¼Œè¿™åŸå¸‚å¤ªç©º</p>\n<p>ä¾æ—§ç»å¸¸èƒ¡æ€ä¹±æƒ³ï¼Œä¸Šè‡³å®‡å®™ä¸‹è‡³å¾®å°˜ï¼Œäººäº‹ç‰©æ™¯æƒ…</p>\n<p>ä¹‹åå†è¡¥ä¸Šå§</p>\n<p>æœ€åå¸Œæœ›19å¹´è§…å¾—çŸ¥éŸ³ï¼Œåšå¾—ä½³äººï¼Œèµšå¾—é’±è´¢ï¼Œæ‘†è„±è‹¦ç—›</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"äººç”Ÿå¤©åœ°é—´-å¿½å¦‚è¿œè¡Œå®¢\"><a href=\"#äººç”Ÿå¤©åœ°é—´-å¿½å¦‚è¿œè¡Œå®¢\" class=\"headerlink\" title=\"äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢\"></a>äººç”Ÿå¤©åœ°é—´ å¿½å¦‚è¿œè¡Œå®¢</h1><p>æˆ‘æ˜¯äººé—´æƒ†æ€…å®¢<br>çŸ¥å›ä½•äº‹æ³ªçºµæ¨ª</p>\n<h2 id=\"åŸæ¥18å¹´å·²ç»ç»“æŸäº†\"><a href=\"#åŸæ¥18å¹´å·²ç»ç»“æŸäº†\" class=\"headerlink\" title=\"åŸæ¥18å¹´å·²ç»ç»“æŸäº†\"></a>åŸæ¥18å¹´å·²ç»ç»“æŸäº†</h2><p>å·²è‡³å·±äº¥ï¼Œæ—¶é—´å¦‚æµæ°´ï¼Œå¤§æ±Ÿä¸œå»ã€‚äº”å‘³é™ˆæ‚çš„18å¹´ï¼Œå•èº«ç¨‹åºå‘˜å¹¶ä¸æ˜¯åªæœ‰å·¥ä½œï¼Œç”Ÿæ´»ä¸‰ç•ªäº”æ¬¡ç»™æˆ‘å½“å¤´æ£’å–ã€‚ç®€å•æ€»ç»“ä¸‹å§</p>\n<p>ä»é€”è™åˆ°é±¼æ³¡æ³¡</p>\n<p>ç»“è¯†ä¸å°‘æ–°æœ‹å‹</p>\n<p>å’Œ <a href=\"https://github.com/kailcc\" target=\"_blank\" rel=\"noopener\">æ›¹å°‘</a> ç»Ÿä¸€é˜µçº¿ï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šçš„å¤§éƒ½ç‚¹å¤´æ³›æ³›ä¹‹äº¤å¦‚æ— æ ¹æµ®è</p>\n<p>æ„Ÿè°¢å‘¨å›´å¸®åŠ©è¿‡æˆ‘çš„åŒäº‹å’Œé™Œç”Ÿäººã€‚æˆ‘æ˜¯é‚£ç§ä¸å¯è‚†æ„å¿˜å½¢çš„äººï¼Œä¸€åˆ‡åœ¨æˆ‘èº«ä¸Šä»¿è‹¥æ˜¯å®ˆæ’çš„ï¼Œå¾—æ„ä¸ä¹…æ€»ä¼šè¿æ¥å½“å¤´æ£’å–ï¼Œåªèƒ½é—·å£°åšäº‹å—ï¼Œè¿™ä¸ªå¹´è½»äººä¹Ÿå¤ªä¸æ½‡æ´’äº†ã€‚æ—¶å€™æœªåˆ°ï¼Œé˜…å†å°šæµ…ï¼Œä¸æ˜¯æˆ‘çš„æˆ‘è¿˜æ‹¿ä¸ä½</p>\n<p>å¿ƒä¸­çš„æˆ¾æ°”ä¸€ç›´ä¸å¾—æ¶ˆå‡ï¼Œè„¾æ€§è™½ç„¶ç›¸å¯¹å­¦ç”Ÿæ—¶ä»£å·²ç»å†…æ•›å¾ˆå¤šï¼Œå¯æˆ¾æ°”ä¸€ç›´åœ¨å¿ƒä¸­ç§¯èšã€‚å¯èƒ½ä¸ªäººå†…å¿ƒæä¸ºè‡ªç§ï¼Œå¯èƒ½å¯¹ç°çŠ¶æå…¶ä¸æ»¡ï¼Œå¯æœ€ç»ˆçš„ç»“æœæ€»æ˜¯ç”±äºæˆ¾æ°”åœ¨é”™è¯¯çš„æ—¶å€™çš„æ—¶å€™åšäº†é”™è¯¯çš„äº‹</p>\n<p>ä¾ç„¶å•èº«ï¼Œè¿™åŸå¸‚å¤ªç©º</p>\n<p>ä¾æ—§ç»å¸¸èƒ¡æ€ä¹±æƒ³ï¼Œä¸Šè‡³å®‡å®™ä¸‹è‡³å¾®å°˜ï¼Œäººäº‹ç‰©æ™¯æƒ…</p>\n<p>ä¹‹åå†è¡¥ä¸Šå§</p>\n<p>æœ€åå¸Œæœ›19å¹´è§…å¾—çŸ¥éŸ³ï¼Œåšå¾—ä½³äººï¼Œèµšå¾—é’±è´¢ï¼Œæ‘†è„±è‹¦ç—›</p>\n"},{"title":"å°ç¨‹åºçš„è·¯ç”±å°è£…","date":"2018-12-09T08:00:00.000Z","_content":"\n# å°ç¨‹åºè·¯ç”±å°è£…\n\nåŸºäº `mpvue` å°ç¨‹åºçš„è·¯ç”±å°è£…\n\n[toc]\n\n## \båŸºæœ¬ä½¿ç”¨\n\nç»„ä»¶å†…ä½¿ç”¨æ–¹æ³•ï¼š\n```js\n\n  // ä¸æºå¸¦è·¯ç”±å‚æ•°\n  this.$router.push('/home/page/index')\n  // æºå¸¦è·¯ç”±å‚æ•°\n  this.$router.push({\n    path: '/home/page/index',\n    query: {\n      //\n    },\n    reLaunch: true, // è°ƒç”¨wx.reLaunch\n    isTab: true // è°ƒç”¨wx.switchTag\n  })\n\n  // è¯»å–å½“å‰é¡µé¢è·¯ç”±å‚æ•°\n\n  \bconst { query } = this.$route\n\n```\nç»„ä»¶å¤–éƒ¨ä½¿ç”¨åªéœ€è¦å¼•å…¥router.jså†…éƒ¨å¯¼å‡ºçš„push\bæ–¹æ³•å³å¯\n\n\n## \bå°è£…èµ·æ­¥\n\nåˆ†ä¸ºä¸¤ç‚¹åˆ‡å…¥ï¼š\n  1. äº†è§£\bå¾®ä¿¡æä¾›çš„api\n  2. \bè‡ªå·±çš„éœ€æ±‚\n\næ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š\n\n- å¯¹å¾®ä¿¡å°ç¨‹åºçš„ `switchTabã€reLaunchã€navigateToã€redirectTo` äºŒæ¬¡å°è£…ï¼Œ\bå¯¹å¤–æš´éœ²pushæ–¹æ³•ï¼ŒåŒæ—¶å°†è·¯ç”±å®ä¾‹æŒ‚è½½åœ¨vueä¸Šï¼Œç»„ä»¶å†…éƒ¨é€šè¿‡ `this.$router.push` è°ƒç”¨ï¼Œç»„ä»¶å¤–éƒ¨å¯ä½¿ç”¨å¯¹å¤–æš´éœ²çš„pushæ–¹æ³•è¿›è¡Œé¡µé¢è·³è½¬ã€‚é¡µé¢å†…æ•°æ®é€šè¿‡è·¯ç”±å‚æ•°ä¼ é€’é€šè¿‡ `this.$route.query` è¯»å–ã€‚\n\n- è·¯ç”±é»˜è®¤è·³è½¬ä¸º `wx.navigateTo` \bé™æ€è·³è½¬ï¼Œè°ƒç”¨å…¶ä»–è·³è½¬æ–¹å¼éœ€ä¼ é€’ç›¸åº”å‚æ•°\n\n* \bå°è£…çš„è·³è½¬ä¼˜å…ˆçº§ï¼š\n```\n    wx.switchTab >> wx.reLaunch >> wx.navigateTo\n```\n\n- è·¯ç”±æ‹¥æœ‰æ‹¦æˆªå™¨ï¼Œåˆ†ä¸ºå…¨å±€æ‹¦æˆªå’Œé’ˆå¯¹æŒ‡å®šé¡µé¢æ ¹æ® `path` æ‹¦æˆªã€‚\n\n_æ³¨æ„ï¼š è·¯ç”±ä¸æ”¯æŒæŒ‡å®š `wx.redireactTo` è·³è½¬ï¼Œæ­¤æ–¹æ³•ç”¨äºè·¯ç”±å†…éƒ¨å¤„ç†å°ç¨‹åºå †æ ˆæº¢å‡ºï¼ˆå½“å‰å°ç¨‹åºé™æ€é¡µé¢å †æ ˆ\bä»…æ”¯æŒåå±‚ï¼‰_\n\n\nä¸‹é¢æˆ‘ä¼šç”±ä¸åŒçš„éœ€æ±‚ä»¥é—®ç­”æ–¹å¼\bä¸€æ­¥æ­¥å®Œæˆæ•´ä¸ªè·¯ç”±çš„ç®€å•å°è£…åŒæ—¶è®²è¿°å„ä¸ªéƒ¨åˆ†å¯èƒ½é‡åˆ°çš„é—®é¢˜\n\n\n### å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\n\n_éœ€æ±‚ï¼šé¡µé¢å†…ä½¿ç”¨ `this.$router.push` æ–¹æ³•è·³è½¬é¡µé¢_\n\né¦–å…ˆå°±æ˜¯æ–°å»º `index.js` è‡ªå®šä¹‰ä¸€ä¸ªæœ€åŸºæœ¬çš„ `push` æ–¹æ³•ç”¨æ¥è·³è½¬é¡µé¢\n\n``` js\n  // location ä¸ºè·¯ç”±ä¼ å‚\n  function push(location) {\n\n    const params = { url: location.path }\n\n    if (location.isTab) {\n      wx.switchTab(params)\n\n    } else if (location.reLaunch) {\n      wx.reLaunch(params)\n    } else if (location.redirect) {\n      wx.redirectTo(params)\n    } else {\n      wx.navigateTo(params)\n    }\n  }\n```\n\nç„¶åä¸ºäº†è®©æˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦å°† `push` æ–¹æ³•æŒ‚è½½åœ¨é¡µé¢çš„å®ä¾‹ä¸Š, åŒæ—¶ä½¿ç”¨æ’ä»¶å¼è°ƒç”¨åœ¨ `index.js` æ–‡ä»¶ä¸­å¯¼å‡º `install` æ–¹æ³•\n\n``` js\n  // å¯¼å‡º\n  export default {\n    install(Vue) {\n\n      const _router = {\n        mode: 'history',\n        push\n      }\n      // å®šä¹‰æè¿°ç¬¦getterï¼ˆä¹Ÿå¯ç›´æ¥èµ‹å€¼valueï¼‰\n      const $router = {\n        get() {\n          return _router\n        }\n      }\n      // æŒ‚è½½ (å„\bå‡­å–œå¥½ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼åœ¨prototype\bä¸Šï¼‰\n      Object.defineProperty(Vue.prototype, '$router', $router)\n    }\n  }\n```\n\næ¥ä¸‹æ¥åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶æ³¨å…¥ä¸Šé¢ `index.js` æ–‡ä»¶å¹¶æ‰§è¡Œ `Vue.use`\n\n``` js\n  import Vue from 'vue'\n  import router from './index.js'\n  \n  Vue.use(router) \n```\n\nå³å¯åœ¨ä»»æ„é¡µé¢ä½¿ç”¨ `this.$router.push` æ–¹æ³•å¹¶ä¼ å…¥ç›¸åº”è·³è½¬æ–¹å¼å’Œè·¯å¾„\n\nè¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š \bé¡¹ç›®è·³è½¬ä¸ºäº†æ›´ç¾è§‚ä¸»è¦ä½¿ç”¨ `wx.navigateTo`ï¼Œ \bè€Œå¾®ä¿¡å°ç¨‹åºæœ€å¤§é¡µé¢å †æ ˆåªæ”¯æŒ10å±‚ï¼Œæ‰€ä»¥è¯´é¡¹ç›®ä¸­å¦‚æœé¡µé¢è·³è½¬æå¤šæˆ–è€…å­˜åœ¨ç›¸äº’å…³è”çš„é¡µé¢äº’ç›¸è·³è½¬ä¾¿å®¹æ˜“å¯¼è‡´å †æ ˆæº¢å‡ºé¡µé¢ä¸è·³è½¬çš„æƒ…å†µï¼Œè¿™ä¸ªé—®é¢˜åœ¨å®Œæˆè·¯ç”±åŸºæœ¬åŠŸèƒ½åå•ç‹¬è§£é‡Š\n\n### é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\n\n_éœ€æ±‚ï¼š é¡µé¢å†…è·³è½¬é€šè¿‡è·¯ç”±å‚æ•° `query` å­—æ®µä¼ å‚ï¼Œ é€šè¿‡ `this.$route.query` è¯»å–å‚æ•°_\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿç®€å•è§£æ `push` \bæ–¹æ³•å‚æ•°çš„åŠŸèƒ½å‹å‡½æ•° `parseUrl`ï¼Œé‡Œé¢åŒ…æ‹¬å°†æ‰€ä¼ çš„ `query` å­—æ®µä»¥åœ°å€æ å‚æ•°å½¢å¼æ‹¼æ¥åœ¨ `path` åé¢çš„ä¸€ä¸ª `stringifyQuery` å‡½æ•°\n\n``` js\n  function parseUrl(location) {\n    const { path, query } = location\n    const queryStr = stringifyQuery(query)\n\n    return `${path}${queryStr}`\n  }\n\n  \bfunction stringifyQuery(obj) {\n    const res = obj\n      ? Object.keys(obj)\n          .filter(Boolean)\n          .map(key => {\n            let val = obj[key]\n\n            if ([Array, Object].includes(val.constructor)) {\n              val = JSON.stringify(obj[key])\n            }\n            return `${key}=${val}`\n          })\n          \n          .join('&')\n      : null\n\n    return res ? `?${res}` : ''\n  }\n```\n\næŠŠ `parseUrl` æ–¹æ³•æ·»åŠ åˆ°ä¸Šé¢çš„ `push` æ–¹æ³•ï¼ŒåŒæ—¶å‚æ•°å†…éƒ¨æ˜¯æ”¯æŒå°ç¨‹åºè·¯ç”±è·³è½¬è¿‡ç¨‹çš„`success`, `fail`, `complete` é’©å­çš„ \n\n``` js\n  // location ä¸ºè·¯ç”±ä¼ å‚\n  function push(location) {\n    // others ä¸ºç”¨æˆ·å¯èƒ½ä¼ é€’çš„ `success`, `fail`, `complete`\n    const { path, query, ...others } = location\n\n    const url = parseUrl({ path, query })\n\n    const params = { url, ...others }\n\n    if (location.isTab) {\n      wx.switchTab(params)\n\n    } else if (location.reLaunch) {\n      wx.reLaunch(params)\n    } else if (location.redirect) {\n      wx.redirectTo(params)\n    } else {\n      wx.navigateTo(params)\n    }\n  }\n```\nä»¥ä¸Šè·¯ç”±ä¼ å‚å¹¶è§£æéƒ¨åˆ†å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥è¯»å–å‚æ•°çš„æ§åˆ¶\béœ€è¦å®šä¹‰ä¸€ä¸ª `$route` å¯¹è±¡ä¸å‰é¢çš„ `$router` ä¸€è‡´æŒ‚è½½é¡µé¢å®ä¾‹ä¸Š\n\nè¿™ä¸€å±‚è¯»mpvueçš„å®ä¾‹åˆ›å»ºä¸€ä¸ª `parseRoute` å‡½æ•°ç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®å³å¯\n\næ­¤å¤„é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š ä¹‹å‰åªæ˜¯ä½¿ç”¨JSON.parseç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®ï¼Œå½“æ•°æ®ä¸ºé•¿æ•´å‹å­—ç¬¦ä¸²ï¼ˆé•¿åº¦è¶…è¿‡17ä½ï¼‰ä¼šä¸¢å¤±ç²¾åº¦è½¬0\nä»¥ä¸‹åŒæ—¶ç®€å•å¤„ç†ä¸€ä¸‹\n\n``` js\n  function parseRoute($mp) {\n    // $mp ä¸ºmpvueå®ä¾‹rootä¸ŠæŒ‚è½½çš„å¯¹è±¡\n    const _mp = $mp || {}\n    const path = _mp.page && _mp.page.route\n    const parseQuery = {}\n    const tempQuery = _mp.query\n\n    for (let k in tempQuery) {\n      let cur = tempQuery[k]\n\n      try {\n        // è§£å†³é•¿æ•´å‹ä¸¢å¤±ç²¾åº¦\n        const transfer = JSON.parse(tempQuery[k])\n\n        if (!(typeof transfer === 'number')) {\n          cur = transfer\n        }\n      } catch (e) {}\n\n      parseQuery[k] = cur\n    }\n\n    return {\n      parseQuery\n    }\n  }\n```\n\næœ€ç»ˆæŒ‚è½½åœ¨é¡µé¢å®ä¾‹ä¸Šï¼Œç”±äºè·¯ç”±å‚æ•°æ¯æ¬¡è·³è½¬éƒ½è¦æ›´æ–°æ‰€ä»¥æŒ‚è½½åœ¨å°ç¨‹åº `onShow` é’©å­ä¸Š\n\n``` js\n  const _route = {}\n\n  Vue.mixin({\n    onShow() {\n      const { $mp } = this.$root\n\n      _route = parseRoute($mp)\n    }\n  })\n\n  const $route = {\n    get() {\n      return _route\n    }\n  }\n\n  Object.defineProperty(Vue.prototype, '$route', $route)\n```\nä»¥ä¸Šä¾¿å®Œæˆè·¯ç”±å‚æ•°çš„è¯»å†™\n\n### \bè§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶\bé—®é¢˜\n\nå°ç¨‹åºçš„åŸºæœ¬åŠŸèƒ½å·²ç»å®ç°äº†ï¼Œä¸‹é¢å°±æ˜¯å †æ ˆçš„é™åˆ¶ï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦è·³è½¬å‰ç›‘å¬å½“å‰å †æ ˆçš„é•¿åº¦ï¼Œæ ˆæ»¡æ—¶æ”¹ç”¨é‡å®šå‘æ–¹æ³• `wx.redirectTo` å³å¯ï¼ˆå…¶ä»–æ—¶é—´é¡¹ç›®ä¸­ä»…ä½¿ç”¨ `navigateTo` å³å¯ï¼‰\n\né¦–å…ˆéœ€è¦ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•å †æ ˆé•¿åº¦(\bå¾®ä¿¡æä¾›ä¸€ä¸ªgetCurrentPagesçš„æ–¹æ³•)ï¼Œ åŒæ—¶æ›´æ”¹ `push` æ–¹æ³•\n\n``` js\n  // å½“å‰é¡µé¢å †æ ˆé•¿åº¦\n  let pageStackLen = 0\n  // å †æ ˆé™åˆ¶\n  const maxStackLen = 10\n\n  function push(location, success, ...ohters) {\n    pageStackLen = getCurrentPages().length + 1\n\n    const url = parseUrl(location)\n\n    // åŒ…è£…è·³è½¬æˆåŠŸçš„å›è°ƒ\n    const _success = function() {\n      pageStackLen = getCurrentPages().length + 1\n\n      success && success()\n    }\n\n    const params = { url, success: _success, ...ohters}\n\n    if (location.isTab) {\n      wx.switchTab(params)\n\n      pageStackLen = 1\n    } else if (location.reLaunch) {\n      wx.reLaunch(params)\n\n      pageStackLen = 1\n    } else {\n      if (pageStackLen >= maxStackLen) {\n        wx.redirectTo(params)\n        return\n      }\n      wx.navigateTo(params)\n    }\n  }\n```\nä»¥ä¸ŠåŸºæœ¬è§£å†³å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜\n\n### å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\n\nç°åœ¨å¯¹è·¯ç”±çš„è·³è½¬åšä¸€äº›åŸºæœ¬è¾…åŠ©åŠŸèƒ½çš„æ”¯æŒ\b `go`ã€ `back`, `replace` ç­‰æ–¹æ³•\n\n``` js\n  function replace(location, ...others) {\n    const url = parseUrl(location)\n\n    wx.redirectTo({\n      url,\n      ...others\n    })\n  }\n\n  function go(delta) {\n    wx.navigateBack({\n      delta\n    })\n  }\n\n  function back() {\n    wx.navigateBack()\n  }\n```\n\nå°†è¿™äº›æŒ‚åˆ° `$router` å¯¹è±¡\n\n``` js\n  const _router = {\n    mode: 'history',\n    push,\n    replace,\n    go,\n    back\n  }\n\n  const $router = {\n    get() {\n      return _router\n    }\n  }\n\n```\n\næ­¤å¤–è¿˜æœ‰æˆ‘ä»¬ä¸éœ€è¦\bé¡µé¢ä¹‹é—´ä¼ å‚æ—¶æ—¶pushæ–¹æ³•ç›´æ¥ä¼ å­—ç¬¦ä¸²è·¯å¾„ï¼Œè·¯ç”±å…¬ç”¨è·¯å¾„çœç•¥ï¼Œpushè°ƒç”¨ä¼ \båŸºæœ¬è·¯å¾„è‡ªåŠ¨è¡¥é½, \bå•ç‹¬å¯¼å‡º `push` æ–¹æ³•æ–¹ä¾¿ç»„ä»¶å¤–éƒ¨è°ƒç”¨ç­‰ä¼˜åŒ–\n\n\bæœ€åæˆ‘ä»¬è¿˜å·®è·¯ç”±æ‹¦æˆªå™¨åŠŸèƒ½çš„å®ç°\n\n### è·¯ç”±æ‹¦æˆªå™¨\n\néœ€æ±‚ï¼š å¯¹è±¡å½¢å¼é…ç½®è‡ªå·±è·¯ç”±è§„åˆ™\n  - `[triggerAll]`ï¼š \bæ‰€æœ‰è·¯ç”±è·³è½¬å‡ä¼šè§¦å‘\n  - `[triggerMatch]`ï¼š åŒ¹é…æŒ‡å®šè·¯ç”±ï¼Œå…¶ä¸­å¯é…ç½®å¤šä¸ªè§„åˆ™ï¼Œä»¥å‡½æ•°æ•°ç»„å½¢å¼ä¼ å…¥ï¼Œæ•°ç»„ä¸­æ‰€æœ‰å‡½æ•°éƒ½ä¼šåœ¨è¢«åŒ¹é…æ—¶è§¦å‘\n\nå‚æ•°ä»‹ç»ï¼š\n- `config`: æºå¸¦å½“å‰è·¯ç”±è·³è½¬ä¿¡æ¯ï¼ˆè·¯ç”±å‚æ•°ï¼‰\n- `to`: \bæ§åˆ¶è·³è½¬ï¼ˆè°ƒç”¨ `to()` ï¼‰\n\n\n\bä½¿ç”¨æ–¹å¼ï¼š\n\n``` js\nexport default {\n  triggerAll(config, to) {\n    console.log(config, 'enter interceptor')\n    to()\n  },\n  triggerMatch: {\n    '/home/pages/categoryList': [\n      (config, to) => {\n        if (/*flag*/) {\n          console.log(1)\n          to()\n        }\n      }\n    ]\n  }\n}\n```\n\næœ¬è´¨ä¸Šè¿˜æ˜¯å°†ä¹‹å‰å°è£…çš„è·¯ç”±æš´éœ²å‡ºæ¥çš„pushæ–¹æ³•å†æ¬¡å°è£…ä¸€å±‚ï¼Œå…¶ä¸­åŠ å…¥è‡ªå·±çš„é€»è¾‘è¾¾åˆ°ç›®çš„\n\næ–°å»º `interceptor.js`\n\né¦–å…ˆå¼•å…¥ä¹‹å‰çš„è·¯ç”±æ–¹ä¾¿åœ¨å®ä¾‹ä¸Šè°ƒç”¨ï¼Œå®šä¹‰ `triggerMatch` çš„å¯¹è±¡å­˜å‚¨å­˜å…¥çš„å‡½æ•° `key` ä¸ºå½“å‰è·¯ç”±çš„è·¯å¾„ï¼Œ\b`value` ä¸º ä¸­é—´ä»¶å‡½æ•°ç»„æˆçš„æ•°ç»„\n\nå…³é”®ï¼š å°† `push` æ–¹æ³•å½“åšå•ç‹¬çš„ä¸€ä¸ªä¸­é—´ä»¶å¹¶æ”¾åœ¨æ‰€æœ‰ä¸­é—´ä»¶çš„æœ€åæ‰§è¡Œ\n\n``` js\n  // å¼•å…¥\n  import router from './index.js'\n  // æŒ‚è½½\n  Vue.use(router)\n  // å­˜åŒ¹é…æŒ‡å®šè·¯ç”±çš„ä¸šåŠ¡å‡½æ•°\n  let matchMiddlewares = {}\n\n```\næ¥ä¸‹æ¥è¦æ„å»ºä¸€ä¸ªå¤„ç†æ¨å…¥è§„åˆ™çš„\bä¸šåŠ¡å‡½æ•°ï¼ˆä¸­é—´ä»¶ï¼‰çš„ `compose` å‡½æ•°\n\n\b\bè¿™ä¸ªå‡½æ•°çš„ä½œç”¨ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªï¼š\n - \bä¾æ¬¡æ´¾å‘æ¨å…¥æ‹¦æˆªå™¨çš„\bä¸šåŠ¡å‡½æ•°\n - æ§åˆ¶ä¸‹ä¸€æ¬¡æ´¾å‘çš„å¼€å§‹\n\n``` js\n  const compose = middlewares => (...args) => {\n    function dispatch(i) {\n      return !middlewares[i]\n        ? Promise.resolve('no arguments')\n        : Promise.resolve(\n            middlewares[i](...args, function() {\n              // æ´¾å‘ä¸‹ä¸ªè°ƒç”¨\n              // æ­¤å¤„å³æ˜¯æ‹¦æˆªå™¨ä¸­ç¬¬äºŒä¸ªå®å‚ to æ–¹æ³•çš„å‡½æ•°ä½“\n              // è°ƒåŠ¨ to() å³å¼€å¯ä¸‹ä¸€æ¬¡æ´¾å‘\n              return dispatch(++i)\n            })\n          )\n    }\n    // å¼€å¯è°ƒç”¨\n    return dispatch(0)\n  }\n```\n\n\båˆ›å»ºä¸€ä¸ªå‡½æ•° `getMatchMiddlewares` ç”¨æ¥æ ¹æ®æŒ‡å®šé”®å€¼è¯»å– `matchMiddlewares` ä¸­ä¸­é—´ä»¶å‡½æ•°æ•°ç»„\n\n```js\n  function getMatchMiddlewares(path) {\n    return matchMiddlewares.hasOwnProperty(path) ? matchMiddlewares[path] : []\n  }\n```\n\n\nè·¯ç”±åŒæ ·ä½¿ç”¨ `Vue.use` æ–¹æ³•æ³¨å†Œï¼Œè¿™é‡Œå¯¼å‡º \b`install` æ–¹æ³•, åœ¨é‡Œé¢ç»Ÿä¸€æ‰€æœ‰ä¸­é—´ä»¶å‡½æ•°\n\n``` js\n  // åŒ…è£… push\n  let $push\n\n  function pushMiddware(...args) {\n    $push(...args)\n  }\n\n  export default {\n    install(Vue, { triggerAll, triggerMatch }) {\n      // å­˜å‚¨åŸ push å‡½æ•°\n      $push = Vue.prototype.$router.push\n      // æ¥æ”¶ä¼ å…¥çš„åŒ¹é…å‡½æ•°\n      matchMiddlewares = Object.assign({}, triggerMatch)\n      \n      // é‡æ–°èµ‹å€¼\n      Vue.prototype.$router.push = (...args) => {\n        // åˆå¹¶\n        compose([...getMatchMiddlewares(path), triggerAll, pushMiddware])(\n          ...args\n        )\n      }\n    }\n  }\n\n\n```\n\nä¹‹ååœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥å³å¯\n\n``` js\n  import Vue from 'vue'\n  import interceptor from './interceptor.js'\n\n  Vue.use(interceptor)\n```\n\nè‡³æ­¤ä¾¿å®Œæˆäº†è·¯ç”±çš„æ‰€æœ‰åŠŸèƒ½çš„åŸºæœ¬å°è£…\n\nè¯¦ç»†ä»£ç å¯ä»¥æŸ¥çœ‹ [å°ç¨‹åºè·¯ç”±](http://git.yupaopao.com/fe/applet/iverson/tree/master/src/global/lib/router)\n\næ­¤ç¯‡æ–‡ç« å·²ç»å‘å¸ƒåœ¨ [http://doc.yupaopao.com](http://doc.yupaopao.com/pages/viewpage.action?pageId=7176857)\n\n## æ€»ç»“\nè·¯ç”±\båŸºæœ¬åŠŸèƒ½çš„å°è£…åŸºæœ¬è‡³æ­¤å·²ç»å…¨éƒ¨å®Œæˆï¼ŒåŸºæœ¬æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€è¦ã€‚ä½†ç”±äºè‡ªèº«æ°´å¹³é™åˆ¶ï¼Œä¼šå­˜åœ¨å„ç±»é—®é¢˜ï¼Œå¸Œæœ›å¤§å®¶æŒ‡å‡ºä¸€èµ·è®¨è®ºï¼Œå…±åŒè¿›æ­¥ã€‚\n\nå¼€æ”¾ã€çœŸå®ï¼peace.\n","source":"_posts/do something/å…³äºå°ç¨‹åºè·¯ç”±å°è£….md","raw":"---\ntitle: å°ç¨‹åºçš„è·¯ç”±å°è£…\ntags:\n  - å°è£…\n  - å¾®ä¿¡å°ç¨‹åº\n  - mpvue\n  - è·¯ç”±\ndate: 2018-12-09 16:00:00\ncategories: å°è£…\n---\n\n# å°ç¨‹åºè·¯ç”±å°è£…\n\nåŸºäº `mpvue` å°ç¨‹åºçš„è·¯ç”±å°è£…\n\n[toc]\n\n## \båŸºæœ¬ä½¿ç”¨\n\nç»„ä»¶å†…ä½¿ç”¨æ–¹æ³•ï¼š\n```js\n\n  // ä¸æºå¸¦è·¯ç”±å‚æ•°\n  this.$router.push('/home/page/index')\n  // æºå¸¦è·¯ç”±å‚æ•°\n  this.$router.push({\n    path: '/home/page/index',\n    query: {\n      //\n    },\n    reLaunch: true, // è°ƒç”¨wx.reLaunch\n    isTab: true // è°ƒç”¨wx.switchTag\n  })\n\n  // è¯»å–å½“å‰é¡µé¢è·¯ç”±å‚æ•°\n\n  \bconst { query } = this.$route\n\n```\nç»„ä»¶å¤–éƒ¨ä½¿ç”¨åªéœ€è¦å¼•å…¥router.jså†…éƒ¨å¯¼å‡ºçš„push\bæ–¹æ³•å³å¯\n\n\n## \bå°è£…èµ·æ­¥\n\nåˆ†ä¸ºä¸¤ç‚¹åˆ‡å…¥ï¼š\n  1. äº†è§£\bå¾®ä¿¡æä¾›çš„api\n  2. \bè‡ªå·±çš„éœ€æ±‚\n\næ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š\n\n- å¯¹å¾®ä¿¡å°ç¨‹åºçš„ `switchTabã€reLaunchã€navigateToã€redirectTo` äºŒæ¬¡å°è£…ï¼Œ\bå¯¹å¤–æš´éœ²pushæ–¹æ³•ï¼ŒåŒæ—¶å°†è·¯ç”±å®ä¾‹æŒ‚è½½åœ¨vueä¸Šï¼Œç»„ä»¶å†…éƒ¨é€šè¿‡ `this.$router.push` è°ƒç”¨ï¼Œç»„ä»¶å¤–éƒ¨å¯ä½¿ç”¨å¯¹å¤–æš´éœ²çš„pushæ–¹æ³•è¿›è¡Œé¡µé¢è·³è½¬ã€‚é¡µé¢å†…æ•°æ®é€šè¿‡è·¯ç”±å‚æ•°ä¼ é€’é€šè¿‡ `this.$route.query` è¯»å–ã€‚\n\n- è·¯ç”±é»˜è®¤è·³è½¬ä¸º `wx.navigateTo` \bé™æ€è·³è½¬ï¼Œè°ƒç”¨å…¶ä»–è·³è½¬æ–¹å¼éœ€ä¼ é€’ç›¸åº”å‚æ•°\n\n* \bå°è£…çš„è·³è½¬ä¼˜å…ˆçº§ï¼š\n```\n    wx.switchTab >> wx.reLaunch >> wx.navigateTo\n```\n\n- è·¯ç”±æ‹¥æœ‰æ‹¦æˆªå™¨ï¼Œåˆ†ä¸ºå…¨å±€æ‹¦æˆªå’Œé’ˆå¯¹æŒ‡å®šé¡µé¢æ ¹æ® `path` æ‹¦æˆªã€‚\n\n_æ³¨æ„ï¼š è·¯ç”±ä¸æ”¯æŒæŒ‡å®š `wx.redireactTo` è·³è½¬ï¼Œæ­¤æ–¹æ³•ç”¨äºè·¯ç”±å†…éƒ¨å¤„ç†å°ç¨‹åºå †æ ˆæº¢å‡ºï¼ˆå½“å‰å°ç¨‹åºé™æ€é¡µé¢å †æ ˆ\bä»…æ”¯æŒåå±‚ï¼‰_\n\n\nä¸‹é¢æˆ‘ä¼šç”±ä¸åŒçš„éœ€æ±‚ä»¥é—®ç­”æ–¹å¼\bä¸€æ­¥æ­¥å®Œæˆæ•´ä¸ªè·¯ç”±çš„ç®€å•å°è£…åŒæ—¶è®²è¿°å„ä¸ªéƒ¨åˆ†å¯èƒ½é‡åˆ°çš„é—®é¢˜\n\n\n### å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\n\n_éœ€æ±‚ï¼šé¡µé¢å†…ä½¿ç”¨ `this.$router.push` æ–¹æ³•è·³è½¬é¡µé¢_\n\né¦–å…ˆå°±æ˜¯æ–°å»º `index.js` è‡ªå®šä¹‰ä¸€ä¸ªæœ€åŸºæœ¬çš„ `push` æ–¹æ³•ç”¨æ¥è·³è½¬é¡µé¢\n\n``` js\n  // location ä¸ºè·¯ç”±ä¼ å‚\n  function push(location) {\n\n    const params = { url: location.path }\n\n    if (location.isTab) {\n      wx.switchTab(params)\n\n    } else if (location.reLaunch) {\n      wx.reLaunch(params)\n    } else if (location.redirect) {\n      wx.redirectTo(params)\n    } else {\n      wx.navigateTo(params)\n    }\n  }\n```\n\nç„¶åä¸ºäº†è®©æˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦å°† `push` æ–¹æ³•æŒ‚è½½åœ¨é¡µé¢çš„å®ä¾‹ä¸Š, åŒæ—¶ä½¿ç”¨æ’ä»¶å¼è°ƒç”¨åœ¨ `index.js` æ–‡ä»¶ä¸­å¯¼å‡º `install` æ–¹æ³•\n\n``` js\n  // å¯¼å‡º\n  export default {\n    install(Vue) {\n\n      const _router = {\n        mode: 'history',\n        push\n      }\n      // å®šä¹‰æè¿°ç¬¦getterï¼ˆä¹Ÿå¯ç›´æ¥èµ‹å€¼valueï¼‰\n      const $router = {\n        get() {\n          return _router\n        }\n      }\n      // æŒ‚è½½ (å„\bå‡­å–œå¥½ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼åœ¨prototype\bä¸Šï¼‰\n      Object.defineProperty(Vue.prototype, '$router', $router)\n    }\n  }\n```\n\næ¥ä¸‹æ¥åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶æ³¨å…¥ä¸Šé¢ `index.js` æ–‡ä»¶å¹¶æ‰§è¡Œ `Vue.use`\n\n``` js\n  import Vue from 'vue'\n  import router from './index.js'\n  \n  Vue.use(router) \n```\n\nå³å¯åœ¨ä»»æ„é¡µé¢ä½¿ç”¨ `this.$router.push` æ–¹æ³•å¹¶ä¼ å…¥ç›¸åº”è·³è½¬æ–¹å¼å’Œè·¯å¾„\n\nè¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š \bé¡¹ç›®è·³è½¬ä¸ºäº†æ›´ç¾è§‚ä¸»è¦ä½¿ç”¨ `wx.navigateTo`ï¼Œ \bè€Œå¾®ä¿¡å°ç¨‹åºæœ€å¤§é¡µé¢å †æ ˆåªæ”¯æŒ10å±‚ï¼Œæ‰€ä»¥è¯´é¡¹ç›®ä¸­å¦‚æœé¡µé¢è·³è½¬æå¤šæˆ–è€…å­˜åœ¨ç›¸äº’å…³è”çš„é¡µé¢äº’ç›¸è·³è½¬ä¾¿å®¹æ˜“å¯¼è‡´å †æ ˆæº¢å‡ºé¡µé¢ä¸è·³è½¬çš„æƒ…å†µï¼Œè¿™ä¸ªé—®é¢˜åœ¨å®Œæˆè·¯ç”±åŸºæœ¬åŠŸèƒ½åå•ç‹¬è§£é‡Š\n\n### é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\n\n_éœ€æ±‚ï¼š é¡µé¢å†…è·³è½¬é€šè¿‡è·¯ç”±å‚æ•° `query` å­—æ®µä¼ å‚ï¼Œ é€šè¿‡ `this.$route.query` è¯»å–å‚æ•°_\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿç®€å•è§£æ `push` \bæ–¹æ³•å‚æ•°çš„åŠŸèƒ½å‹å‡½æ•° `parseUrl`ï¼Œé‡Œé¢åŒ…æ‹¬å°†æ‰€ä¼ çš„ `query` å­—æ®µä»¥åœ°å€æ å‚æ•°å½¢å¼æ‹¼æ¥åœ¨ `path` åé¢çš„ä¸€ä¸ª `stringifyQuery` å‡½æ•°\n\n``` js\n  function parseUrl(location) {\n    const { path, query } = location\n    const queryStr = stringifyQuery(query)\n\n    return `${path}${queryStr}`\n  }\n\n  \bfunction stringifyQuery(obj) {\n    const res = obj\n      ? Object.keys(obj)\n          .filter(Boolean)\n          .map(key => {\n            let val = obj[key]\n\n            if ([Array, Object].includes(val.constructor)) {\n              val = JSON.stringify(obj[key])\n            }\n            return `${key}=${val}`\n          })\n          \n          .join('&')\n      : null\n\n    return res ? `?${res}` : ''\n  }\n```\n\næŠŠ `parseUrl` æ–¹æ³•æ·»åŠ åˆ°ä¸Šé¢çš„ `push` æ–¹æ³•ï¼ŒåŒæ—¶å‚æ•°å†…éƒ¨æ˜¯æ”¯æŒå°ç¨‹åºè·¯ç”±è·³è½¬è¿‡ç¨‹çš„`success`, `fail`, `complete` é’©å­çš„ \n\n``` js\n  // location ä¸ºè·¯ç”±ä¼ å‚\n  function push(location) {\n    // others ä¸ºç”¨æˆ·å¯èƒ½ä¼ é€’çš„ `success`, `fail`, `complete`\n    const { path, query, ...others } = location\n\n    const url = parseUrl({ path, query })\n\n    const params = { url, ...others }\n\n    if (location.isTab) {\n      wx.switchTab(params)\n\n    } else if (location.reLaunch) {\n      wx.reLaunch(params)\n    } else if (location.redirect) {\n      wx.redirectTo(params)\n    } else {\n      wx.navigateTo(params)\n    }\n  }\n```\nä»¥ä¸Šè·¯ç”±ä¼ å‚å¹¶è§£æéƒ¨åˆ†å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥è¯»å–å‚æ•°çš„æ§åˆ¶\béœ€è¦å®šä¹‰ä¸€ä¸ª `$route` å¯¹è±¡ä¸å‰é¢çš„ `$router` ä¸€è‡´æŒ‚è½½é¡µé¢å®ä¾‹ä¸Š\n\nè¿™ä¸€å±‚è¯»mpvueçš„å®ä¾‹åˆ›å»ºä¸€ä¸ª `parseRoute` å‡½æ•°ç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®å³å¯\n\næ­¤å¤„é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š ä¹‹å‰åªæ˜¯ä½¿ç”¨JSON.parseç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®ï¼Œå½“æ•°æ®ä¸ºé•¿æ•´å‹å­—ç¬¦ä¸²ï¼ˆé•¿åº¦è¶…è¿‡17ä½ï¼‰ä¼šä¸¢å¤±ç²¾åº¦è½¬0\nä»¥ä¸‹åŒæ—¶ç®€å•å¤„ç†ä¸€ä¸‹\n\n``` js\n  function parseRoute($mp) {\n    // $mp ä¸ºmpvueå®ä¾‹rootä¸ŠæŒ‚è½½çš„å¯¹è±¡\n    const _mp = $mp || {}\n    const path = _mp.page && _mp.page.route\n    const parseQuery = {}\n    const tempQuery = _mp.query\n\n    for (let k in tempQuery) {\n      let cur = tempQuery[k]\n\n      try {\n        // è§£å†³é•¿æ•´å‹ä¸¢å¤±ç²¾åº¦\n        const transfer = JSON.parse(tempQuery[k])\n\n        if (!(typeof transfer === 'number')) {\n          cur = transfer\n        }\n      } catch (e) {}\n\n      parseQuery[k] = cur\n    }\n\n    return {\n      parseQuery\n    }\n  }\n```\n\næœ€ç»ˆæŒ‚è½½åœ¨é¡µé¢å®ä¾‹ä¸Šï¼Œç”±äºè·¯ç”±å‚æ•°æ¯æ¬¡è·³è½¬éƒ½è¦æ›´æ–°æ‰€ä»¥æŒ‚è½½åœ¨å°ç¨‹åº `onShow` é’©å­ä¸Š\n\n``` js\n  const _route = {}\n\n  Vue.mixin({\n    onShow() {\n      const { $mp } = this.$root\n\n      _route = parseRoute($mp)\n    }\n  })\n\n  const $route = {\n    get() {\n      return _route\n    }\n  }\n\n  Object.defineProperty(Vue.prototype, '$route', $route)\n```\nä»¥ä¸Šä¾¿å®Œæˆè·¯ç”±å‚æ•°çš„è¯»å†™\n\n### \bè§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶\bé—®é¢˜\n\nå°ç¨‹åºçš„åŸºæœ¬åŠŸèƒ½å·²ç»å®ç°äº†ï¼Œä¸‹é¢å°±æ˜¯å †æ ˆçš„é™åˆ¶ï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦è·³è½¬å‰ç›‘å¬å½“å‰å †æ ˆçš„é•¿åº¦ï¼Œæ ˆæ»¡æ—¶æ”¹ç”¨é‡å®šå‘æ–¹æ³• `wx.redirectTo` å³å¯ï¼ˆå…¶ä»–æ—¶é—´é¡¹ç›®ä¸­ä»…ä½¿ç”¨ `navigateTo` å³å¯ï¼‰\n\né¦–å…ˆéœ€è¦ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•å †æ ˆé•¿åº¦(\bå¾®ä¿¡æä¾›ä¸€ä¸ªgetCurrentPagesçš„æ–¹æ³•)ï¼Œ åŒæ—¶æ›´æ”¹ `push` æ–¹æ³•\n\n``` js\n  // å½“å‰é¡µé¢å †æ ˆé•¿åº¦\n  let pageStackLen = 0\n  // å †æ ˆé™åˆ¶\n  const maxStackLen = 10\n\n  function push(location, success, ...ohters) {\n    pageStackLen = getCurrentPages().length + 1\n\n    const url = parseUrl(location)\n\n    // åŒ…è£…è·³è½¬æˆåŠŸçš„å›è°ƒ\n    const _success = function() {\n      pageStackLen = getCurrentPages().length + 1\n\n      success && success()\n    }\n\n    const params = { url, success: _success, ...ohters}\n\n    if (location.isTab) {\n      wx.switchTab(params)\n\n      pageStackLen = 1\n    } else if (location.reLaunch) {\n      wx.reLaunch(params)\n\n      pageStackLen = 1\n    } else {\n      if (pageStackLen >= maxStackLen) {\n        wx.redirectTo(params)\n        return\n      }\n      wx.navigateTo(params)\n    }\n  }\n```\nä»¥ä¸ŠåŸºæœ¬è§£å†³å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜\n\n### å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\n\nç°åœ¨å¯¹è·¯ç”±çš„è·³è½¬åšä¸€äº›åŸºæœ¬è¾…åŠ©åŠŸèƒ½çš„æ”¯æŒ\b `go`ã€ `back`, `replace` ç­‰æ–¹æ³•\n\n``` js\n  function replace(location, ...others) {\n    const url = parseUrl(location)\n\n    wx.redirectTo({\n      url,\n      ...others\n    })\n  }\n\n  function go(delta) {\n    wx.navigateBack({\n      delta\n    })\n  }\n\n  function back() {\n    wx.navigateBack()\n  }\n```\n\nå°†è¿™äº›æŒ‚åˆ° `$router` å¯¹è±¡\n\n``` js\n  const _router = {\n    mode: 'history',\n    push,\n    replace,\n    go,\n    back\n  }\n\n  const $router = {\n    get() {\n      return _router\n    }\n  }\n\n```\n\næ­¤å¤–è¿˜æœ‰æˆ‘ä»¬ä¸éœ€è¦\bé¡µé¢ä¹‹é—´ä¼ å‚æ—¶æ—¶pushæ–¹æ³•ç›´æ¥ä¼ å­—ç¬¦ä¸²è·¯å¾„ï¼Œè·¯ç”±å…¬ç”¨è·¯å¾„çœç•¥ï¼Œpushè°ƒç”¨ä¼ \båŸºæœ¬è·¯å¾„è‡ªåŠ¨è¡¥é½, \bå•ç‹¬å¯¼å‡º `push` æ–¹æ³•æ–¹ä¾¿ç»„ä»¶å¤–éƒ¨è°ƒç”¨ç­‰ä¼˜åŒ–\n\n\bæœ€åæˆ‘ä»¬è¿˜å·®è·¯ç”±æ‹¦æˆªå™¨åŠŸèƒ½çš„å®ç°\n\n### è·¯ç”±æ‹¦æˆªå™¨\n\néœ€æ±‚ï¼š å¯¹è±¡å½¢å¼é…ç½®è‡ªå·±è·¯ç”±è§„åˆ™\n  - `[triggerAll]`ï¼š \bæ‰€æœ‰è·¯ç”±è·³è½¬å‡ä¼šè§¦å‘\n  - `[triggerMatch]`ï¼š åŒ¹é…æŒ‡å®šè·¯ç”±ï¼Œå…¶ä¸­å¯é…ç½®å¤šä¸ªè§„åˆ™ï¼Œä»¥å‡½æ•°æ•°ç»„å½¢å¼ä¼ å…¥ï¼Œæ•°ç»„ä¸­æ‰€æœ‰å‡½æ•°éƒ½ä¼šåœ¨è¢«åŒ¹é…æ—¶è§¦å‘\n\nå‚æ•°ä»‹ç»ï¼š\n- `config`: æºå¸¦å½“å‰è·¯ç”±è·³è½¬ä¿¡æ¯ï¼ˆè·¯ç”±å‚æ•°ï¼‰\n- `to`: \bæ§åˆ¶è·³è½¬ï¼ˆè°ƒç”¨ `to()` ï¼‰\n\n\n\bä½¿ç”¨æ–¹å¼ï¼š\n\n``` js\nexport default {\n  triggerAll(config, to) {\n    console.log(config, 'enter interceptor')\n    to()\n  },\n  triggerMatch: {\n    '/home/pages/categoryList': [\n      (config, to) => {\n        if (/*flag*/) {\n          console.log(1)\n          to()\n        }\n      }\n    ]\n  }\n}\n```\n\næœ¬è´¨ä¸Šè¿˜æ˜¯å°†ä¹‹å‰å°è£…çš„è·¯ç”±æš´éœ²å‡ºæ¥çš„pushæ–¹æ³•å†æ¬¡å°è£…ä¸€å±‚ï¼Œå…¶ä¸­åŠ å…¥è‡ªå·±çš„é€»è¾‘è¾¾åˆ°ç›®çš„\n\næ–°å»º `interceptor.js`\n\né¦–å…ˆå¼•å…¥ä¹‹å‰çš„è·¯ç”±æ–¹ä¾¿åœ¨å®ä¾‹ä¸Šè°ƒç”¨ï¼Œå®šä¹‰ `triggerMatch` çš„å¯¹è±¡å­˜å‚¨å­˜å…¥çš„å‡½æ•° `key` ä¸ºå½“å‰è·¯ç”±çš„è·¯å¾„ï¼Œ\b`value` ä¸º ä¸­é—´ä»¶å‡½æ•°ç»„æˆçš„æ•°ç»„\n\nå…³é”®ï¼š å°† `push` æ–¹æ³•å½“åšå•ç‹¬çš„ä¸€ä¸ªä¸­é—´ä»¶å¹¶æ”¾åœ¨æ‰€æœ‰ä¸­é—´ä»¶çš„æœ€åæ‰§è¡Œ\n\n``` js\n  // å¼•å…¥\n  import router from './index.js'\n  // æŒ‚è½½\n  Vue.use(router)\n  // å­˜åŒ¹é…æŒ‡å®šè·¯ç”±çš„ä¸šåŠ¡å‡½æ•°\n  let matchMiddlewares = {}\n\n```\næ¥ä¸‹æ¥è¦æ„å»ºä¸€ä¸ªå¤„ç†æ¨å…¥è§„åˆ™çš„\bä¸šåŠ¡å‡½æ•°ï¼ˆä¸­é—´ä»¶ï¼‰çš„ `compose` å‡½æ•°\n\n\b\bè¿™ä¸ªå‡½æ•°çš„ä½œç”¨ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªï¼š\n - \bä¾æ¬¡æ´¾å‘æ¨å…¥æ‹¦æˆªå™¨çš„\bä¸šåŠ¡å‡½æ•°\n - æ§åˆ¶ä¸‹ä¸€æ¬¡æ´¾å‘çš„å¼€å§‹\n\n``` js\n  const compose = middlewares => (...args) => {\n    function dispatch(i) {\n      return !middlewares[i]\n        ? Promise.resolve('no arguments')\n        : Promise.resolve(\n            middlewares[i](...args, function() {\n              // æ´¾å‘ä¸‹ä¸ªè°ƒç”¨\n              // æ­¤å¤„å³æ˜¯æ‹¦æˆªå™¨ä¸­ç¬¬äºŒä¸ªå®å‚ to æ–¹æ³•çš„å‡½æ•°ä½“\n              // è°ƒåŠ¨ to() å³å¼€å¯ä¸‹ä¸€æ¬¡æ´¾å‘\n              return dispatch(++i)\n            })\n          )\n    }\n    // å¼€å¯è°ƒç”¨\n    return dispatch(0)\n  }\n```\n\n\båˆ›å»ºä¸€ä¸ªå‡½æ•° `getMatchMiddlewares` ç”¨æ¥æ ¹æ®æŒ‡å®šé”®å€¼è¯»å– `matchMiddlewares` ä¸­ä¸­é—´ä»¶å‡½æ•°æ•°ç»„\n\n```js\n  function getMatchMiddlewares(path) {\n    return matchMiddlewares.hasOwnProperty(path) ? matchMiddlewares[path] : []\n  }\n```\n\n\nè·¯ç”±åŒæ ·ä½¿ç”¨ `Vue.use` æ–¹æ³•æ³¨å†Œï¼Œè¿™é‡Œå¯¼å‡º \b`install` æ–¹æ³•, åœ¨é‡Œé¢ç»Ÿä¸€æ‰€æœ‰ä¸­é—´ä»¶å‡½æ•°\n\n``` js\n  // åŒ…è£… push\n  let $push\n\n  function pushMiddware(...args) {\n    $push(...args)\n  }\n\n  export default {\n    install(Vue, { triggerAll, triggerMatch }) {\n      // å­˜å‚¨åŸ push å‡½æ•°\n      $push = Vue.prototype.$router.push\n      // æ¥æ”¶ä¼ å…¥çš„åŒ¹é…å‡½æ•°\n      matchMiddlewares = Object.assign({}, triggerMatch)\n      \n      // é‡æ–°èµ‹å€¼\n      Vue.prototype.$router.push = (...args) => {\n        // åˆå¹¶\n        compose([...getMatchMiddlewares(path), triggerAll, pushMiddware])(\n          ...args\n        )\n      }\n    }\n  }\n\n\n```\n\nä¹‹ååœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥å³å¯\n\n``` js\n  import Vue from 'vue'\n  import interceptor from './interceptor.js'\n\n  Vue.use(interceptor)\n```\n\nè‡³æ­¤ä¾¿å®Œæˆäº†è·¯ç”±çš„æ‰€æœ‰åŠŸèƒ½çš„åŸºæœ¬å°è£…\n\nè¯¦ç»†ä»£ç å¯ä»¥æŸ¥çœ‹ [å°ç¨‹åºè·¯ç”±](http://git.yupaopao.com/fe/applet/iverson/tree/master/src/global/lib/router)\n\næ­¤ç¯‡æ–‡ç« å·²ç»å‘å¸ƒåœ¨ [http://doc.yupaopao.com](http://doc.yupaopao.com/pages/viewpage.action?pageId=7176857)\n\n## æ€»ç»“\nè·¯ç”±\båŸºæœ¬åŠŸèƒ½çš„å°è£…åŸºæœ¬è‡³æ­¤å·²ç»å…¨éƒ¨å®Œæˆï¼ŒåŸºæœ¬æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€è¦ã€‚ä½†ç”±äºè‡ªèº«æ°´å¹³é™åˆ¶ï¼Œä¼šå­˜åœ¨å„ç±»é—®é¢˜ï¼Œå¸Œæœ›å¤§å®¶æŒ‡å‡ºä¸€èµ·è®¨è®ºï¼Œå…±åŒè¿›æ­¥ã€‚\n\nå¼€æ”¾ã€çœŸå®ï¼peace.\n","slug":"do something/å…³äºå°ç¨‹åºè·¯ç”±å°è£…","published":1,"updated":"2019-02-23T04:36:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsh7ughj000s64valgq5mep5","content":"<h1 id=\"å°ç¨‹åºè·¯ç”±å°è£…\"><a href=\"#å°ç¨‹åºè·¯ç”±å°è£…\" class=\"headerlink\" title=\"å°ç¨‹åºè·¯ç”±å°è£…\"></a>å°ç¨‹åºè·¯ç”±å°è£…</h1><p>åŸºäº <code>mpvue</code> å°ç¨‹åºçš„è·¯ç”±å°è£…</p>\n<p>[toc]</p>\n<h2 id=\"åŸºæœ¬ä½¿ç”¨\"><a href=\"#åŸºæœ¬ä½¿ç”¨\" class=\"headerlink\" title=\"\båŸºæœ¬ä½¿ç”¨\"></a>\båŸºæœ¬ä½¿ç”¨</h2><p>ç»„ä»¶å†…ä½¿ç”¨æ–¹æ³•ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¸æºå¸¦è·¯ç”±å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.$router.push(<span class=\"string\">'/home/page/index'</span>)</span><br><span class=\"line\"><span class=\"comment\">// æºå¸¦è·¯ç”±å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.$router.push(&#123;</span><br><span class=\"line\">  path: <span class=\"string\">'/home/page/index'</span>,</span><br><span class=\"line\">  query: &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  reLaunch: <span class=\"literal\">true</span>, <span class=\"comment\">// è°ƒç”¨wx.reLaunch</span></span><br><span class=\"line\">  isTab: <span class=\"literal\">true</span> <span class=\"comment\">// è°ƒç”¨wx.switchTag</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¯»å–å½“å‰é¡µé¢è·¯ç”±å‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\">\b<span class=\"keyword\">const</span> &#123; query &#125; = <span class=\"keyword\">this</span>.$route</span><br></pre></td></tr></table></figure></p>\n<p>ç»„ä»¶å¤–éƒ¨ä½¿ç”¨åªéœ€è¦å¼•å…¥router.jså†…éƒ¨å¯¼å‡ºçš„push\bæ–¹æ³•å³å¯</p>\n<h2 id=\"å°è£…èµ·æ­¥\"><a href=\"#å°è£…èµ·æ­¥\" class=\"headerlink\" title=\"\bå°è£…èµ·æ­¥\"></a>\bå°è£…èµ·æ­¥</h2><p>åˆ†ä¸ºä¸¤ç‚¹åˆ‡å…¥ï¼š</p>\n<ol>\n<li>äº†è§£\bå¾®ä¿¡æä¾›çš„api</li>\n<li>\bè‡ªå·±çš„éœ€æ±‚</li>\n</ol>\n<p>æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>\n<ul>\n<li><p>å¯¹å¾®ä¿¡å°ç¨‹åºçš„ <code>switchTabã€reLaunchã€navigateToã€redirectTo</code> äºŒæ¬¡å°è£…ï¼Œ\bå¯¹å¤–æš´éœ²pushæ–¹æ³•ï¼ŒåŒæ—¶å°†è·¯ç”±å®ä¾‹æŒ‚è½½åœ¨vueä¸Šï¼Œç»„ä»¶å†…éƒ¨é€šè¿‡ <code>this.$router.push</code> è°ƒç”¨ï¼Œç»„ä»¶å¤–éƒ¨å¯ä½¿ç”¨å¯¹å¤–æš´éœ²çš„pushæ–¹æ³•è¿›è¡Œé¡µé¢è·³è½¬ã€‚é¡µé¢å†…æ•°æ®é€šè¿‡è·¯ç”±å‚æ•°ä¼ é€’é€šè¿‡ <code>this.$route.query</code> è¯»å–ã€‚</p>\n</li>\n<li><p>è·¯ç”±é»˜è®¤è·³è½¬ä¸º <code>wx.navigateTo</code> \bé™æ€è·³è½¬ï¼Œè°ƒç”¨å…¶ä»–è·³è½¬æ–¹å¼éœ€ä¼ é€’ç›¸åº”å‚æ•°</p>\n</li>\n</ul>\n<ul>\n<li>\bå°è£…çš„è·³è½¬ä¼˜å…ˆçº§ï¼š<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wx.switchTab &gt;&gt; wx.reLaunch &gt;&gt; wx.navigateTo</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li>è·¯ç”±æ‹¥æœ‰æ‹¦æˆªå™¨ï¼Œåˆ†ä¸ºå…¨å±€æ‹¦æˆªå’Œé’ˆå¯¹æŒ‡å®šé¡µé¢æ ¹æ® <code>path</code> æ‹¦æˆªã€‚</li>\n</ul>\n<p><em>æ³¨æ„ï¼š è·¯ç”±ä¸æ”¯æŒæŒ‡å®š <code>wx.redireactTo</code> è·³è½¬ï¼Œæ­¤æ–¹æ³•ç”¨äºè·¯ç”±å†…éƒ¨å¤„ç†å°ç¨‹åºå †æ ˆæº¢å‡ºï¼ˆå½“å‰å°ç¨‹åºé™æ€é¡µé¢å †æ ˆ\bä»…æ”¯æŒåå±‚ï¼‰</em></p>\n<p>ä¸‹é¢æˆ‘ä¼šç”±ä¸åŒçš„éœ€æ±‚ä»¥é—®ç­”æ–¹å¼\bä¸€æ­¥æ­¥å®Œæˆæ•´ä¸ªè·¯ç”±çš„ç®€å•å°è£…åŒæ—¶è®²è¿°å„ä¸ªéƒ¨åˆ†å¯èƒ½é‡åˆ°çš„é—®é¢˜</p>\n<h3 id=\"å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\"><a href=\"#å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\" class=\"headerlink\" title=\"å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\"></a>å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½</h3><p><em>éœ€æ±‚ï¼šé¡µé¢å†…ä½¿ç”¨ <code>this.$router.push</code> æ–¹æ³•è·³è½¬é¡µé¢</em></p>\n<p>é¦–å…ˆå°±æ˜¯æ–°å»º <code>index.js</code> è‡ªå®šä¹‰ä¸€ä¸ªæœ€åŸºæœ¬çš„ <code>push</code> æ–¹æ³•ç”¨æ¥è·³è½¬é¡µé¢</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// location ä¸ºè·¯ç”±ä¼ å‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> params = &#123; <span class=\"attr\">url</span>: location.path &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.isTab) &#123;</span><br><span class=\"line\">    wx.switchTab(params)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.reLaunch) &#123;</span><br><span class=\"line\">    wx.reLaunch(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.redirect) &#123;</span><br><span class=\"line\">    wx.redirectTo(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    wx.navigateTo(params)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç„¶åä¸ºäº†è®©æˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦å°† <code>push</code> æ–¹æ³•æŒ‚è½½åœ¨é¡µé¢çš„å®ä¾‹ä¸Š, åŒæ—¶ä½¿ç”¨æ’ä»¶å¼è°ƒç”¨åœ¨ <code>index.js</code> æ–‡ä»¶ä¸­å¯¼å‡º <code>install</code> æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¯¼å‡º</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  install(Vue) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> _router = &#123;</span><br><span class=\"line\">      mode: <span class=\"string\">'history'</span>,</span><br><span class=\"line\">      push</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å®šä¹‰æè¿°ç¬¦getterï¼ˆä¹Ÿå¯ç›´æ¥èµ‹å€¼valueï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> $router = &#123;</span><br><span class=\"line\">      get() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _router</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æŒ‚è½½ (å„\bå‡­å–œå¥½ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼åœ¨prototype\bä¸Šï¼‰</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(Vue.prototype, <span class=\"string\">'$router'</span>, $router)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ¥ä¸‹æ¥åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶æ³¨å…¥ä¸Šé¢ <code>index.js</code> æ–‡ä»¶å¹¶æ‰§è¡Œ <code>Vue.use</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">'./index.js'</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(router)</span><br></pre></td></tr></table></figure>\n<p>å³å¯åœ¨ä»»æ„é¡µé¢ä½¿ç”¨ <code>this.$router.push</code> æ–¹æ³•å¹¶ä¼ å…¥ç›¸åº”è·³è½¬æ–¹å¼å’Œè·¯å¾„</p>\n<p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š \bé¡¹ç›®è·³è½¬ä¸ºäº†æ›´ç¾è§‚ä¸»è¦ä½¿ç”¨ <code>wx.navigateTo</code>ï¼Œ \bè€Œå¾®ä¿¡å°ç¨‹åºæœ€å¤§é¡µé¢å †æ ˆåªæ”¯æŒ10å±‚ï¼Œæ‰€ä»¥è¯´é¡¹ç›®ä¸­å¦‚æœé¡µé¢è·³è½¬æå¤šæˆ–è€…å­˜åœ¨ç›¸äº’å…³è”çš„é¡µé¢äº’ç›¸è·³è½¬ä¾¿å®¹æ˜“å¯¼è‡´å †æ ˆæº¢å‡ºé¡µé¢ä¸è·³è½¬çš„æƒ…å†µï¼Œè¿™ä¸ªé—®é¢˜åœ¨å®Œæˆè·¯ç”±åŸºæœ¬åŠŸèƒ½åå•ç‹¬è§£é‡Š</p>\n<h3 id=\"é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\"><a href=\"#é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\" class=\"headerlink\" title=\"é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\"></a>é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°</h3><p><em>éœ€æ±‚ï¼š é¡µé¢å†…è·³è½¬é€šè¿‡è·¯ç”±å‚æ•° <code>query</code> å­—æ®µä¼ å‚ï¼Œ é€šè¿‡ <code>this.$route.query</code> è¯»å–å‚æ•°</em></p>\n<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿç®€å•è§£æ <code>push</code> \bæ–¹æ³•å‚æ•°çš„åŠŸèƒ½å‹å‡½æ•° <code>parseUrl</code>ï¼Œé‡Œé¢åŒ…æ‹¬å°†æ‰€ä¼ çš„ <code>query</code> å­—æ®µä»¥åœ°å€æ å‚æ•°å½¢å¼æ‹¼æ¥åœ¨ <code>path</code> åé¢çš„ä¸€ä¸ª <code>stringifyQuery</code> å‡½æ•°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseUrl</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; path, query &#125; = location</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queryStr = stringifyQuery(query)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;path&#125;</span><span class=\"subst\">$&#123;queryStr&#125;</span>`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\b<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">stringifyQuery</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = obj</span><br><span class=\"line\">    ? <span class=\"built_in\">Object</span>.keys(obj)</span><br><span class=\"line\">        .filter(<span class=\"built_in\">Boolean</span>)</span><br><span class=\"line\">        .map(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> val = obj[key]</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ([<span class=\"built_in\">Array</span>, <span class=\"built_in\">Object</span>].includes(val.constructor)) &#123;</span><br><span class=\"line\">            val = <span class=\"built_in\">JSON</span>.stringify(obj[key])</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;key&#125;</span>=<span class=\"subst\">$&#123;val&#125;</span>`</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\">        .join(<span class=\"string\">'&amp;'</span>)</span><br><span class=\"line\">    : <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res ? <span class=\"string\">`?<span class=\"subst\">$&#123;res&#125;</span>`</span> : <span class=\"string\">''</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠŠ <code>parseUrl</code> æ–¹æ³•æ·»åŠ åˆ°ä¸Šé¢çš„ <code>push</code> æ–¹æ³•ï¼ŒåŒæ—¶å‚æ•°å†…éƒ¨æ˜¯æ”¯æŒå°ç¨‹åºè·¯ç”±è·³è½¬è¿‡ç¨‹çš„<code>success</code>, <code>fail</code>, <code>complete</code> é’©å­çš„ </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// location ä¸ºè·¯ç”±ä¼ å‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// others ä¸ºç”¨æˆ·å¯èƒ½ä¼ é€’çš„ `success`, `fail`, `complete`</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; path, query, ...others &#125; = location</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = parseUrl(&#123; path, query &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> params = &#123; url, ...others &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.isTab) &#123;</span><br><span class=\"line\">    wx.switchTab(params)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.reLaunch) &#123;</span><br><span class=\"line\">    wx.reLaunch(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.redirect) &#123;</span><br><span class=\"line\">    wx.redirectTo(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    wx.navigateTo(params)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šè·¯ç”±ä¼ å‚å¹¶è§£æéƒ¨åˆ†å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥è¯»å–å‚æ•°çš„æ§åˆ¶\béœ€è¦å®šä¹‰ä¸€ä¸ª <code>$route</code> å¯¹è±¡ä¸å‰é¢çš„ <code>$router</code> ä¸€è‡´æŒ‚è½½é¡µé¢å®ä¾‹ä¸Š</p>\n<p>è¿™ä¸€å±‚è¯»mpvueçš„å®ä¾‹åˆ›å»ºä¸€ä¸ª <code>parseRoute</code> å‡½æ•°ç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®å³å¯</p>\n<p>æ­¤å¤„é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š ä¹‹å‰åªæ˜¯ä½¿ç”¨JSON.parseç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®ï¼Œå½“æ•°æ®ä¸ºé•¿æ•´å‹å­—ç¬¦ä¸²ï¼ˆé•¿åº¦è¶…è¿‡17ä½ï¼‰ä¼šä¸¢å¤±ç²¾åº¦è½¬0<br>ä»¥ä¸‹åŒæ—¶ç®€å•å¤„ç†ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseRoute</span>(<span class=\"params\">$mp</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// $mp ä¸ºmpvueå®ä¾‹rootä¸ŠæŒ‚è½½çš„å¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> _mp = $mp || &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> path = _mp.page &amp;&amp; _mp.page.route</span><br><span class=\"line\">  <span class=\"keyword\">const</span> parseQuery = &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> tempQuery = _mp.query</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> tempQuery) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cur = tempQuery[k]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è§£å†³é•¿æ•´å‹ä¸¢å¤±ç²¾åº¦</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> transfer = <span class=\"built_in\">JSON</span>.parse(tempQuery[k])</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!(<span class=\"keyword\">typeof</span> transfer === <span class=\"string\">'number'</span>)) &#123;</span><br><span class=\"line\">        cur = transfer</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    parseQuery[k] = cur</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    parseQuery</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ€ç»ˆæŒ‚è½½åœ¨é¡µé¢å®ä¾‹ä¸Šï¼Œç”±äºè·¯ç”±å‚æ•°æ¯æ¬¡è·³è½¬éƒ½è¦æ›´æ–°æ‰€ä»¥æŒ‚è½½åœ¨å°ç¨‹åº <code>onShow</code> é’©å­ä¸Š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> _route = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Vue.mixin(&#123;</span><br><span class=\"line\">  onShow() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; $mp &#125; = <span class=\"keyword\">this</span>.$root</span><br><span class=\"line\"></span><br><span class=\"line\">    _route = parseRoute($mp)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> $route = &#123;</span><br><span class=\"line\">  get() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _route</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(Vue.prototype, <span class=\"string\">'$route'</span>, $route)</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šä¾¿å®Œæˆè·¯ç”±å‚æ•°çš„è¯»å†™</p>\n<h3 id=\"è§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜\"><a href=\"#è§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜\" class=\"headerlink\" title=\"\bè§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶\bé—®é¢˜\"></a>\bè§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶\bé—®é¢˜</h3><p>å°ç¨‹åºçš„åŸºæœ¬åŠŸèƒ½å·²ç»å®ç°äº†ï¼Œä¸‹é¢å°±æ˜¯å †æ ˆçš„é™åˆ¶ï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦è·³è½¬å‰ç›‘å¬å½“å‰å †æ ˆçš„é•¿åº¦ï¼Œæ ˆæ»¡æ—¶æ”¹ç”¨é‡å®šå‘æ–¹æ³• <code>wx.redirectTo</code> å³å¯ï¼ˆå…¶ä»–æ—¶é—´é¡¹ç›®ä¸­ä»…ä½¿ç”¨ <code>navigateTo</code> å³å¯ï¼‰</p>\n<p>é¦–å…ˆéœ€è¦ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•å †æ ˆé•¿åº¦(\bå¾®ä¿¡æä¾›ä¸€ä¸ªgetCurrentPagesçš„æ–¹æ³•)ï¼Œ åŒæ—¶æ›´æ”¹ <code>push</code> æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å½“å‰é¡µé¢å †æ ˆé•¿åº¦</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> pageStackLen = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"comment\">// å †æ ˆé™åˆ¶</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> maxStackLen = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">location, success, ...ohters</span>) </span>&#123;</span><br><span class=\"line\">  pageStackLen = getCurrentPages().length + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = parseUrl(location)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// åŒ…è£…è·³è½¬æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> _success = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pageStackLen = getCurrentPages().length + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    success &amp;&amp; success()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> params = &#123; url, <span class=\"attr\">success</span>: _success, ...ohters&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.isTab) &#123;</span><br><span class=\"line\">    wx.switchTab(params)</span><br><span class=\"line\"></span><br><span class=\"line\">    pageStackLen = <span class=\"number\">1</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.reLaunch) &#123;</span><br><span class=\"line\">    wx.reLaunch(params)</span><br><span class=\"line\"></span><br><span class=\"line\">    pageStackLen = <span class=\"number\">1</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pageStackLen &gt;= maxStackLen) &#123;</span><br><span class=\"line\">      wx.redirectTo(params)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    wx.navigateTo(params)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸ŠåŸºæœ¬è§£å†³å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜</p>\n<h3 id=\"å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\"><a href=\"#å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\" class=\"headerlink\" title=\"å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\"></a>å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½</h3><p>ç°åœ¨å¯¹è·¯ç”±çš„è·³è½¬åšä¸€äº›åŸºæœ¬è¾…åŠ©åŠŸèƒ½çš„æ”¯æŒ\b <code>go</code>ã€ <code>back</code>, <code>replace</code> ç­‰æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replace</span>(<span class=\"params\">location, ...others</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = parseUrl(location)</span><br><span class=\"line\"></span><br><span class=\"line\">  wx.redirectTo(&#123;</span><br><span class=\"line\">    url,</span><br><span class=\"line\">    ...others</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">go</span>(<span class=\"params\">delta</span>) </span>&#123;</span><br><span class=\"line\">  wx.navigateBack(&#123;</span><br><span class=\"line\">    delta</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">back</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  wx.navigateBack()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å°†è¿™äº›æŒ‚åˆ° <code>$router</code> å¯¹è±¡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> _router = &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'history'</span>,</span><br><span class=\"line\">  push,</span><br><span class=\"line\">  replace,</span><br><span class=\"line\">  go,</span><br><span class=\"line\">  back</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> $router = &#123;</span><br><span class=\"line\">  get() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _router</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ­¤å¤–è¿˜æœ‰æˆ‘ä»¬ä¸éœ€è¦\bé¡µé¢ä¹‹é—´ä¼ å‚æ—¶æ—¶pushæ–¹æ³•ç›´æ¥ä¼ å­—ç¬¦ä¸²è·¯å¾„ï¼Œè·¯ç”±å…¬ç”¨è·¯å¾„çœç•¥ï¼Œpushè°ƒç”¨ä¼ \båŸºæœ¬è·¯å¾„è‡ªåŠ¨è¡¥é½, \bå•ç‹¬å¯¼å‡º <code>push</code> æ–¹æ³•æ–¹ä¾¿ç»„ä»¶å¤–éƒ¨è°ƒç”¨ç­‰ä¼˜åŒ–</p>\n<p>\bæœ€åæˆ‘ä»¬è¿˜å·®è·¯ç”±æ‹¦æˆªå™¨åŠŸèƒ½çš„å®ç°</p>\n<h3 id=\"è·¯ç”±æ‹¦æˆªå™¨\"><a href=\"#è·¯ç”±æ‹¦æˆªå™¨\" class=\"headerlink\" title=\"è·¯ç”±æ‹¦æˆªå™¨\"></a>è·¯ç”±æ‹¦æˆªå™¨</h3><p>éœ€æ±‚ï¼š å¯¹è±¡å½¢å¼é…ç½®è‡ªå·±è·¯ç”±è§„åˆ™</p>\n<ul>\n<li><code>[triggerAll]</code>ï¼š \bæ‰€æœ‰è·¯ç”±è·³è½¬å‡ä¼šè§¦å‘</li>\n<li><code>[triggerMatch]</code>ï¼š åŒ¹é…æŒ‡å®šè·¯ç”±ï¼Œå…¶ä¸­å¯é…ç½®å¤šä¸ªè§„åˆ™ï¼Œä»¥å‡½æ•°æ•°ç»„å½¢å¼ä¼ å…¥ï¼Œæ•°ç»„ä¸­æ‰€æœ‰å‡½æ•°éƒ½ä¼šåœ¨è¢«åŒ¹é…æ—¶è§¦å‘</li>\n</ul>\n<p>å‚æ•°ä»‹ç»ï¼š</p>\n<ul>\n<li><code>config</code>: æºå¸¦å½“å‰è·¯ç”±è·³è½¬ä¿¡æ¯ï¼ˆè·¯ç”±å‚æ•°ï¼‰</li>\n<li><code>to</code>: \bæ§åˆ¶è·³è½¬ï¼ˆè°ƒç”¨ <code>to()</code> ï¼‰</li>\n</ul>\n<p>\bä½¿ç”¨æ–¹å¼ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  triggerAll(config, to) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(config, <span class=\"string\">'enter interceptor'</span>)</span><br><span class=\"line\">    to()</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  triggerMatch: &#123;</span><br><span class=\"line\">    <span class=\"string\">'/home/pages/categoryList'</span>: [</span><br><span class=\"line\">      (config, to) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"comment\">/*flag*/</span>) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">          to()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ¬è´¨ä¸Šè¿˜æ˜¯å°†ä¹‹å‰å°è£…çš„è·¯ç”±æš´éœ²å‡ºæ¥çš„pushæ–¹æ³•å†æ¬¡å°è£…ä¸€å±‚ï¼Œå…¶ä¸­åŠ å…¥è‡ªå·±çš„é€»è¾‘è¾¾åˆ°ç›®çš„</p>\n<p>æ–°å»º <code>interceptor.js</code></p>\n<p>é¦–å…ˆå¼•å…¥ä¹‹å‰çš„è·¯ç”±æ–¹ä¾¿åœ¨å®ä¾‹ä¸Šè°ƒç”¨ï¼Œå®šä¹‰ <code>triggerMatch</code> çš„å¯¹è±¡å­˜å‚¨å­˜å…¥çš„å‡½æ•° <code>key</code> ä¸ºå½“å‰è·¯ç”±çš„è·¯å¾„ï¼Œ\b<code>value</code> ä¸º ä¸­é—´ä»¶å‡½æ•°ç»„æˆçš„æ•°ç»„</p>\n<p>å…³é”®ï¼š å°† <code>push</code> æ–¹æ³•å½“åšå•ç‹¬çš„ä¸€ä¸ªä¸­é—´ä»¶å¹¶æ”¾åœ¨æ‰€æœ‰ä¸­é—´ä»¶çš„æœ€åæ‰§è¡Œ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¼•å…¥</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">'./index.js'</span></span><br><span class=\"line\"><span class=\"comment\">// æŒ‚è½½</span></span><br><span class=\"line\">Vue.use(router)</span><br><span class=\"line\"><span class=\"comment\">// å­˜åŒ¹é…æŒ‡å®šè·¯ç”±çš„ä¸šåŠ¡å‡½æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> matchMiddlewares = &#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>æ¥ä¸‹æ¥è¦æ„å»ºä¸€ä¸ªå¤„ç†æ¨å…¥è§„åˆ™çš„\bä¸šåŠ¡å‡½æ•°ï¼ˆä¸­é—´ä»¶ï¼‰çš„ <code>compose</code> å‡½æ•°</p>\n<p>\b\bè¿™ä¸ªå‡½æ•°çš„ä½œç”¨ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªï¼š</p>\n<ul>\n<li>\bä¾æ¬¡æ´¾å‘æ¨å…¥æ‹¦æˆªå™¨çš„\bä¸šåŠ¡å‡½æ•°</li>\n<li>æ§åˆ¶ä¸‹ä¸€æ¬¡æ´¾å‘çš„å¼€å§‹</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"function\"><span class=\"params\">middlewares</span> =&gt;</span> (...args) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dispatch</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !middlewares[i]</span><br><span class=\"line\">      ? <span class=\"built_in\">Promise</span>.resolve(<span class=\"string\">'no arguments'</span>)</span><br><span class=\"line\">      : <span class=\"built_in\">Promise</span>.resolve(</span><br><span class=\"line\">          middlewares[i](...args, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ´¾å‘ä¸‹ä¸ªè°ƒç”¨</span></span><br><span class=\"line\">            <span class=\"comment\">// æ­¤å¤„å³æ˜¯æ‹¦æˆªå™¨ä¸­ç¬¬äºŒä¸ªå®å‚ to æ–¹æ³•çš„å‡½æ•°ä½“</span></span><br><span class=\"line\">            <span class=\"comment\">// è°ƒåŠ¨ to() å³å¼€å¯ä¸‹ä¸€æ¬¡æ´¾å‘</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> dispatch(++i)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¼€å¯è°ƒç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> dispatch(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>\båˆ›å»ºä¸€ä¸ªå‡½æ•° <code>getMatchMiddlewares</code> ç”¨æ¥æ ¹æ®æŒ‡å®šé”®å€¼è¯»å– <code>matchMiddlewares</code> ä¸­ä¸­é—´ä»¶å‡½æ•°æ•°ç»„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getMatchMiddlewares</span>(<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> matchMiddlewares.hasOwnProperty(path) ? matchMiddlewares[path] : []</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è·¯ç”±åŒæ ·ä½¿ç”¨ <code>Vue.use</code> æ–¹æ³•æ³¨å†Œï¼Œè¿™é‡Œå¯¼å‡º \b<code>install</code> æ–¹æ³•, åœ¨é‡Œé¢ç»Ÿä¸€æ‰€æœ‰ä¸­é—´ä»¶å‡½æ•°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åŒ…è£… push</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> $push</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushMiddware</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">  $push(...args)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  install(Vue, &#123; triggerAll, triggerMatch &#125;) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å­˜å‚¨åŸ push å‡½æ•°</span></span><br><span class=\"line\">    $push = Vue.prototype.$router.push</span><br><span class=\"line\">    <span class=\"comment\">// æ¥æ”¶ä¼ å…¥çš„åŒ¹é…å‡½æ•°</span></span><br><span class=\"line\">    matchMiddlewares = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, triggerMatch)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// é‡æ–°èµ‹å€¼</span></span><br><span class=\"line\">    Vue.prototype.$router.push = <span class=\"function\">(<span class=\"params\">...args</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// åˆå¹¶</span></span><br><span class=\"line\">      compose([...getMatchMiddlewares(path), triggerAll, pushMiddware])(</span><br><span class=\"line\">        ...args</span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¹‹ååœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥å³å¯</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> interceptor <span class=\"keyword\">from</span> <span class=\"string\">'./interceptor.js'</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(interceptor)</span><br></pre></td></tr></table></figure>\n<p>è‡³æ­¤ä¾¿å®Œæˆäº†è·¯ç”±çš„æ‰€æœ‰åŠŸèƒ½çš„åŸºæœ¬å°è£…</p>\n<p>è¯¦ç»†ä»£ç å¯ä»¥æŸ¥çœ‹ <a href=\"http://git.yupaopao.com/fe/applet/iverson/tree/master/src/global/lib/router\" target=\"_blank\" rel=\"noopener\">å°ç¨‹åºè·¯ç”±</a></p>\n<p>æ­¤ç¯‡æ–‡ç« å·²ç»å‘å¸ƒåœ¨ <a href=\"http://doc.yupaopao.com/pages/viewpage.action?pageId=7176857\" target=\"_blank\" rel=\"noopener\">http://doc.yupaopao.com</a></p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>è·¯ç”±\båŸºæœ¬åŠŸèƒ½çš„å°è£…åŸºæœ¬è‡³æ­¤å·²ç»å…¨éƒ¨å®Œæˆï¼ŒåŸºæœ¬æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€è¦ã€‚ä½†ç”±äºè‡ªèº«æ°´å¹³é™åˆ¶ï¼Œä¼šå­˜åœ¨å„ç±»é—®é¢˜ï¼Œå¸Œæœ›å¤§å®¶æŒ‡å‡ºä¸€èµ·è®¨è®ºï¼Œå…±åŒè¿›æ­¥ã€‚</p>\n<p>å¼€æ”¾ã€çœŸå®ï¼peace.</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å°ç¨‹åºè·¯ç”±å°è£…\"><a href=\"#å°ç¨‹åºè·¯ç”±å°è£…\" class=\"headerlink\" title=\"å°ç¨‹åºè·¯ç”±å°è£…\"></a>å°ç¨‹åºè·¯ç”±å°è£…</h1><p>åŸºäº <code>mpvue</code> å°ç¨‹åºçš„è·¯ç”±å°è£…</p>\n<p>[toc]</p>\n<h2 id=\"åŸºæœ¬ä½¿ç”¨\"><a href=\"#åŸºæœ¬ä½¿ç”¨\" class=\"headerlink\" title=\"\båŸºæœ¬ä½¿ç”¨\"></a>\båŸºæœ¬ä½¿ç”¨</h2><p>ç»„ä»¶å†…ä½¿ç”¨æ–¹æ³•ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¸æºå¸¦è·¯ç”±å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.$router.push(<span class=\"string\">'/home/page/index'</span>)</span><br><span class=\"line\"><span class=\"comment\">// æºå¸¦è·¯ç”±å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.$router.push(&#123;</span><br><span class=\"line\">  path: <span class=\"string\">'/home/page/index'</span>,</span><br><span class=\"line\">  query: &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  reLaunch: <span class=\"literal\">true</span>, <span class=\"comment\">// è°ƒç”¨wx.reLaunch</span></span><br><span class=\"line\">  isTab: <span class=\"literal\">true</span> <span class=\"comment\">// è°ƒç”¨wx.switchTag</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¯»å–å½“å‰é¡µé¢è·¯ç”±å‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\">\b<span class=\"keyword\">const</span> &#123; query &#125; = <span class=\"keyword\">this</span>.$route</span><br></pre></td></tr></table></figure></p>\n<p>ç»„ä»¶å¤–éƒ¨ä½¿ç”¨åªéœ€è¦å¼•å…¥router.jså†…éƒ¨å¯¼å‡ºçš„push\bæ–¹æ³•å³å¯</p>\n<h2 id=\"å°è£…èµ·æ­¥\"><a href=\"#å°è£…èµ·æ­¥\" class=\"headerlink\" title=\"\bå°è£…èµ·æ­¥\"></a>\bå°è£…èµ·æ­¥</h2><p>åˆ†ä¸ºä¸¤ç‚¹åˆ‡å…¥ï¼š</p>\n<ol>\n<li>äº†è§£\bå¾®ä¿¡æä¾›çš„api</li>\n<li>\bè‡ªå·±çš„éœ€æ±‚</li>\n</ol>\n<p>æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>\n<ul>\n<li><p>å¯¹å¾®ä¿¡å°ç¨‹åºçš„ <code>switchTabã€reLaunchã€navigateToã€redirectTo</code> äºŒæ¬¡å°è£…ï¼Œ\bå¯¹å¤–æš´éœ²pushæ–¹æ³•ï¼ŒåŒæ—¶å°†è·¯ç”±å®ä¾‹æŒ‚è½½åœ¨vueä¸Šï¼Œç»„ä»¶å†…éƒ¨é€šè¿‡ <code>this.$router.push</code> è°ƒç”¨ï¼Œç»„ä»¶å¤–éƒ¨å¯ä½¿ç”¨å¯¹å¤–æš´éœ²çš„pushæ–¹æ³•è¿›è¡Œé¡µé¢è·³è½¬ã€‚é¡µé¢å†…æ•°æ®é€šè¿‡è·¯ç”±å‚æ•°ä¼ é€’é€šè¿‡ <code>this.$route.query</code> è¯»å–ã€‚</p>\n</li>\n<li><p>è·¯ç”±é»˜è®¤è·³è½¬ä¸º <code>wx.navigateTo</code> \bé™æ€è·³è½¬ï¼Œè°ƒç”¨å…¶ä»–è·³è½¬æ–¹å¼éœ€ä¼ é€’ç›¸åº”å‚æ•°</p>\n</li>\n</ul>\n<ul>\n<li>\bå°è£…çš„è·³è½¬ä¼˜å…ˆçº§ï¼š<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wx.switchTab &gt;&gt; wx.reLaunch &gt;&gt; wx.navigateTo</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li>è·¯ç”±æ‹¥æœ‰æ‹¦æˆªå™¨ï¼Œåˆ†ä¸ºå…¨å±€æ‹¦æˆªå’Œé’ˆå¯¹æŒ‡å®šé¡µé¢æ ¹æ® <code>path</code> æ‹¦æˆªã€‚</li>\n</ul>\n<p><em>æ³¨æ„ï¼š è·¯ç”±ä¸æ”¯æŒæŒ‡å®š <code>wx.redireactTo</code> è·³è½¬ï¼Œæ­¤æ–¹æ³•ç”¨äºè·¯ç”±å†…éƒ¨å¤„ç†å°ç¨‹åºå †æ ˆæº¢å‡ºï¼ˆå½“å‰å°ç¨‹åºé™æ€é¡µé¢å †æ ˆ\bä»…æ”¯æŒåå±‚ï¼‰</em></p>\n<p>ä¸‹é¢æˆ‘ä¼šç”±ä¸åŒçš„éœ€æ±‚ä»¥é—®ç­”æ–¹å¼\bä¸€æ­¥æ­¥å®Œæˆæ•´ä¸ªè·¯ç”±çš„ç®€å•å°è£…åŒæ—¶è®²è¿°å„ä¸ªéƒ¨åˆ†å¯èƒ½é‡åˆ°çš„é—®é¢˜</p>\n<h3 id=\"å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\"><a href=\"#å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\" class=\"headerlink\" title=\"å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½\"></a>å¦‚ä½•å®ŒæˆåŸºæœ¬è·³è½¬åŠŸèƒ½</h3><p><em>éœ€æ±‚ï¼šé¡µé¢å†…ä½¿ç”¨ <code>this.$router.push</code> æ–¹æ³•è·³è½¬é¡µé¢</em></p>\n<p>é¦–å…ˆå°±æ˜¯æ–°å»º <code>index.js</code> è‡ªå®šä¹‰ä¸€ä¸ªæœ€åŸºæœ¬çš„ <code>push</code> æ–¹æ³•ç”¨æ¥è·³è½¬é¡µé¢</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// location ä¸ºè·¯ç”±ä¼ å‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> params = &#123; <span class=\"attr\">url</span>: location.path &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.isTab) &#123;</span><br><span class=\"line\">    wx.switchTab(params)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.reLaunch) &#123;</span><br><span class=\"line\">    wx.reLaunch(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.redirect) &#123;</span><br><span class=\"line\">    wx.redirectTo(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    wx.navigateTo(params)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç„¶åä¸ºäº†è®©æˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦å°† <code>push</code> æ–¹æ³•æŒ‚è½½åœ¨é¡µé¢çš„å®ä¾‹ä¸Š, åŒæ—¶ä½¿ç”¨æ’ä»¶å¼è°ƒç”¨åœ¨ <code>index.js</code> æ–‡ä»¶ä¸­å¯¼å‡º <code>install</code> æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¯¼å‡º</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  install(Vue) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> _router = &#123;</span><br><span class=\"line\">      mode: <span class=\"string\">'history'</span>,</span><br><span class=\"line\">      push</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å®šä¹‰æè¿°ç¬¦getterï¼ˆä¹Ÿå¯ç›´æ¥èµ‹å€¼valueï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> $router = &#123;</span><br><span class=\"line\">      get() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _router</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æŒ‚è½½ (å„\bå‡­å–œå¥½ä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼åœ¨prototype\bä¸Šï¼‰</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(Vue.prototype, <span class=\"string\">'$router'</span>, $router)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ¥ä¸‹æ¥åœ¨é¡¹ç›®å…¥å£æ–‡ä»¶æ³¨å…¥ä¸Šé¢ <code>index.js</code> æ–‡ä»¶å¹¶æ‰§è¡Œ <code>Vue.use</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">'./index.js'</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(router)</span><br></pre></td></tr></table></figure>\n<p>å³å¯åœ¨ä»»æ„é¡µé¢ä½¿ç”¨ <code>this.$router.push</code> æ–¹æ³•å¹¶ä¼ å…¥ç›¸åº”è·³è½¬æ–¹å¼å’Œè·¯å¾„</p>\n<p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š \bé¡¹ç›®è·³è½¬ä¸ºäº†æ›´ç¾è§‚ä¸»è¦ä½¿ç”¨ <code>wx.navigateTo</code>ï¼Œ \bè€Œå¾®ä¿¡å°ç¨‹åºæœ€å¤§é¡µé¢å †æ ˆåªæ”¯æŒ10å±‚ï¼Œæ‰€ä»¥è¯´é¡¹ç›®ä¸­å¦‚æœé¡µé¢è·³è½¬æå¤šæˆ–è€…å­˜åœ¨ç›¸äº’å…³è”çš„é¡µé¢äº’ç›¸è·³è½¬ä¾¿å®¹æ˜“å¯¼è‡´å †æ ˆæº¢å‡ºé¡µé¢ä¸è·³è½¬çš„æƒ…å†µï¼Œè¿™ä¸ªé—®é¢˜åœ¨å®Œæˆè·¯ç”±åŸºæœ¬åŠŸèƒ½åå•ç‹¬è§£é‡Š</p>\n<h3 id=\"é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\"><a href=\"#é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\" class=\"headerlink\" title=\"é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°\"></a>é¡µé¢ä¹‹é—´å¦‚ä½•è¯»å†™å‚æ•°</h3><p><em>éœ€æ±‚ï¼š é¡µé¢å†…è·³è½¬é€šè¿‡è·¯ç”±å‚æ•° <code>query</code> å­—æ®µä¼ å‚ï¼Œ é€šè¿‡ <code>this.$route.query</code> è¯»å–å‚æ•°</em></p>\n<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿç®€å•è§£æ <code>push</code> \bæ–¹æ³•å‚æ•°çš„åŠŸèƒ½å‹å‡½æ•° <code>parseUrl</code>ï¼Œé‡Œé¢åŒ…æ‹¬å°†æ‰€ä¼ çš„ <code>query</code> å­—æ®µä»¥åœ°å€æ å‚æ•°å½¢å¼æ‹¼æ¥åœ¨ <code>path</code> åé¢çš„ä¸€ä¸ª <code>stringifyQuery</code> å‡½æ•°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseUrl</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; path, query &#125; = location</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queryStr = stringifyQuery(query)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;path&#125;</span><span class=\"subst\">$&#123;queryStr&#125;</span>`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\b<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">stringifyQuery</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = obj</span><br><span class=\"line\">    ? <span class=\"built_in\">Object</span>.keys(obj)</span><br><span class=\"line\">        .filter(<span class=\"built_in\">Boolean</span>)</span><br><span class=\"line\">        .map(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> val = obj[key]</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ([<span class=\"built_in\">Array</span>, <span class=\"built_in\">Object</span>].includes(val.constructor)) &#123;</span><br><span class=\"line\">            val = <span class=\"built_in\">JSON</span>.stringify(obj[key])</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;key&#125;</span>=<span class=\"subst\">$&#123;val&#125;</span>`</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\">        .join(<span class=\"string\">'&amp;'</span>)</span><br><span class=\"line\">    : <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res ? <span class=\"string\">`?<span class=\"subst\">$&#123;res&#125;</span>`</span> : <span class=\"string\">''</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠŠ <code>parseUrl</code> æ–¹æ³•æ·»åŠ åˆ°ä¸Šé¢çš„ <code>push</code> æ–¹æ³•ï¼ŒåŒæ—¶å‚æ•°å†…éƒ¨æ˜¯æ”¯æŒå°ç¨‹åºè·¯ç”±è·³è½¬è¿‡ç¨‹çš„<code>success</code>, <code>fail</code>, <code>complete</code> é’©å­çš„ </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// location ä¸ºè·¯ç”±ä¼ å‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// others ä¸ºç”¨æˆ·å¯èƒ½ä¼ é€’çš„ `success`, `fail`, `complete`</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; path, query, ...others &#125; = location</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = parseUrl(&#123; path, query &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> params = &#123; url, ...others &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.isTab) &#123;</span><br><span class=\"line\">    wx.switchTab(params)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.reLaunch) &#123;</span><br><span class=\"line\">    wx.reLaunch(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.redirect) &#123;</span><br><span class=\"line\">    wx.redirectTo(params)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    wx.navigateTo(params)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šè·¯ç”±ä¼ å‚å¹¶è§£æéƒ¨åˆ†å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥è¯»å–å‚æ•°çš„æ§åˆ¶\béœ€è¦å®šä¹‰ä¸€ä¸ª <code>$route</code> å¯¹è±¡ä¸å‰é¢çš„ <code>$router</code> ä¸€è‡´æŒ‚è½½é¡µé¢å®ä¾‹ä¸Š</p>\n<p>è¿™ä¸€å±‚è¯»mpvueçš„å®ä¾‹åˆ›å»ºä¸€ä¸ª <code>parseRoute</code> å‡½æ•°ç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®å³å¯</p>\n<p>æ­¤å¤„é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š ä¹‹å‰åªæ˜¯ä½¿ç”¨JSON.parseç®€å•å¤„ç†ä¸€ä¸‹æ•°æ®ï¼Œå½“æ•°æ®ä¸ºé•¿æ•´å‹å­—ç¬¦ä¸²ï¼ˆé•¿åº¦è¶…è¿‡17ä½ï¼‰ä¼šä¸¢å¤±ç²¾åº¦è½¬0<br>ä»¥ä¸‹åŒæ—¶ç®€å•å¤„ç†ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseRoute</span>(<span class=\"params\">$mp</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// $mp ä¸ºmpvueå®ä¾‹rootä¸ŠæŒ‚è½½çš„å¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> _mp = $mp || &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> path = _mp.page &amp;&amp; _mp.page.route</span><br><span class=\"line\">  <span class=\"keyword\">const</span> parseQuery = &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> tempQuery = _mp.query</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> tempQuery) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cur = tempQuery[k]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è§£å†³é•¿æ•´å‹ä¸¢å¤±ç²¾åº¦</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> transfer = <span class=\"built_in\">JSON</span>.parse(tempQuery[k])</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!(<span class=\"keyword\">typeof</span> transfer === <span class=\"string\">'number'</span>)) &#123;</span><br><span class=\"line\">        cur = transfer</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    parseQuery[k] = cur</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    parseQuery</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ€ç»ˆæŒ‚è½½åœ¨é¡µé¢å®ä¾‹ä¸Šï¼Œç”±äºè·¯ç”±å‚æ•°æ¯æ¬¡è·³è½¬éƒ½è¦æ›´æ–°æ‰€ä»¥æŒ‚è½½åœ¨å°ç¨‹åº <code>onShow</code> é’©å­ä¸Š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> _route = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Vue.mixin(&#123;</span><br><span class=\"line\">  onShow() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; $mp &#125; = <span class=\"keyword\">this</span>.$root</span><br><span class=\"line\"></span><br><span class=\"line\">    _route = parseRoute($mp)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> $route = &#123;</span><br><span class=\"line\">  get() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _route</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(Vue.prototype, <span class=\"string\">'$route'</span>, $route)</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šä¾¿å®Œæˆè·¯ç”±å‚æ•°çš„è¯»å†™</p>\n<h3 id=\"è§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜\"><a href=\"#è§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜\" class=\"headerlink\" title=\"\bè§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶\bé—®é¢˜\"></a>\bè§£å†³ä¸Šé¢æå‡ºçš„å°ç¨‹åºå †æ ˆé™åˆ¶\bé—®é¢˜</h3><p>å°ç¨‹åºçš„åŸºæœ¬åŠŸèƒ½å·²ç»å®ç°äº†ï¼Œä¸‹é¢å°±æ˜¯å †æ ˆçš„é™åˆ¶ï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦è·³è½¬å‰ç›‘å¬å½“å‰å †æ ˆçš„é•¿åº¦ï¼Œæ ˆæ»¡æ—¶æ”¹ç”¨é‡å®šå‘æ–¹æ³• <code>wx.redirectTo</code> å³å¯ï¼ˆå…¶ä»–æ—¶é—´é¡¹ç›®ä¸­ä»…ä½¿ç”¨ <code>navigateTo</code> å³å¯ï¼‰</p>\n<p>é¦–å…ˆéœ€è¦ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•å †æ ˆé•¿åº¦(\bå¾®ä¿¡æä¾›ä¸€ä¸ªgetCurrentPagesçš„æ–¹æ³•)ï¼Œ åŒæ—¶æ›´æ”¹ <code>push</code> æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å½“å‰é¡µé¢å †æ ˆé•¿åº¦</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> pageStackLen = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"comment\">// å †æ ˆé™åˆ¶</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> maxStackLen = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">location, success, ...ohters</span>) </span>&#123;</span><br><span class=\"line\">  pageStackLen = getCurrentPages().length + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = parseUrl(location)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// åŒ…è£…è·³è½¬æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> _success = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    pageStackLen = getCurrentPages().length + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    success &amp;&amp; success()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> params = &#123; url, <span class=\"attr\">success</span>: _success, ...ohters&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.isTab) &#123;</span><br><span class=\"line\">    wx.switchTab(params)</span><br><span class=\"line\"></span><br><span class=\"line\">    pageStackLen = <span class=\"number\">1</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (location.reLaunch) &#123;</span><br><span class=\"line\">    wx.reLaunch(params)</span><br><span class=\"line\"></span><br><span class=\"line\">    pageStackLen = <span class=\"number\">1</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pageStackLen &gt;= maxStackLen) &#123;</span><br><span class=\"line\">      wx.redirectTo(params)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    wx.navigateTo(params)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸ŠåŸºæœ¬è§£å†³å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜</p>\n<h3 id=\"å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\"><a href=\"#å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\" class=\"headerlink\" title=\"å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½\"></a>å®Œå–„è·¯ç”±è·³è½¬åŠŸèƒ½</h3><p>ç°åœ¨å¯¹è·¯ç”±çš„è·³è½¬åšä¸€äº›åŸºæœ¬è¾…åŠ©åŠŸèƒ½çš„æ”¯æŒ\b <code>go</code>ã€ <code>back</code>, <code>replace</code> ç­‰æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replace</span>(<span class=\"params\">location, ...others</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> url = parseUrl(location)</span><br><span class=\"line\"></span><br><span class=\"line\">  wx.redirectTo(&#123;</span><br><span class=\"line\">    url,</span><br><span class=\"line\">    ...others</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">go</span>(<span class=\"params\">delta</span>) </span>&#123;</span><br><span class=\"line\">  wx.navigateBack(&#123;</span><br><span class=\"line\">    delta</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">back</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  wx.navigateBack()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å°†è¿™äº›æŒ‚åˆ° <code>$router</code> å¯¹è±¡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> _router = &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'history'</span>,</span><br><span class=\"line\">  push,</span><br><span class=\"line\">  replace,</span><br><span class=\"line\">  go,</span><br><span class=\"line\">  back</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> $router = &#123;</span><br><span class=\"line\">  get() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _router</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ­¤å¤–è¿˜æœ‰æˆ‘ä»¬ä¸éœ€è¦\bé¡µé¢ä¹‹é—´ä¼ å‚æ—¶æ—¶pushæ–¹æ³•ç›´æ¥ä¼ å­—ç¬¦ä¸²è·¯å¾„ï¼Œè·¯ç”±å…¬ç”¨è·¯å¾„çœç•¥ï¼Œpushè°ƒç”¨ä¼ \båŸºæœ¬è·¯å¾„è‡ªåŠ¨è¡¥é½, \bå•ç‹¬å¯¼å‡º <code>push</code> æ–¹æ³•æ–¹ä¾¿ç»„ä»¶å¤–éƒ¨è°ƒç”¨ç­‰ä¼˜åŒ–</p>\n<p>\bæœ€åæˆ‘ä»¬è¿˜å·®è·¯ç”±æ‹¦æˆªå™¨åŠŸèƒ½çš„å®ç°</p>\n<h3 id=\"è·¯ç”±æ‹¦æˆªå™¨\"><a href=\"#è·¯ç”±æ‹¦æˆªå™¨\" class=\"headerlink\" title=\"è·¯ç”±æ‹¦æˆªå™¨\"></a>è·¯ç”±æ‹¦æˆªå™¨</h3><p>éœ€æ±‚ï¼š å¯¹è±¡å½¢å¼é…ç½®è‡ªå·±è·¯ç”±è§„åˆ™</p>\n<ul>\n<li><code>[triggerAll]</code>ï¼š \bæ‰€æœ‰è·¯ç”±è·³è½¬å‡ä¼šè§¦å‘</li>\n<li><code>[triggerMatch]</code>ï¼š åŒ¹é…æŒ‡å®šè·¯ç”±ï¼Œå…¶ä¸­å¯é…ç½®å¤šä¸ªè§„åˆ™ï¼Œä»¥å‡½æ•°æ•°ç»„å½¢å¼ä¼ å…¥ï¼Œæ•°ç»„ä¸­æ‰€æœ‰å‡½æ•°éƒ½ä¼šåœ¨è¢«åŒ¹é…æ—¶è§¦å‘</li>\n</ul>\n<p>å‚æ•°ä»‹ç»ï¼š</p>\n<ul>\n<li><code>config</code>: æºå¸¦å½“å‰è·¯ç”±è·³è½¬ä¿¡æ¯ï¼ˆè·¯ç”±å‚æ•°ï¼‰</li>\n<li><code>to</code>: \bæ§åˆ¶è·³è½¬ï¼ˆè°ƒç”¨ <code>to()</code> ï¼‰</li>\n</ul>\n<p>\bä½¿ç”¨æ–¹å¼ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  triggerAll(config, to) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(config, <span class=\"string\">'enter interceptor'</span>)</span><br><span class=\"line\">    to()</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  triggerMatch: &#123;</span><br><span class=\"line\">    <span class=\"string\">'/home/pages/categoryList'</span>: [</span><br><span class=\"line\">      (config, to) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"comment\">/*flag*/</span>) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">          to()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æœ¬è´¨ä¸Šè¿˜æ˜¯å°†ä¹‹å‰å°è£…çš„è·¯ç”±æš´éœ²å‡ºæ¥çš„pushæ–¹æ³•å†æ¬¡å°è£…ä¸€å±‚ï¼Œå…¶ä¸­åŠ å…¥è‡ªå·±çš„é€»è¾‘è¾¾åˆ°ç›®çš„</p>\n<p>æ–°å»º <code>interceptor.js</code></p>\n<p>é¦–å…ˆå¼•å…¥ä¹‹å‰çš„è·¯ç”±æ–¹ä¾¿åœ¨å®ä¾‹ä¸Šè°ƒç”¨ï¼Œå®šä¹‰ <code>triggerMatch</code> çš„å¯¹è±¡å­˜å‚¨å­˜å…¥çš„å‡½æ•° <code>key</code> ä¸ºå½“å‰è·¯ç”±çš„è·¯å¾„ï¼Œ\b<code>value</code> ä¸º ä¸­é—´ä»¶å‡½æ•°ç»„æˆçš„æ•°ç»„</p>\n<p>å…³é”®ï¼š å°† <code>push</code> æ–¹æ³•å½“åšå•ç‹¬çš„ä¸€ä¸ªä¸­é—´ä»¶å¹¶æ”¾åœ¨æ‰€æœ‰ä¸­é—´ä»¶çš„æœ€åæ‰§è¡Œ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¼•å…¥</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">'./index.js'</span></span><br><span class=\"line\"><span class=\"comment\">// æŒ‚è½½</span></span><br><span class=\"line\">Vue.use(router)</span><br><span class=\"line\"><span class=\"comment\">// å­˜åŒ¹é…æŒ‡å®šè·¯ç”±çš„ä¸šåŠ¡å‡½æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> matchMiddlewares = &#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>æ¥ä¸‹æ¥è¦æ„å»ºä¸€ä¸ªå¤„ç†æ¨å…¥è§„åˆ™çš„\bä¸šåŠ¡å‡½æ•°ï¼ˆä¸­é—´ä»¶ï¼‰çš„ <code>compose</code> å‡½æ•°</p>\n<p>\b\bè¿™ä¸ªå‡½æ•°çš„ä½œç”¨ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªï¼š</p>\n<ul>\n<li>\bä¾æ¬¡æ´¾å‘æ¨å…¥æ‹¦æˆªå™¨çš„\bä¸šåŠ¡å‡½æ•°</li>\n<li>æ§åˆ¶ä¸‹ä¸€æ¬¡æ´¾å‘çš„å¼€å§‹</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> compose = <span class=\"function\"><span class=\"params\">middlewares</span> =&gt;</span> (...args) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dispatch</span>(<span class=\"params\">i</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> !middlewares[i]</span><br><span class=\"line\">      ? <span class=\"built_in\">Promise</span>.resolve(<span class=\"string\">'no arguments'</span>)</span><br><span class=\"line\">      : <span class=\"built_in\">Promise</span>.resolve(</span><br><span class=\"line\">          middlewares[i](...args, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ´¾å‘ä¸‹ä¸ªè°ƒç”¨</span></span><br><span class=\"line\">            <span class=\"comment\">// æ­¤å¤„å³æ˜¯æ‹¦æˆªå™¨ä¸­ç¬¬äºŒä¸ªå®å‚ to æ–¹æ³•çš„å‡½æ•°ä½“</span></span><br><span class=\"line\">            <span class=\"comment\">// è°ƒåŠ¨ to() å³å¼€å¯ä¸‹ä¸€æ¬¡æ´¾å‘</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> dispatch(++i)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¼€å¯è°ƒç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> dispatch(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>\båˆ›å»ºä¸€ä¸ªå‡½æ•° <code>getMatchMiddlewares</code> ç”¨æ¥æ ¹æ®æŒ‡å®šé”®å€¼è¯»å– <code>matchMiddlewares</code> ä¸­ä¸­é—´ä»¶å‡½æ•°æ•°ç»„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getMatchMiddlewares</span>(<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> matchMiddlewares.hasOwnProperty(path) ? matchMiddlewares[path] : []</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è·¯ç”±åŒæ ·ä½¿ç”¨ <code>Vue.use</code> æ–¹æ³•æ³¨å†Œï¼Œè¿™é‡Œå¯¼å‡º \b<code>install</code> æ–¹æ³•, åœ¨é‡Œé¢ç»Ÿä¸€æ‰€æœ‰ä¸­é—´ä»¶å‡½æ•°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åŒ…è£… push</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> $push</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pushMiddware</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">  $push(...args)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  install(Vue, &#123; triggerAll, triggerMatch &#125;) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å­˜å‚¨åŸ push å‡½æ•°</span></span><br><span class=\"line\">    $push = Vue.prototype.$router.push</span><br><span class=\"line\">    <span class=\"comment\">// æ¥æ”¶ä¼ å…¥çš„åŒ¹é…å‡½æ•°</span></span><br><span class=\"line\">    matchMiddlewares = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, triggerMatch)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// é‡æ–°èµ‹å€¼</span></span><br><span class=\"line\">    Vue.prototype.$router.push = <span class=\"function\">(<span class=\"params\">...args</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// åˆå¹¶</span></span><br><span class=\"line\">      compose([...getMatchMiddlewares(path), triggerAll, pushMiddware])(</span><br><span class=\"line\">        ...args</span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¹‹ååœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥å³å¯</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> interceptor <span class=\"keyword\">from</span> <span class=\"string\">'./interceptor.js'</span></span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(interceptor)</span><br></pre></td></tr></table></figure>\n<p>è‡³æ­¤ä¾¿å®Œæˆäº†è·¯ç”±çš„æ‰€æœ‰åŠŸèƒ½çš„åŸºæœ¬å°è£…</p>\n<p>è¯¦ç»†ä»£ç å¯ä»¥æŸ¥çœ‹ <a href=\"http://git.yupaopao.com/fe/applet/iverson/tree/master/src/global/lib/router\" target=\"_blank\" rel=\"noopener\">å°ç¨‹åºè·¯ç”±</a></p>\n<p>æ­¤ç¯‡æ–‡ç« å·²ç»å‘å¸ƒåœ¨ <a href=\"http://doc.yupaopao.com/pages/viewpage.action?pageId=7176857\" target=\"_blank\" rel=\"noopener\">http://doc.yupaopao.com</a></p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>è·¯ç”±\båŸºæœ¬åŠŸèƒ½çš„å°è£…åŸºæœ¬è‡³æ­¤å·²ç»å…¨éƒ¨å®Œæˆï¼ŒåŸºæœ¬æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€è¦ã€‚ä½†ç”±äºè‡ªèº«æ°´å¹³é™åˆ¶ï¼Œä¼šå­˜åœ¨å„ç±»é—®é¢˜ï¼Œå¸Œæœ›å¤§å®¶æŒ‡å‡ºä¸€èµ·è®¨è®ºï¼Œå…±åŒè¿›æ­¥ã€‚</p>\n<p>å¼€æ”¾ã€çœŸå®ï¼peace.</p>\n"}],"PostAsset":[{"_id":"source/_posts/do something/åè¡Œä»£ç å®ç°Koa2æ´‹è‘±æ¨¡å‹/onion.png","slug":"onion.png","post":"cjsh7ugh5000464vadjycj22t","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cjsh7ugh2000364va0kwaywl5","category_id":"cjsh7ugh7000564vamh12ks5g","_id":"cjsh7ughc000a64vaki59c8tc"},{"post_id":"cjsh7ugh5000464vadjycj22t","category_id":"cjsh7ugha000864vaz26nmxce","_id":"cjsh7ughd000d64va2c13yl4v"},{"post_id":"cjsh7ugh9000764va7cl9kkin","category_id":"cjsh7ughc000b64vaxtpjduv6","_id":"cjsh7ughe000f64vazyp3pml6"},{"post_id":"cjsh7ughj000s64valgq5mep5","category_id":"cjsh7ugha000864vaz26nmxce","_id":"cjsh7ugho000u64va09gjko9i"}],"PostTag":[{"post_id":"cjsh7ugh2000364va0kwaywl5","tag_id":"cjsh7ugh9000664vaccdfcvs8","_id":"cjsh7ughf000h64vayexicy1t"},{"post_id":"cjsh7ugh2000364va0kwaywl5","tag_id":"cjsh7ughb000964vaihfiwqlw","_id":"cjsh7ughf000i64vaxkts1ar6"},{"post_id":"cjsh7ugh2000364va0kwaywl5","tag_id":"cjsh7ughc000c64var1ve6yei","_id":"cjsh7ughg000k64vabouahtwk"},{"post_id":"cjsh7ugh2000364va0kwaywl5","tag_id":"cjsh7ughe000e64vaqkppk2cy","_id":"cjsh7ughg000l64vapi0wyu4d"},{"post_id":"cjsh7ugh5000464vadjycj22t","tag_id":"cjsh7ughe000g64vaccr8tzzm","_id":"cjsh7ughh000o64vadftezm26"},{"post_id":"cjsh7ugh5000464vadjycj22t","tag_id":"cjsh7ughf000j64vafye8kbuh","_id":"cjsh7ughh000p64vay9w1czuz"},{"post_id":"cjsh7ugh5000464vadjycj22t","tag_id":"cjsh7ughg000m64vaz5wvpfrs","_id":"cjsh7ughh000q64va84nmohe1"},{"post_id":"cjsh7ugh9000764va7cl9kkin","tag_id":"cjsh7ughg000n64vaw4w91epk","_id":"cjsh7ughi000r64va7losajtl"},{"post_id":"cjsh7ughj000s64valgq5mep5","tag_id":"cjsh7ughe000g64vaccr8tzzm","_id":"cjsh7ughp000x64vazt410sps"},{"post_id":"cjsh7ughj000s64valgq5mep5","tag_id":"cjsh7ughk000t64va00rewhfq","_id":"cjsh7ughp000y64vab4o972cq"},{"post_id":"cjsh7ughj000s64valgq5mep5","tag_id":"cjsh7ugho000v64vajjttz4vm","_id":"cjsh7ughq000z64vahp040fgc"},{"post_id":"cjsh7ughj000s64valgq5mep5","tag_id":"cjsh7ughp000w64vabyzi1vq3","_id":"cjsh7ughq001064vajkabegub"}],"Tag":[{"name":"ç®—æ³•","_id":"cjsh7ugh9000664vaccdfcvs8"},{"name":"åŠ¨æ€è§„åˆ’","_id":"cjsh7ughb000964vaihfiwqlw"},{"name":"é€’å½’","_id":"cjsh7ughc000c64var1ve6yei"},{"name":"å°¾é€’å½’","_id":"cjsh7ughe000e64vaqkppk2cy"},{"name":"å°è£…","_id":"cjsh7ughe000g64vaccr8tzzm"},{"name":"koa","_id":"cjsh7ughf000j64vafye8kbuh"},{"name":"æ´‹è‘±æ¨¡å‹","_id":"cjsh7ughg000m64vaz5wvpfrs"},{"name":"å½“æˆ‘åœ¨æ‰¯æ·¡","_id":"cjsh7ughg000n64vaw4w91epk"},{"name":"å¾®ä¿¡å°ç¨‹åº","_id":"cjsh7ughk000t64va00rewhfq"},{"name":"mpvue","_id":"cjsh7ugho000v64vajjttz4vm"},{"name":"è·¯ç”±","_id":"cjsh7ughp000w64vabyzi1vq3"}]}}